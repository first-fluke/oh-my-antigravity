#!/usr/bin/env node
import{createRequire as Xx}from"node:module";var nx=Object.create;var{getPrototypeOf:Jx,defineProperty:k0,getOwnPropertyNames:Zx}=Object;var Qx=Object.prototype.hasOwnProperty;var p=(g,$,x)=>{x=g!=null?nx(Jx(g)):{};let N=$||!g||!g.__esModule?k0(x,"default",{value:g,enumerable:!0}):x;for(let I of Zx(g))if(!Qx.call(N,I))k0(N,I,{get:()=>g[I],enumerable:!0});return N};var i=(g,$)=>()=>($||g(($={exports:{}}).exports,$),$.exports);var W=Xx(import.meta.url);var q1=i((H6,bg)=>{var Ig=process||{},p0=Ig.argv||[],Ng=Ig.env||{},zx=!(!!Ng.NO_COLOR||p0.includes("--no-color"))&&(!!Ng.FORCE_COLOR||p0.includes("--color")||Ig.platform==="win32"||(Ig.stdout||{}).isTTY&&Ng.TERM!=="dumb"||!!Ng.CI),jx=(g,$,x=g)=>(N)=>{let I=""+N,C=I.indexOf($,g.length);return~C?g+Kx(I,$,x,C)+$:g+I+$},Kx=(g,$,x,N)=>{let I="",C=0;do I+=g.substring(C,N)+x,C=N+$.length,N=g.indexOf($,C);while(~N);return I+g.substring(C)},o0=(g=zx)=>{let $=g?jx:()=>String;return{isColorSupported:g,reset:$("\x1B[0m","\x1B[0m"),bold:$("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"),dim:$("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"),italic:$("\x1B[3m","\x1B[23m"),underline:$("\x1B[4m","\x1B[24m"),inverse:$("\x1B[7m","\x1B[27m"),hidden:$("\x1B[8m","\x1B[28m"),strikethrough:$("\x1B[9m","\x1B[29m"),black:$("\x1B[30m","\x1B[39m"),red:$("\x1B[31m","\x1B[39m"),green:$("\x1B[32m","\x1B[39m"),yellow:$("\x1B[33m","\x1B[39m"),blue:$("\x1B[34m","\x1B[39m"),magenta:$("\x1B[35m","\x1B[39m"),cyan:$("\x1B[36m","\x1B[39m"),white:$("\x1B[37m","\x1B[39m"),gray:$("\x1B[90m","\x1B[39m"),bgBlack:$("\x1B[40m","\x1B[49m"),bgRed:$("\x1B[41m","\x1B[49m"),bgGreen:$("\x1B[42m","\x1B[49m"),bgYellow:$("\x1B[43m","\x1B[49m"),bgBlue:$("\x1B[44m","\x1B[49m"),bgMagenta:$("\x1B[45m","\x1B[49m"),bgCyan:$("\x1B[46m","\x1B[49m"),bgWhite:$("\x1B[47m","\x1B[49m"),blackBright:$("\x1B[90m","\x1B[39m"),redBright:$("\x1B[91m","\x1B[39m"),greenBright:$("\x1B[92m","\x1B[39m"),yellowBright:$("\x1B[93m","\x1B[39m"),blueBright:$("\x1B[94m","\x1B[39m"),magentaBright:$("\x1B[95m","\x1B[39m"),cyanBright:$("\x1B[96m","\x1B[39m"),whiteBright:$("\x1B[97m","\x1B[39m"),bgBlackBright:$("\x1B[100m","\x1B[49m"),bgRedBright:$("\x1B[101m","\x1B[49m"),bgGreenBright:$("\x1B[102m","\x1B[49m"),bgYellowBright:$("\x1B[103m","\x1B[49m"),bgBlueBright:$("\x1B[104m","\x1B[49m"),bgMagentaBright:$("\x1B[105m","\x1B[49m"),bgCyanBright:$("\x1B[106m","\x1B[49m"),bgWhiteBright:$("\x1B[107m","\x1B[49m")}};bg.exports=o0();bg.exports.createColors=o0});var hg=i((V6,s0)=>{var cg={to(g,$){if(!$)return`\x1B[${g+1}G`;return`\x1B[${$+1};${g+1}H`},move(g,$){let x="";if(g<0)x+=`\x1B[${-g}D`;else if(g>0)x+=`\x1B[${g}C`;if($<0)x+=`\x1B[${-$}A`;else if($>0)x+=`\x1B[${$}B`;return x},up:(g=1)=>`\x1B[${g}A`,down:(g=1)=>`\x1B[${g}B`,forward:(g=1)=>`\x1B[${g}C`,backward:(g=1)=>`\x1B[${g}D`,nextLine:(g=1)=>"\x1B[E".repeat(g),prevLine:(g=1)=>"\x1B[F".repeat(g),left:"\x1B[G",hide:"\x1B[?25l",show:"\x1B[?25h",save:"\x1B7",restore:"\x1B8"},Mx={up:(g=1)=>"\x1B[S".repeat(g),down:(g=1)=>"\x1B[T".repeat(g)},Yx={screen:"\x1B[2J",up:(g=1)=>"\x1B[1J".repeat(g),down:(g=1)=>"\x1B[J".repeat(g),line:"\x1B[2K",lineEnd:"\x1B[K",lineStart:"\x1B[1K",lines(g){let $="";for(let x=0;x<g;x++)$+=this.line+(x<g-1?cg.up():"");if(g)$+=cg.left;return $}};s0.exports={cursor:cg,scroll:Mx,erase:Yx,beep:"\x07"}});var n1=i((g9,t$)=>{var a$=["nodebuffer","arraybuffer","fragments"],r$=typeof Blob<"u";if(r$)a$.push("blob");t$.exports={BINARY_TYPES:a$,CLOSE_TIMEOUT:30000,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:r$,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var c1=i(($9,lg)=>{var{EMPTY_BUFFER:C3}=n1(),U0=Buffer[Symbol.species];function G3(g,$){if(g.length===0)return C3;if(g.length===1)return g[0];let x=Buffer.allocUnsafe($),N=0;for(let I=0;I<g.length;I++){let C=g[I];x.set(C,N),N+=C.length}if(N<$)return new U0(x.buffer,x.byteOffset,N);return x}function e$(g,$,x,N,I){for(let C=0;C<I;C++)x[N+C]=g[C]^$[C&3]}function g2(g,$){for(let x=0;x<g.length;x++)g[x]^=$[x&3]}function n3(g){if(g.length===g.buffer.byteLength)return g.buffer;return g.buffer.slice(g.byteOffset,g.byteOffset+g.length)}function D0(g){if(D0.readOnly=!0,Buffer.isBuffer(g))return g;let $;if(g instanceof ArrayBuffer)$=new U0(g);else if(ArrayBuffer.isView(g))$=new U0(g.buffer,g.byteOffset,g.byteLength);else $=Buffer.from(g),D0.readOnly=!1;return $}lg.exports={concat:G3,mask:e$,toArrayBuffer:n3,toBuffer:D0,unmask:g2};if(!process.env.WS_NO_BUFFER_UTIL)try{let g=(()=>{throw new Error("Cannot require module "+"bufferutil");})();lg.exports.mask=function($,x,N,I,C){if(C<48)e$($,x,N,I,C);else g.mask($,x,N,I,C)},lg.exports.unmask=function($,x){if($.length<32)g2($,x);else g.unmask($,x)}}catch(g){}});var I2=i((x9,N2)=>{var $2=Symbol("kDone"),q0=Symbol("kRun");class x2{constructor(g){this[$2]=()=>{this.pending--,this[q0]()},this.concurrency=g||1/0,this.jobs=[],this.pending=0}add(g){this.jobs.push(g),this[q0]()}[q0](){if(this.pending===this.concurrency)return;if(this.jobs.length){let g=this.jobs.shift();this.pending++,g(this[$2])}}}N2.exports=x2});var k1=i((N9,Z2)=>{var h1=W("zlib"),C2=c1(),J3=I2(),{kStatusCode:G2}=n1(),Z3=Buffer[Symbol.species],Q3=Buffer.from([0,0,255,255]),Lg=Symbol("permessage-deflate"),J1=Symbol("total-length"),T1=Symbol("callback"),z1=Symbol("buffers"),L1=Symbol("error"),Tg;class n2{constructor(g,$,x){if(this._maxPayload=x|0,this._options=g||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!$,this._deflate=null,this._inflate=null,this.params=null,!Tg){let N=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Tg=new J3(N)}}static get extensionName(){return"permessage-deflate"}offer(){let g={};if(this._options.serverNoContextTakeover)g.server_no_context_takeover=!0;if(this._options.clientNoContextTakeover)g.client_no_context_takeover=!0;if(this._options.serverMaxWindowBits)g.server_max_window_bits=this._options.serverMaxWindowBits;if(this._options.clientMaxWindowBits)g.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits==null)g.client_max_window_bits=!0;return g}accept(g){return g=this.normalizeParams(g),this.params=this._isServer?this.acceptAsServer(g):this.acceptAsClient(g),this.params}cleanup(){if(this._inflate)this._inflate.close(),this._inflate=null;if(this._deflate){let g=this._deflate[T1];if(this._deflate.close(),this._deflate=null,g)g(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(g){let $=this._options,x=g.find((N)=>{if($.serverNoContextTakeover===!1&&N.server_no_context_takeover||N.server_max_window_bits&&($.serverMaxWindowBits===!1||typeof $.serverMaxWindowBits==="number"&&$.serverMaxWindowBits>N.server_max_window_bits)||typeof $.clientMaxWindowBits==="number"&&!N.client_max_window_bits)return!1;return!0});if(!x)throw Error("None of the extension offers can be accepted");if($.serverNoContextTakeover)x.server_no_context_takeover=!0;if($.clientNoContextTakeover)x.client_no_context_takeover=!0;if(typeof $.serverMaxWindowBits==="number")x.server_max_window_bits=$.serverMaxWindowBits;if(typeof $.clientMaxWindowBits==="number")x.client_max_window_bits=$.clientMaxWindowBits;else if(x.client_max_window_bits===!0||$.clientMaxWindowBits===!1)delete x.client_max_window_bits;return x}acceptAsClient(g){let $=g[0];if(this._options.clientNoContextTakeover===!1&&$.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(!$.client_max_window_bits){if(typeof this._options.clientMaxWindowBits==="number")$.client_max_window_bits=this._options.clientMaxWindowBits}else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits==="number"&&$.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"');return $}normalizeParams(g){return g.forEach(($)=>{Object.keys($).forEach((x)=>{let N=$[x];if(N.length>1)throw Error(`Parameter "${x}" must have only a single value`);if(N=N[0],x==="client_max_window_bits"){if(N!==!0){let I=+N;if(!Number.isInteger(I)||I<8||I>15)throw TypeError(`Invalid value for parameter "${x}": ${N}`);N=I}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${x}": ${N}`)}else if(x==="server_max_window_bits"){let I=+N;if(!Number.isInteger(I)||I<8||I>15)throw TypeError(`Invalid value for parameter "${x}": ${N}`);N=I}else if(x==="client_no_context_takeover"||x==="server_no_context_takeover"){if(N!==!0)throw TypeError(`Invalid value for parameter "${x}": ${N}`)}else throw Error(`Unknown parameter "${x}"`);$[x]=N})}),g}decompress(g,$,x){Tg.add((N)=>{this._decompress(g,$,(I,C)=>{N(),x(I,C)})})}compress(g,$,x){Tg.add((N)=>{this._compress(g,$,(I,C)=>{N(),x(I,C)})})}_decompress(g,$,x){let N=this._isServer?"client":"server";if(!this._inflate){let I=`${N}_max_window_bits`,C=typeof this.params[I]!=="number"?h1.Z_DEFAULT_WINDOWBITS:this.params[I];this._inflate=h1.createInflateRaw({...this._options.zlibInflateOptions,windowBits:C}),this._inflate[Lg]=this,this._inflate[J1]=0,this._inflate[z1]=[],this._inflate.on("error",z3),this._inflate.on("data",J2)}if(this._inflate[T1]=x,this._inflate.write(g),$)this._inflate.write(Q3);this._inflate.flush(()=>{let I=this._inflate[L1];if(I){this._inflate.close(),this._inflate=null,x(I);return}let C=C2.concat(this._inflate[z1],this._inflate[J1]);if(this._inflate._readableState.endEmitted)this._inflate.close(),this._inflate=null;else if(this._inflate[J1]=0,this._inflate[z1]=[],$&&this.params[`${N}_no_context_takeover`])this._inflate.reset();x(null,C)})}_compress(g,$,x){let N=this._isServer?"server":"client";if(!this._deflate){let I=`${N}_max_window_bits`,C=typeof this.params[I]!=="number"?h1.Z_DEFAULT_WINDOWBITS:this.params[I];this._deflate=h1.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:C}),this._deflate[J1]=0,this._deflate[z1]=[],this._deflate.on("data",X3)}this._deflate[T1]=x,this._deflate.write(g),this._deflate.flush(h1.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let I=C2.concat(this._deflate[z1],this._deflate[J1]);if($)I=new Z3(I.buffer,I.byteOffset,I.length-4);if(this._deflate[T1]=null,this._deflate[J1]=0,this._deflate[z1]=[],$&&this.params[`${N}_no_context_takeover`])this._deflate.reset();x(null,I)})}}Z2.exports=n2;function X3(g){this[z1].push(g),this[J1]+=g.length}function J2(g){if(this[J1]+=g.length,this[Lg]._maxPayload<1||this[J1]<=this[Lg]._maxPayload){this[z1].push(g);return}this[L1]=RangeError("Max payload size exceeded"),this[L1].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[L1][G2]=1009,this.removeListener("data",J2),this.reset()}function z3(g){if(this[Lg]._inflate=null,this[L1]){this[T1](this[L1]);return}g[G2]=1007,this[T1](g)}});var _1=i((I9,_g)=>{var{isUtf8:Q2}=W("buffer"),{hasBlob:j3}=n1(),K3=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function M3(g){return g>=1000&&g<=1014&&g!==1004&&g!==1005&&g!==1006||g>=3000&&g<=4999}function B0(g){let $=g.length,x=0;while(x<$)if((g[x]&128)===0)x++;else if((g[x]&224)===192){if(x+1===$||(g[x+1]&192)!==128||(g[x]&254)===192)return!1;x+=2}else if((g[x]&240)===224){if(x+2>=$||(g[x+1]&192)!==128||(g[x+2]&192)!==128||g[x]===224&&(g[x+1]&224)===128||g[x]===237&&(g[x+1]&224)===160)return!1;x+=3}else if((g[x]&248)===240){if(x+3>=$||(g[x+1]&192)!==128||(g[x+2]&192)!==128||(g[x+3]&192)!==128||g[x]===240&&(g[x+1]&240)===128||g[x]===244&&g[x+1]>143||g[x]>244)return!1;x+=4}else return!1;return!0}function Y3(g){return j3&&typeof g==="object"&&typeof g.arrayBuffer==="function"&&typeof g.type==="string"&&typeof g.stream==="function"&&(g[Symbol.toStringTag]==="Blob"||g[Symbol.toStringTag]==="File")}_g.exports={isBlob:Y3,isValidStatusCode:M3,isValidUTF8:B0,tokenChars:K3};if(Q2)_g.exports.isValidUTF8=function(g){return g.length<24?B0(g):Q2(g)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let g=(()=>{throw new Error("Cannot require module "+"utf-8-validate");})();_g.exports.isValidUTF8=function($){return $.length<32?B0($):g($)}}catch(g){}});var T0=i((C9,M2)=>{var{Writable:R3}=W("stream"),X2=k1(),{BINARY_TYPES:O3,EMPTY_BUFFER:z2,kStatusCode:H3,kWebSocket:V3}=n1(),{concat:l0,toArrayBuffer:A3,unmask:U3}=c1(),{isValidStatusCode:D3,isValidUTF8:j2}=_1(),mg=Buffer[Symbol.species];class K2 extends R3{constructor(g={}){super();this._allowSynchronousEvents=g.allowSynchronousEvents!==void 0?g.allowSynchronousEvents:!0,this._binaryType=g.binaryType||O3[0],this._extensions=g.extensions||{},this._isServer=!!g.isServer,this._maxPayload=g.maxPayload|0,this._skipUTF8Validation=!!g.skipUTF8Validation,this[V3]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(g,$,x){if(this._opcode===8&&this._state==0)return x();this._bufferedBytes+=g.length,this._buffers.push(g),this.startLoop(x)}consume(g){if(this._bufferedBytes-=g,g===this._buffers[0].length)return this._buffers.shift();if(g<this._buffers[0].length){let x=this._buffers[0];return this._buffers[0]=new mg(x.buffer,x.byteOffset+g,x.length-g),new mg(x.buffer,x.byteOffset,g)}let $=Buffer.allocUnsafe(g);do{let x=this._buffers[0],N=$.length-g;if(g>=x.length)$.set(this._buffers.shift(),N);else $.set(new Uint8Array(x.buffer,x.byteOffset,g),N),this._buffers[0]=new mg(x.buffer,x.byteOffset+g,x.length-g);g-=x.length}while(g>0);return $}startLoop(g){this._loop=!0;do switch(this._state){case 0:this.getInfo(g);break;case 1:this.getPayloadLength16(g);break;case 2:this.getPayloadLength64(g);break;case 3:this.getMask();break;case 4:this.getData(g);break;case 5:case 6:this._loop=!1;return}while(this._loop);if(!this._errored)g()}getInfo(g){if(this._bufferedBytes<2){this._loop=!1;return}let $=this.consume(2);if(($[0]&48)!==0){let N=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");g(N);return}let x=($[0]&64)===64;if(x&&!this._extensions[X2.extensionName]){let N=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");g(N);return}if(this._fin=($[0]&128)===128,this._opcode=$[0]&15,this._payloadLength=$[1]&127,this._opcode===0){if(x){let N=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");g(N);return}if(!this._fragmented){let N=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");g(N);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let N=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");g(N);return}this._compressed=x}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let N=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");g(N);return}if(x){let N=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");g(N);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let N=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");g(N);return}}else{let N=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");g(N);return}if(!this._fin&&!this._fragmented)this._fragmented=this._opcode;if(this._masked=($[1]&128)===128,this._isServer){if(!this._masked){let N=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");g(N);return}}else if(this._masked){let N=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");g(N);return}if(this._payloadLength===126)this._state=1;else if(this._payloadLength===127)this._state=2;else this.haveLength(g)}getPayloadLength16(g){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(g)}getPayloadLength64(g){if(this._bufferedBytes<8){this._loop=!1;return}let $=this.consume(8),x=$.readUInt32BE(0);if(x>Math.pow(2,21)-1){let N=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");g(N);return}this._payloadLength=x*Math.pow(2,32)+$.readUInt32BE(4),this.haveLength(g)}haveLength(g){if(this._payloadLength&&this._opcode<8){if(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0){let $=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");g($);return}}if(this._masked)this._state=3;else this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(g){let $=z2;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}if($=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0)U3($,this._mask)}if(this._opcode>7){this.controlMessage($,g);return}if(this._compressed){this._state=5,this.decompress($,g);return}if($.length)this._messageLength=this._totalPayloadLength,this._fragments.push($);this.dataMessage(g)}decompress(g,$){this._extensions[X2.extensionName].decompress(g,this._fin,(N,I)=>{if(N)return $(N);if(I.length){if(this._messageLength+=I.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let C=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");$(C);return}this._fragments.push(I)}if(this.dataMessage($),this._state===0)this.startLoop($)})}dataMessage(g){if(!this._fin){this._state=0;return}let $=this._messageLength,x=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let N;if(this._binaryType==="nodebuffer")N=l0(x,$);else if(this._binaryType==="arraybuffer")N=A3(l0(x,$));else if(this._binaryType==="blob")N=new Blob(x);else N=x;if(this._allowSynchronousEvents)this.emit("message",N,!0),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",N,!0),this._state=0,this.startLoop(g)})}else{let N=l0(x,$);if(!this._skipUTF8Validation&&!j2(N)){let I=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");g(I);return}if(this._state===5||this._allowSynchronousEvents)this.emit("message",N,!1),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",N,!1),this._state=0,this.startLoop(g)})}}controlMessage(g,$){if(this._opcode===8){if(g.length===0)this._loop=!1,this.emit("conclude",1005,z2),this.end();else{let x=g.readUInt16BE(0);if(!D3(x)){let I=this.createError(RangeError,`invalid status code ${x}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");$(I);return}let N=new mg(g.buffer,g.byteOffset+2,g.length-2);if(!this._skipUTF8Validation&&!j2(N)){let I=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");$(I);return}this._loop=!1,this.emit("conclude",x,N),this.end()}this._state=0;return}if(this._allowSynchronousEvents)this.emit(this._opcode===9?"ping":"pong",g),this._state=0;else this._state=6,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",g),this._state=0,this.startLoop($)})}createError(g,$,x,N,I){this._loop=!1,this._errored=!0;let C=new g(x?`Invalid WebSocket frame: ${$}`:$);return Error.captureStackTrace(C,this.createError),C.code=I,C[H3]=N,C}}M2.exports=K2});var _0=i((n9,O2)=>{var{Duplex:G9}=W("stream"),{randomFillSync:q3}=W("crypto"),Y2=k1(),{EMPTY_BUFFER:B3,kWebSocket:l3,NOOP:T3}=n1(),{isBlob:m1,isValidStatusCode:L3}=_1(),{mask:R2,toBuffer:V1}=c1(),a=Symbol("kByteLength"),_3=Buffer.alloc(4),A1,S1=8192,t=0,m3=1,S3=2;class j1{constructor(g,$,x){if(this._extensions=$||{},x)this._generateMask=x,this._maskBuffer=Buffer.alloc(4);this._socket=g,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=t,this.onerror=T3,this[l3]=void 0}static frame(g,$){let x,N=!1,I=2,C=!1;if($.mask){if(x=$.maskBuffer||_3,$.generateMask)$.generateMask(x);else{if(S1===8192){if(A1===void 0)A1=Buffer.alloc(8192);q3(A1,0,8192),S1=0}x[0]=A1[S1++],x[1]=A1[S1++],x[2]=A1[S1++],x[3]=A1[S1++]}C=(x[0]|x[1]|x[2]|x[3])===0,I=6}let n;if(typeof g==="string")if((!$.mask||C)&&$[a]!==void 0)n=$[a];else g=Buffer.from(g),n=g.length;else n=g.length,N=$.mask&&$.readOnly&&!C;let G=n;if(n>=65536)I+=8,G=127;else if(n>125)I+=2,G=126;let J=Buffer.allocUnsafe(N?n+I:I);if(J[0]=$.fin?$.opcode|128:$.opcode,$.rsv1)J[0]|=64;if(J[1]=G,G===126)J.writeUInt16BE(n,2);else if(G===127)J[2]=J[3]=0,J.writeUIntBE(n,4,6);if(!$.mask)return[J,g];if(J[1]|=128,J[I-4]=x[0],J[I-3]=x[1],J[I-2]=x[2],J[I-1]=x[3],C)return[J,g];if(N)return R2(g,x,J,I,n),[J];return R2(g,x,g,0,n),[J,g]}close(g,$,x,N){let I;if(g===void 0)I=B3;else if(typeof g!=="number"||!L3(g))throw TypeError("First argument must be a valid error code number");else if($===void 0||!$.length)I=Buffer.allocUnsafe(2),I.writeUInt16BE(g,0);else{let n=Buffer.byteLength($);if(n>123)throw RangeError("The message must not be greater than 123 bytes");if(I=Buffer.allocUnsafe(2+n),I.writeUInt16BE(g,0),typeof $==="string")I.write($,2);else I.set($,2)}let C={[a]:I.length,fin:!0,generateMask:this._generateMask,mask:x,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};if(this._state!==t)this.enqueue([this.dispatch,I,!1,C,N]);else this.sendFrame(j1.frame(I,C),N)}ping(g,$,x){let N,I;if(typeof g==="string")N=Buffer.byteLength(g),I=!1;else if(m1(g))N=g.size,I=!1;else g=V1(g),N=g.length,I=V1.readOnly;if(N>125)throw RangeError("The data size must not be greater than 125 bytes");let C={[a]:N,fin:!0,generateMask:this._generateMask,mask:$,maskBuffer:this._maskBuffer,opcode:9,readOnly:I,rsv1:!1};if(m1(g))if(this._state!==t)this.enqueue([this.getBlobData,g,!1,C,x]);else this.getBlobData(g,!1,C,x);else if(this._state!==t)this.enqueue([this.dispatch,g,!1,C,x]);else this.sendFrame(j1.frame(g,C),x)}pong(g,$,x){let N,I;if(typeof g==="string")N=Buffer.byteLength(g),I=!1;else if(m1(g))N=g.size,I=!1;else g=V1(g),N=g.length,I=V1.readOnly;if(N>125)throw RangeError("The data size must not be greater than 125 bytes");let C={[a]:N,fin:!0,generateMask:this._generateMask,mask:$,maskBuffer:this._maskBuffer,opcode:10,readOnly:I,rsv1:!1};if(m1(g))if(this._state!==t)this.enqueue([this.getBlobData,g,!1,C,x]);else this.getBlobData(g,!1,C,x);else if(this._state!==t)this.enqueue([this.dispatch,g,!1,C,x]);else this.sendFrame(j1.frame(g,C),x)}send(g,$,x){let N=this._extensions[Y2.extensionName],I=$.binary?2:1,C=$.compress,n,G;if(typeof g==="string")n=Buffer.byteLength(g),G=!1;else if(m1(g))n=g.size,G=!1;else g=V1(g),n=g.length,G=V1.readOnly;if(this._firstFragment){if(this._firstFragment=!1,C&&N&&N.params[N._isServer?"server_no_context_takeover":"client_no_context_takeover"])C=n>=N._threshold;this._compress=C}else C=!1,I=0;if($.fin)this._firstFragment=!0;let J={[a]:n,fin:$.fin,generateMask:this._generateMask,mask:$.mask,maskBuffer:this._maskBuffer,opcode:I,readOnly:G,rsv1:C};if(m1(g))if(this._state!==t)this.enqueue([this.getBlobData,g,this._compress,J,x]);else this.getBlobData(g,this._compress,J,x);else if(this._state!==t)this.enqueue([this.dispatch,g,this._compress,J,x]);else this.dispatch(g,this._compress,J,x)}getBlobData(g,$,x,N){this._bufferedBytes+=x[a],this._state=S3,g.arrayBuffer().then((I)=>{if(this._socket.destroyed){let n=Error("The socket was closed while the blob was being read");process.nextTick(L0,this,n,N);return}this._bufferedBytes-=x[a];let C=V1(I);if(!$)this._state=t,this.sendFrame(j1.frame(C,x),N),this.dequeue();else this.dispatch(C,$,x,N)}).catch((I)=>{process.nextTick(F3,this,I,N)})}dispatch(g,$,x,N){if(!$){this.sendFrame(j1.frame(g,x),N);return}let I=this._extensions[Y2.extensionName];this._bufferedBytes+=x[a],this._state=m3,I.compress(g,x.fin,(C,n)=>{if(this._socket.destroyed){let G=Error("The socket was closed while data was being compressed");L0(this,G,N);return}this._bufferedBytes-=x[a],this._state=t,x.readOnly=!1,this.sendFrame(j1.frame(n,x),N),this.dequeue()})}dequeue(){while(this._state===t&&this._queue.length){let g=this._queue.shift();this._bufferedBytes-=g[3][a],Reflect.apply(g[0],this,g.slice(1))}}enqueue(g){this._bufferedBytes+=g[3][a],this._queue.push(g)}sendFrame(g,$){if(g.length===2)this._socket.cork(),this._socket.write(g[0]),this._socket.write(g[1],$),this._socket.uncork();else this._socket.write(g[0],$)}}O2.exports=j1;function L0(g,$,x){if(typeof x==="function")x($);for(let N=0;N<g._queue.length;N++){let I=g._queue[N],C=I[I.length-1];if(typeof C==="function")C($)}}function F3(g,$,x){L0(g,$,x),g.onerror($)}});var T2=i((J9,l2)=>{var{kForOnEventAttribute:p1,kListener:m0}=n1(),H2=Symbol("kCode"),V2=Symbol("kData"),A2=Symbol("kError"),U2=Symbol("kMessage"),D2=Symbol("kReason"),F1=Symbol("kTarget"),q2=Symbol("kType"),B2=Symbol("kWasClean");class K1{constructor(g){this[F1]=null,this[q2]=g}get target(){return this[F1]}get type(){return this[q2]}}Object.defineProperty(K1.prototype,"target",{enumerable:!0});Object.defineProperty(K1.prototype,"type",{enumerable:!0});class P1 extends K1{constructor(g,$={}){super(g);this[H2]=$.code===void 0?0:$.code,this[D2]=$.reason===void 0?"":$.reason,this[B2]=$.wasClean===void 0?!1:$.wasClean}get code(){return this[H2]}get reason(){return this[D2]}get wasClean(){return this[B2]}}Object.defineProperty(P1.prototype,"code",{enumerable:!0});Object.defineProperty(P1.prototype,"reason",{enumerable:!0});Object.defineProperty(P1.prototype,"wasClean",{enumerable:!0});class o1 extends K1{constructor(g,$={}){super(g);this[A2]=$.error===void 0?null:$.error,this[U2]=$.message===void 0?"":$.message}get error(){return this[A2]}get message(){return this[U2]}}Object.defineProperty(o1.prototype,"error",{enumerable:!0});Object.defineProperty(o1.prototype,"message",{enumerable:!0});class Fg extends K1{constructor(g,$={}){super(g);this[V2]=$.data===void 0?null:$.data}get data(){return this[V2]}}Object.defineProperty(Fg.prototype,"data",{enumerable:!0});var P3={addEventListener(g,$,x={}){for(let I of this.listeners(g))if(!x[p1]&&I[m0]===$&&!I[p1])return;let N;if(g==="message")N=function(C,n){let G=new Fg("message",{data:n?C:C.toString()});G[F1]=this,Sg($,this,G)};else if(g==="close")N=function(C,n){let G=new P1("close",{code:C,reason:n.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});G[F1]=this,Sg($,this,G)};else if(g==="error")N=function(C){let n=new o1("error",{error:C,message:C.message});n[F1]=this,Sg($,this,n)};else if(g==="open")N=function(){let C=new K1("open");C[F1]=this,Sg($,this,C)};else return;if(N[p1]=!!x[p1],N[m0]=$,x.once)this.once(g,N);else this.on(g,N)},removeEventListener(g,$){for(let x of this.listeners(g))if(x[m0]===$&&!x[p1]){this.removeListener(g,x);break}}};l2.exports={CloseEvent:P1,ErrorEvent:o1,Event:K1,EventTarget:P3,MessageEvent:Fg};function Sg(g,$,x){if(typeof g==="object"&&g.handleEvent)g.handleEvent.call(g,x);else g.call($,x)}});var S0=i((Z9,L2)=>{var{tokenChars:s1}=_1();function I1(g,$,x){if(g[$]===void 0)g[$]=[x];else g[$].push(x)}function u3(g){let $=Object.create(null),x=Object.create(null),N=!1,I=!1,C=!1,n,G,J=-1,Z=-1,z=-1,X=0;for(;X<g.length;X++)if(Z=g.charCodeAt(X),n===void 0)if(z===-1&&s1[Z]===1){if(J===-1)J=X}else if(X!==0&&(Z===32||Z===9)){if(z===-1&&J!==-1)z=X}else if(Z===59||Z===44){if(J===-1)throw SyntaxError(`Unexpected character at index ${X}`);if(z===-1)z=X;let R=g.slice(J,z);if(Z===44)I1($,R,x),x=Object.create(null);else n=R;J=z=-1}else throw SyntaxError(`Unexpected character at index ${X}`);else if(G===void 0)if(z===-1&&s1[Z]===1){if(J===-1)J=X}else if(Z===32||Z===9){if(z===-1&&J!==-1)z=X}else if(Z===59||Z===44){if(J===-1)throw SyntaxError(`Unexpected character at index ${X}`);if(z===-1)z=X;if(I1(x,g.slice(J,z),!0),Z===44)I1($,n,x),x=Object.create(null),n=void 0;J=z=-1}else if(Z===61&&J!==-1&&z===-1)G=g.slice(J,X),J=z=-1;else throw SyntaxError(`Unexpected character at index ${X}`);else if(I){if(s1[Z]!==1)throw SyntaxError(`Unexpected character at index ${X}`);if(J===-1)J=X;else if(!N)N=!0;I=!1}else if(C)if(s1[Z]===1){if(J===-1)J=X}else if(Z===34&&J!==-1)C=!1,z=X;else if(Z===92)I=!0;else throw SyntaxError(`Unexpected character at index ${X}`);else if(Z===34&&g.charCodeAt(X-1)===61)C=!0;else if(z===-1&&s1[Z]===1){if(J===-1)J=X}else if(J!==-1&&(Z===32||Z===9)){if(z===-1)z=X}else if(Z===59||Z===44){if(J===-1)throw SyntaxError(`Unexpected character at index ${X}`);if(z===-1)z=X;let R=g.slice(J,z);if(N)R=R.replace(/\\/g,""),N=!1;if(I1(x,G,R),Z===44)I1($,n,x),x=Object.create(null),n=void 0;G=void 0,J=z=-1}else throw SyntaxError(`Unexpected character at index ${X}`);if(J===-1||C||Z===32||Z===9)throw SyntaxError("Unexpected end of input");if(z===-1)z=X;let K=g.slice(J,z);if(n===void 0)I1($,K,x);else{if(G===void 0)I1(x,K,!0);else if(N)I1(x,G,K.replace(/\\/g,""));else I1(x,G,K);I1($,n,x)}return $}function W3(g){return Object.keys(g).map(($)=>{let x=g[$];if(!Array.isArray(x))x=[x];return x.map((N)=>{return[$].concat(Object.keys(N).map((I)=>{let C=N[I];if(!Array.isArray(C))C=[C];return C.map((n)=>n===!0?I:`${I}=${n}`).join("; ")})).join("; ")}).join(", ")}).join(", ")}L2.exports={format:W3,parse:u3}});var fg=i((z9,i2)=>{var f3=W("events"),v3=W("https"),y3=W("http"),S2=W("net"),E3=W("tls"),{randomBytes:i3,createHash:w3}=W("crypto"),{Duplex:Q9,Readable:X9}=W("stream"),{URL:F0}=W("url"),M1=k1(),d3=T0(),b3=_0(),{isBlob:c3}=_1(),{BINARY_TYPES:_2,CLOSE_TIMEOUT:h3,EMPTY_BUFFER:Pg,GUID:k3,kForOnEventAttribute:P0,kListener:p3,kStatusCode:o3,kWebSocket:f,NOOP:F2}=n1(),{EventTarget:{addEventListener:s3,removeEventListener:a3}}=T2(),{format:r3,parse:t3}=S0(),{toBuffer:e3}=c1(),P2=Symbol("kAborted"),u0=[8,13],Z1=["CONNECTING","OPEN","CLOSING","CLOSED"],g5=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class B extends f3{constructor(g,$,x){super();if(this._binaryType=_2[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Pg,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=B.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,g!==null){if(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,$===void 0)$=[];else if(!Array.isArray($))if(typeof $==="object"&&$!==null)x=$,$=[];else $=[$];u2(this,g,$,x)}else this._autoPong=x.autoPong,this._closeTimeout=x.closeTimeout,this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(g){if(!_2.includes(g))return;if(this._binaryType=g,this._receiver)this._receiver._binaryType=g}get bufferedAmount(){if(!this._socket)return this._bufferedAmount;return this._socket._writableState.length+this._sender._bufferedBytes}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(g,$,x){let N=new d3({allowSynchronousEvents:x.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:x.maxPayload,skipUTF8Validation:x.skipUTF8Validation}),I=new b3(g,this._extensions,x.generateMask);if(this._receiver=N,this._sender=I,this._socket=g,N[f]=this,I[f]=this,g[f]=this,N.on("conclude",N5),N.on("drain",I5),N.on("error",C5),N.on("message",G5),N.on("ping",n5),N.on("pong",J5),I.onerror=Z5,g.setTimeout)g.setTimeout(0);if(g.setNoDelay)g.setNoDelay();if($.length>0)g.unshift($);g.on("close",v2),g.on("data",Wg),g.on("end",y2),g.on("error",E2),this._readyState=B.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=B.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}if(this._extensions[M1.extensionName])this._extensions[M1.extensionName].cleanup();this._receiver.removeAllListeners(),this._readyState=B.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(g,$){if(this.readyState===B.CLOSED)return;if(this.readyState===B.CONNECTING){c(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===B.CLOSING){if(this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted))this._socket.end();return}this._readyState=B.CLOSING,this._sender.close(g,$,!this._isServer,(x)=>{if(x)return;if(this._closeFrameSent=!0,this._closeFrameReceived||this._receiver._writableState.errorEmitted)this._socket.end()}),f2(this)}pause(){if(this.readyState===B.CONNECTING||this.readyState===B.CLOSED)return;this._paused=!0,this._socket.pause()}ping(g,$,x){if(this.readyState===B.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof g==="function")x=g,g=$=void 0;else if(typeof $==="function")x=$,$=void 0;if(typeof g==="number")g=g.toString();if(this.readyState!==B.OPEN){W0(this,g,x);return}if($===void 0)$=!this._isServer;this._sender.ping(g||Pg,$,x)}pong(g,$,x){if(this.readyState===B.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof g==="function")x=g,g=$=void 0;else if(typeof $==="function")x=$,$=void 0;if(typeof g==="number")g=g.toString();if(this.readyState!==B.OPEN){W0(this,g,x);return}if($===void 0)$=!this._isServer;this._sender.pong(g||Pg,$,x)}resume(){if(this.readyState===B.CONNECTING||this.readyState===B.CLOSED)return;if(this._paused=!1,!this._receiver._writableState.needDrain)this._socket.resume()}send(g,$,x){if(this.readyState===B.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof $==="function")x=$,$={};if(typeof g==="number")g=g.toString();if(this.readyState!==B.OPEN){W0(this,g,x);return}let N={binary:typeof g!=="string",mask:!this._isServer,compress:!0,fin:!0,...$};if(!this._extensions[M1.extensionName])N.compress=!1;this._sender.send(g||Pg,N,x)}terminate(){if(this.readyState===B.CLOSED)return;if(this.readyState===B.CONNECTING){c(this,this._req,"WebSocket was closed before the connection was established");return}if(this._socket)this._readyState=B.CLOSING,this._socket.destroy()}}Object.defineProperty(B,"CONNECTING",{enumerable:!0,value:Z1.indexOf("CONNECTING")});Object.defineProperty(B.prototype,"CONNECTING",{enumerable:!0,value:Z1.indexOf("CONNECTING")});Object.defineProperty(B,"OPEN",{enumerable:!0,value:Z1.indexOf("OPEN")});Object.defineProperty(B.prototype,"OPEN",{enumerable:!0,value:Z1.indexOf("OPEN")});Object.defineProperty(B,"CLOSING",{enumerable:!0,value:Z1.indexOf("CLOSING")});Object.defineProperty(B.prototype,"CLOSING",{enumerable:!0,value:Z1.indexOf("CLOSING")});Object.defineProperty(B,"CLOSED",{enumerable:!0,value:Z1.indexOf("CLOSED")});Object.defineProperty(B.prototype,"CLOSED",{enumerable:!0,value:Z1.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((g)=>{Object.defineProperty(B.prototype,g,{enumerable:!0})});["open","error","close","message"].forEach((g)=>{Object.defineProperty(B.prototype,`on${g}`,{enumerable:!0,get(){for(let $ of this.listeners(g))if($[P0])return $[p3];return null},set($){for(let x of this.listeners(g))if(x[P0]){this.removeListener(g,x);break}if(typeof $!=="function")return;this.addEventListener(g,$,{[P0]:!0})}})});B.prototype.addEventListener=s3;B.prototype.removeEventListener=a3;i2.exports=B;function u2(g,$,x,N){let I={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:h3,protocolVersion:u0[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...N,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(g._autoPong=I.autoPong,g._closeTimeout=I.closeTimeout,!u0.includes(I.protocolVersion))throw RangeError(`Unsupported protocol version: ${I.protocolVersion} (supported versions: ${u0.join(", ")})`);let C;if($ instanceof F0)C=$;else try{C=new F0($)}catch(Q){throw SyntaxError(`Invalid URL: ${$}`)}if(C.protocol==="http:")C.protocol="ws:";else if(C.protocol==="https:")C.protocol="wss:";g._url=C.href;let n=C.protocol==="wss:",G=C.protocol==="ws+unix:",J;if(C.protocol!=="ws:"&&!n&&!G)J=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`;else if(G&&!C.pathname)J="The URL's pathname is empty";else if(C.hash)J="The URL contains a fragment identifier";if(J){let Q=SyntaxError(J);if(g._redirects===0)throw Q;else{ug(g,Q);return}}let Z=n?443:80,z=i3(16).toString("base64"),X=n?v3.request:y3.request,K=new Set,R;if(I.createConnection=I.createConnection||(n?x5:$5),I.defaultPort=I.defaultPort||Z,I.port=C.port||Z,I.host=C.hostname.startsWith("[")?C.hostname.slice(1,-1):C.hostname,I.headers={...I.headers,"Sec-WebSocket-Version":I.protocolVersion,"Sec-WebSocket-Key":z,Connection:"Upgrade",Upgrade:"websocket"},I.path=C.pathname+C.search,I.timeout=I.handshakeTimeout,I.perMessageDeflate)R=new M1(I.perMessageDeflate!==!0?I.perMessageDeflate:{},!1,I.maxPayload),I.headers["Sec-WebSocket-Extensions"]=r3({[M1.extensionName]:R.offer()});if(x.length){for(let Q of x){if(typeof Q!=="string"||!g5.test(Q)||K.has(Q))throw SyntaxError("An invalid or duplicated subprotocol was specified");K.add(Q)}I.headers["Sec-WebSocket-Protocol"]=x.join(",")}if(I.origin)if(I.protocolVersion<13)I.headers["Sec-WebSocket-Origin"]=I.origin;else I.headers.Origin=I.origin;if(C.username||C.password)I.auth=`${C.username}:${C.password}`;if(G){let Q=I.path.split(":");I.socketPath=Q[0],I.path=Q[1]}let j;if(I.followRedirects){if(g._redirects===0){g._originalIpc=G,g._originalSecure=n,g._originalHostOrSocketPath=G?I.socketPath:C.host;let Q=N&&N.headers;if(N={...N,headers:{}},Q)for(let[Y,V]of Object.entries(Q))N.headers[Y.toLowerCase()]=V}else if(g.listenerCount("redirect")===0){let Q=G?g._originalIpc?I.socketPath===g._originalHostOrSocketPath:!1:g._originalIpc?!1:C.host===g._originalHostOrSocketPath;if(!Q||g._originalSecure&&!n){if(delete I.headers.authorization,delete I.headers.cookie,!Q)delete I.headers.host;I.auth=void 0}}if(I.auth&&!N.headers.authorization)N.headers.authorization="Basic "+Buffer.from(I.auth).toString("base64");if(j=g._req=X(I),g._redirects)g.emit("redirect",g.url,j)}else j=g._req=X(I);if(I.timeout)j.on("timeout",()=>{c(g,j,"Opening handshake has timed out")});if(j.on("error",(Q)=>{if(j===null||j[P2])return;j=g._req=null,ug(g,Q)}),j.on("response",(Q)=>{let Y=Q.headers.location,V=Q.statusCode;if(Y&&I.followRedirects&&V>=300&&V<400){if(++g._redirects>I.maxRedirects){c(g,j,"Maximum redirects exceeded");return}j.abort();let A;try{A=new F0(Y,$)}catch(D){let l=SyntaxError(`Invalid URL: ${Y}`);ug(g,l);return}u2(g,A,x,N)}else if(!g.emit("unexpected-response",j,Q))c(g,j,`Unexpected server response: ${Q.statusCode}`)}),j.on("upgrade",(Q,Y,V)=>{if(g.emit("upgrade",Q),g.readyState!==B.CONNECTING)return;j=g._req=null;let A=Q.headers.upgrade;if(A===void 0||A.toLowerCase()!=="websocket"){c(g,Y,"Invalid Upgrade header");return}let D=w3("sha1").update(z+k3).digest("base64");if(Q.headers["sec-websocket-accept"]!==D){c(g,Y,"Invalid Sec-WebSocket-Accept header");return}let l=Q.headers["sec-websocket-protocol"],q;if(l!==void 0){if(!K.size)q="Server sent a subprotocol but none was requested";else if(!K.has(l))q="Server sent an invalid subprotocol"}else if(K.size)q="Server sent no subprotocol";if(q){c(g,Y,q);return}if(l)g._protocol=l;let L=Q.headers["sec-websocket-extensions"];if(L!==void 0){if(!R){c(g,Y,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let O;try{O=t3(L)}catch(u){c(g,Y,"Invalid Sec-WebSocket-Extensions header");return}let H=Object.keys(O);if(H.length!==1||H[0]!==M1.extensionName){c(g,Y,"Server indicated an extension that was not requested");return}try{R.accept(O[M1.extensionName])}catch(u){c(g,Y,"Invalid Sec-WebSocket-Extensions header");return}g._extensions[M1.extensionName]=R}g.setSocket(Y,V,{allowSynchronousEvents:I.allowSynchronousEvents,generateMask:I.generateMask,maxPayload:I.maxPayload,skipUTF8Validation:I.skipUTF8Validation})}),I.finishRequest)I.finishRequest(j,g);else j.end()}function ug(g,$){g._readyState=B.CLOSING,g._errorEmitted=!0,g.emit("error",$),g.emitClose()}function $5(g){return g.path=g.socketPath,S2.connect(g)}function x5(g){if(g.path=void 0,!g.servername&&g.servername!=="")g.servername=S2.isIP(g.host)?"":g.host;return E3.connect(g)}function c(g,$,x){g._readyState=B.CLOSING;let N=Error(x);if(Error.captureStackTrace(N,c),$.setHeader){if($[P2]=!0,$.abort(),$.socket&&!$.socket.destroyed)$.socket.destroy();process.nextTick(ug,g,N)}else $.destroy(N),$.once("error",g.emit.bind(g,"error")),$.once("close",g.emitClose.bind(g))}function W0(g,$,x){if($){let N=c3($)?$.size:e3($).length;if(g._socket)g._sender._bufferedBytes+=N;else g._bufferedAmount+=N}if(x){let N=Error(`WebSocket is not open: readyState ${g.readyState} (${Z1[g.readyState]})`);process.nextTick(x,N)}}function N5(g,$){let x=this[f];if(x._closeFrameReceived=!0,x._closeMessage=$,x._closeCode=g,x._socket[f]===void 0)return;if(x._socket.removeListener("data",Wg),process.nextTick(W2,x._socket),g===1005)x.close();else x.close(g,$)}function I5(){let g=this[f];if(!g.isPaused)g._socket.resume()}function C5(g){let $=this[f];if($._socket[f]!==void 0)$._socket.removeListener("data",Wg),process.nextTick(W2,$._socket),$.close(g[o3]);if(!$._errorEmitted)$._errorEmitted=!0,$.emit("error",g)}function m2(){this[f].emitClose()}function G5(g,$){this[f].emit("message",g,$)}function n5(g){let $=this[f];if($._autoPong)$.pong(g,!this._isServer,F2);$.emit("ping",g)}function J5(g){this[f].emit("pong",g)}function W2(g){g.resume()}function Z5(g){let $=this[f];if($.readyState===B.CLOSED)return;if($.readyState===B.OPEN)$._readyState=B.CLOSING,f2($);if(this._socket.end(),!$._errorEmitted)$._errorEmitted=!0,$.emit("error",g)}function f2(g){g._closeTimer=setTimeout(g._socket.destroy.bind(g._socket),g._closeTimeout)}function v2(){let g=this[f];if(this.removeListener("close",v2),this.removeListener("data",Wg),this.removeListener("end",y2),g._readyState=B.CLOSING,!this._readableState.endEmitted&&!g._closeFrameReceived&&!g._receiver._writableState.errorEmitted&&this._readableState.length!==0){let $=this.read(this._readableState.length);g._receiver.write($)}if(g._receiver.end(),this[f]=void 0,clearTimeout(g._closeTimer),g._receiver._writableState.finished||g._receiver._writableState.errorEmitted)g.emitClose();else g._receiver.on("error",m2),g._receiver.on("finish",m2)}function Wg(g){if(!this[f]._receiver.write(g))this.pause()}function y2(){let g=this[f];g._readyState=B.CLOSING,g._receiver.end(),this.end()}function E2(){let g=this[f];if(this.removeListener("error",E2),this.on("error",F2),g)g._readyState=B.CLOSING,this.destroy()}});var c2=i((K9,b2)=>{var j9=fg(),{Duplex:Q5}=W("stream");function w2(g){g.emit("close")}function X5(){if(!this.destroyed&&this._writableState.finished)this.destroy()}function d2(g){if(this.removeListener("error",d2),this.destroy(),this.listenerCount("error")===0)this.emit("error",g)}function z5(g,$){let x=!0,N=new Q5({...$,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return g.on("message",function(C,n){let G=!n&&N._readableState.objectMode?C.toString():C;if(!N.push(G))g.pause()}),g.once("error",function(C){if(N.destroyed)return;x=!1,N.destroy(C)}),g.once("close",function(){if(N.destroyed)return;N.push(null)}),N._destroy=function(I,C){if(g.readyState===g.CLOSED){C(I),process.nextTick(w2,N);return}let n=!1;if(g.once("error",function(J){n=!0,C(J)}),g.once("close",function(){if(!n)C(I);process.nextTick(w2,N)}),x)g.terminate()},N._final=function(I){if(g.readyState===g.CONNECTING){g.once("open",function(){N._final(I)});return}if(g._socket===null)return;if(g._socket._writableState.finished){if(I(),N._readableState.endEmitted)N.destroy()}else g._socket.once("finish",function(){I()}),g.close()},N._read=function(){if(g.isPaused)g.resume()},N._write=function(I,C,n){if(g.readyState===g.CONNECTING){g.once("open",function(){N._write(I,C,n)});return}g.send(I,n)},N.on("end",X5),N.on("error",d2),N}b2.exports=z5});var k2=i((M9,h2)=>{var{tokenChars:j5}=_1();function K5(g){let $=new Set,x=-1,N=-1,I=0;for(I;I<g.length;I++){let n=g.charCodeAt(I);if(N===-1&&j5[n]===1){if(x===-1)x=I}else if(I!==0&&(n===32||n===9)){if(N===-1&&x!==-1)N=I}else if(n===44){if(x===-1)throw SyntaxError(`Unexpected character at index ${I}`);if(N===-1)N=I;let G=g.slice(x,N);if($.has(G))throw SyntaxError(`The "${G}" subprotocol is duplicated`);$.add(G),x=N=-1}else throw SyntaxError(`Unexpected character at index ${I}`)}if(x===-1||N!==-1)throw SyntaxError("Unexpected end of input");let C=g.slice(x,I);if($.has(C))throw SyntaxError(`The "${C}" subprotocol is duplicated`);return $.add(C),$}h2.exports={parse:K5}});var r2=i((R9,a2)=>{var M5=W("events"),vg=W("http"),{Duplex:Y9}=W("stream"),{createHash:Y5}=W("crypto"),p2=S0(),U1=k1(),R5=k2(),O5=fg(),{CLOSE_TIMEOUT:H5,GUID:V5,kWebSocket:A5}=n1(),U5=/^[+/0-9A-Za-z]{22}==$/;class s2 extends M5{constructor(g,$){super();if(g={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:H5,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:O5,...g},g.port==null&&!g.server&&!g.noServer||g.port!=null&&(g.server||g.noServer)||g.server&&g.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(g.port!=null)this._server=vg.createServer((x,N)=>{let I=vg.STATUS_CODES[426];N.writeHead(426,{"Content-Length":I.length,"Content-Type":"text/plain"}),N.end(I)}),this._server.listen(g.port,g.host,g.backlog,$);else if(g.server)this._server=g.server;if(this._server){let x=this.emit.bind(this,"connection");this._removeListeners=D5(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(N,I,C)=>{this.handleUpgrade(N,I,C,x)}})}if(g.perMessageDeflate===!0)g.perMessageDeflate={};if(g.clientTracking)this.clients=new Set,this._shouldEmitClose=!1;this.options=g,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');if(!this._server)return null;return this._server.address()}close(g){if(this._state===2){if(g)this.once("close",()=>{g(Error("The server is not running"))});process.nextTick(a1,this);return}if(g)this.once("close",g);if(this._state===1)return;if(this._state=1,this.options.noServer||this.options.server){if(this._server)this._removeListeners(),this._removeListeners=this._server=null;if(this.clients)if(!this.clients.size)process.nextTick(a1,this);else this._shouldEmitClose=!0;else process.nextTick(a1,this)}else{let $=this._server;this._removeListeners(),this._removeListeners=this._server=null,$.close(()=>{a1(this)})}}shouldHandle(g){if(this.options.path){let $=g.url.indexOf("?");if(($!==-1?g.url.slice(0,$):g.url)!==this.options.path)return!1}return!0}handleUpgrade(g,$,x,N){$.on("error",o2);let I=g.headers["sec-websocket-key"],C=g.headers.upgrade,n=+g.headers["sec-websocket-version"];if(g.method!=="GET"){D1(this,g,$,405,"Invalid HTTP method");return}if(C===void 0||C.toLowerCase()!=="websocket"){D1(this,g,$,400,"Invalid Upgrade header");return}if(I===void 0||!U5.test(I)){D1(this,g,$,400,"Missing or invalid Sec-WebSocket-Key header");return}if(n!==13&&n!==8){D1(this,g,$,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(g)){r1($,400);return}let G=g.headers["sec-websocket-protocol"],J=new Set;if(G!==void 0)try{J=R5.parse(G)}catch(X){D1(this,g,$,400,"Invalid Sec-WebSocket-Protocol header");return}let Z=g.headers["sec-websocket-extensions"],z={};if(this.options.perMessageDeflate&&Z!==void 0){let X=new U1(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let K=p2.parse(Z);if(K[U1.extensionName])X.accept(K[U1.extensionName]),z[U1.extensionName]=X}catch(K){D1(this,g,$,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let X={origin:g.headers[`${n===8?"sec-websocket-origin":"origin"}`],secure:!!(g.socket.authorized||g.socket.encrypted),req:g};if(this.options.verifyClient.length===2){this.options.verifyClient(X,(K,R,j,Q)=>{if(!K)return r1($,R||401,j,Q);this.completeUpgrade(z,I,J,g,$,x,N)});return}if(!this.options.verifyClient(X))return r1($,401)}this.completeUpgrade(z,I,J,g,$,x,N)}completeUpgrade(g,$,x,N,I,C,n){if(!I.readable||!I.writable)return I.destroy();if(I[A5])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return r1(I,503);let J=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Y5("sha1").update($+V5).digest("base64")}`],Z=new this.options.WebSocket(null,void 0,this.options);if(x.size){let z=this.options.handleProtocols?this.options.handleProtocols(x,N):x.values().next().value;if(z)J.push(`Sec-WebSocket-Protocol: ${z}`),Z._protocol=z}if(g[U1.extensionName]){let z=g[U1.extensionName].params,X=p2.format({[U1.extensionName]:[z]});J.push(`Sec-WebSocket-Extensions: ${X}`),Z._extensions=g}if(this.emit("headers",J,N),I.write(J.concat(`\r
`).join(`\r
`)),I.removeListener("error",o2),Z.setSocket(I,C,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients)this.clients.add(Z),Z.on("close",()=>{if(this.clients.delete(Z),this._shouldEmitClose&&!this.clients.size)process.nextTick(a1,this)});n(Z,N)}}a2.exports=s2;function D5(g,$){for(let x of Object.keys($))g.on(x,$[x]);return function(){for(let N of Object.keys($))g.removeListener(N,$[N])}}function a1(g){g._state=2,g.emit("close")}function o2(){this.destroy()}function r1(g,$,x,N){x=x||vg.STATUS_CODES[$],N={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(x),...N},g.once("finish",g.destroy),g.end(`HTTP/1.1 ${$} ${vg.STATUS_CODES[$]}\r
`+Object.keys(N).map((I)=>`${I}: ${N[I]}`).join(`\r
`)+`\r
\r
`+x)}function D1(g,$,x,N,I,C){if(g.listenerCount("wsClientError")){let n=Error(I);Error.captureStackTrace(n,D1),g.emit("wsClientError",n,x,$)}else r1(x,N,I,C)}});var Zg=p(q1(),1),w=p(hg(),1);import{stdout as rg,stdin as g$}from"node:process";import*as X1 from"node:readline";import Rx from"node:readline";import{ReadStream as a0}from"node:tty";var Ox=(g)=>g===161||g===164||g===167||g===168||g===170||g===173||g===174||g>=176&&g<=180||g>=182&&g<=186||g>=188&&g<=191||g===198||g===208||g===215||g===216||g>=222&&g<=225||g===230||g>=232&&g<=234||g===236||g===237||g===240||g===242||g===243||g>=247&&g<=250||g===252||g===254||g===257||g===273||g===275||g===283||g===294||g===295||g===299||g>=305&&g<=307||g===312||g>=319&&g<=322||g===324||g>=328&&g<=331||g===333||g===338||g===339||g===358||g===359||g===363||g===462||g===464||g===466||g===468||g===470||g===472||g===474||g===476||g===593||g===609||g===708||g===711||g>=713&&g<=715||g===717||g===720||g>=728&&g<=731||g===733||g===735||g>=768&&g<=879||g>=913&&g<=929||g>=931&&g<=937||g>=945&&g<=961||g>=963&&g<=969||g===1025||g>=1040&&g<=1103||g===1105||g===8208||g>=8211&&g<=8214||g===8216||g===8217||g===8220||g===8221||g>=8224&&g<=8226||g>=8228&&g<=8231||g===8240||g===8242||g===8243||g===8245||g===8251||g===8254||g===8308||g===8319||g>=8321&&g<=8324||g===8364||g===8451||g===8453||g===8457||g===8467||g===8470||g===8481||g===8482||g===8486||g===8491||g===8531||g===8532||g>=8539&&g<=8542||g>=8544&&g<=8555||g>=8560&&g<=8569||g===8585||g>=8592&&g<=8601||g===8632||g===8633||g===8658||g===8660||g===8679||g===8704||g===8706||g===8707||g===8711||g===8712||g===8715||g===8719||g===8721||g===8725||g===8730||g>=8733&&g<=8736||g===8739||g===8741||g>=8743&&g<=8748||g===8750||g>=8756&&g<=8759||g===8764||g===8765||g===8776||g===8780||g===8786||g===8800||g===8801||g>=8804&&g<=8807||g===8810||g===8811||g===8814||g===8815||g===8834||g===8835||g===8838||g===8839||g===8853||g===8857||g===8869||g===8895||g===8978||g>=9312&&g<=9449||g>=9451&&g<=9547||g>=9552&&g<=9587||g>=9600&&g<=9615||g>=9618&&g<=9621||g===9632||g===9633||g>=9635&&g<=9641||g===9650||g===9651||g===9654||g===9655||g===9660||g===9661||g===9664||g===9665||g>=9670&&g<=9672||g===9675||g>=9678&&g<=9681||g>=9698&&g<=9701||g===9711||g===9733||g===9734||g===9737||g===9742||g===9743||g===9756||g===9758||g===9792||g===9794||g===9824||g===9825||g>=9827&&g<=9829||g>=9831&&g<=9834||g===9836||g===9837||g===9839||g===9886||g===9887||g===9919||g>=9926&&g<=9933||g>=9935&&g<=9939||g>=9941&&g<=9953||g===9955||g===9960||g===9961||g>=9963&&g<=9969||g===9972||g>=9974&&g<=9977||g===9979||g===9980||g===9982||g===9983||g===10045||g>=10102&&g<=10111||g>=11094&&g<=11097||g>=12872&&g<=12879||g>=57344&&g<=63743||g>=65024&&g<=65039||g===65533||g>=127232&&g<=127242||g>=127248&&g<=127277||g>=127280&&g<=127337||g>=127344&&g<=127373||g===127375||g===127376||g>=127387&&g<=127404||g>=917760&&g<=917999||g>=983040&&g<=1048573||g>=1048576&&g<=1114109,Hx=(g)=>g===12288||g>=65281&&g<=65376||g>=65504&&g<=65510,Vx=(g)=>g>=4352&&g<=4447||g===8986||g===8987||g===9001||g===9002||g>=9193&&g<=9196||g===9200||g===9203||g===9725||g===9726||g===9748||g===9749||g>=9800&&g<=9811||g===9855||g===9875||g===9889||g===9898||g===9899||g===9917||g===9918||g===9924||g===9925||g===9934||g===9940||g===9962||g===9970||g===9971||g===9973||g===9978||g===9981||g===9989||g===9994||g===9995||g===10024||g===10060||g===10062||g>=10067&&g<=10069||g===10071||g>=10133&&g<=10135||g===10160||g===10175||g===11035||g===11036||g===11088||g===11093||g>=11904&&g<=11929||g>=11931&&g<=12019||g>=12032&&g<=12245||g>=12272&&g<=12287||g>=12289&&g<=12350||g>=12353&&g<=12438||g>=12441&&g<=12543||g>=12549&&g<=12591||g>=12593&&g<=12686||g>=12688&&g<=12771||g>=12783&&g<=12830||g>=12832&&g<=12871||g>=12880&&g<=19903||g>=19968&&g<=42124||g>=42128&&g<=42182||g>=43360&&g<=43388||g>=44032&&g<=55203||g>=63744&&g<=64255||g>=65040&&g<=65049||g>=65072&&g<=65106||g>=65108&&g<=65126||g>=65128&&g<=65131||g>=94176&&g<=94180||g===94192||g===94193||g>=94208&&g<=100343||g>=100352&&g<=101589||g>=101632&&g<=101640||g>=110576&&g<=110579||g>=110581&&g<=110587||g===110589||g===110590||g>=110592&&g<=110882||g===110898||g>=110928&&g<=110930||g===110933||g>=110948&&g<=110951||g>=110960&&g<=111355||g===126980||g===127183||g===127374||g>=127377&&g<=127386||g>=127488&&g<=127490||g>=127504&&g<=127547||g>=127552&&g<=127560||g===127568||g===127569||g>=127584&&g<=127589||g>=127744&&g<=127776||g>=127789&&g<=127797||g>=127799&&g<=127868||g>=127870&&g<=127891||g>=127904&&g<=127946||g>=127951&&g<=127955||g>=127968&&g<=127984||g===127988||g>=127992&&g<=128062||g===128064||g>=128066&&g<=128252||g>=128255&&g<=128317||g>=128331&&g<=128334||g>=128336&&g<=128359||g===128378||g===128405||g===128406||g===128420||g>=128507&&g<=128591||g>=128640&&g<=128709||g===128716||g>=128720&&g<=128722||g>=128725&&g<=128727||g>=128732&&g<=128735||g===128747||g===128748||g>=128756&&g<=128764||g>=128992&&g<=129003||g===129008||g>=129292&&g<=129338||g>=129340&&g<=129349||g>=129351&&g<=129535||g>=129648&&g<=129660||g>=129664&&g<=129672||g>=129680&&g<=129725||g>=129727&&g<=129733||g>=129742&&g<=129755||g>=129760&&g<=129768||g>=129776&&g<=129784||g>=131072&&g<=196605||g>=196608&&g<=262141,kg=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/y,Cg=/[\x00-\x08\x0A-\x1F\x7F-\x9F]{1,1000}/y,Gg=/\t{1,1000}/y,pg=/[\u{1F1E6}-\u{1F1FF}]{2}|\u{1F3F4}[\u{E0061}-\u{E007A}]{2}[\u{E0030}-\u{E0039}\u{E0061}-\u{E007A}]{1,3}\u{E007F}|(?:\p{Emoji}\uFE0F\u20E3?|\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation})(?:\u200D(?:\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F\u20E3?))*/yu,ng=/(?:[\x20-\x7E\xA0-\xFF](?!\uFE0F)){1,1000}/y,Ax=/\p{M}+/gu,Ux={limit:1/0,ellipsis:""},$$=(g,$={},x={})=>{let N=$.limit??1/0,I=$.ellipsis??"",C=$?.ellipsisWidth??(I?$$(I,Ux,x).width:0),n=x.ansiWidth??0,G=x.controlWidth??0,J=x.tabWidth??8,Z=x.ambiguousWidth??1,z=x.emojiWidth??2,X=x.fullWidthWidth??2,K=x.regularWidth??1,R=x.wideWidth??2,j=0,Q=0,Y=g.length,V=0,A=!1,D=Y,l=Math.max(0,N-C),q=0,L=0,O=0,H=0;g:for(;;){if(L>q||Q>=Y&&Q>j){let u=g.slice(q,L)||g.slice(j,Q);V=0;for(let E of u.replaceAll(Ax,"")){let d=E.codePointAt(0)||0;if(Hx(d)?H=X:Vx(d)?H=R:Z!==K&&Ox(d)?H=Z:H=K,O+H>l&&(D=Math.min(D,Math.max(q,j)+V)),O+H>N){A=!0;break g}V+=E.length,O+=H}q=L=0}if(Q>=Y)break;if(ng.lastIndex=Q,ng.test(g)){if(V=ng.lastIndex-Q,H=V*K,O+H>l&&(D=Math.min(D,Q+Math.floor((l-O)/K))),O+H>N){A=!0;break}O+=H,q=j,L=Q,Q=j=ng.lastIndex;continue}if(kg.lastIndex=Q,kg.test(g)){if(O+n>l&&(D=Math.min(D,Q)),O+n>N){A=!0;break}O+=n,q=j,L=Q,Q=j=kg.lastIndex;continue}if(Cg.lastIndex=Q,Cg.test(g)){if(V=Cg.lastIndex-Q,H=V*G,O+H>l&&(D=Math.min(D,Q+Math.floor((l-O)/G))),O+H>N){A=!0;break}O+=H,q=j,L=Q,Q=j=Cg.lastIndex;continue}if(Gg.lastIndex=Q,Gg.test(g)){if(V=Gg.lastIndex-Q,H=V*J,O+H>l&&(D=Math.min(D,Q+Math.floor((l-O)/J))),O+H>N){A=!0;break}O+=H,q=j,L=Q,Q=j=Gg.lastIndex;continue}if(pg.lastIndex=Q,pg.test(g)){if(O+z>l&&(D=Math.min(D,Q)),O+z>N){A=!0;break}O+=z,q=j,L=Q,Q=j=pg.lastIndex;continue}Q+=1}return{width:A?l:O,index:A?D:Y,truncated:A,ellipsed:A&&N>=C}},Dx={limit:1/0,ellipsis:"",ellipsisWidth:0},u1=(g,$={})=>$$(g,Dx,$).width,Qg="\x1B",x$="",qx=39,tg="\x07",N$="[",Bx="]",I$="m",eg=`${Bx}8;;`,r0=new RegExp(`(?:\\${N$}(?<code>\\d+)m|\\${eg}(?<uri>.*)${tg})`,"y"),lx=(g)=>{if(g>=30&&g<=37||g>=90&&g<=97)return 39;if(g>=40&&g<=47||g>=100&&g<=107)return 49;if(g===1||g===2)return 22;if(g===3)return 23;if(g===4)return 24;if(g===7)return 27;if(g===8)return 28;if(g===9)return 29;if(g===0)return 0},t0=(g)=>`${Qg}${N$}${g}${I$}`,e0=(g)=>`${Qg}${eg}${g}${tg}`,Tx=(g)=>g.map(($)=>u1($)),og=(g,$,x)=>{let N=$[Symbol.iterator](),I=!1,C=!1,n=g.at(-1),G=n===void 0?0:u1(n),J=N.next(),Z=N.next(),z=0;for(;!J.done;){let X=J.value,K=u1(X);G+K<=x?g[g.length-1]+=X:(g.push(X),G=0),(X===Qg||X===x$)&&(I=!0,C=$.startsWith(eg,z+1)),I?C?X===tg&&(I=!1,C=!1):X===I$&&(I=!1):(G+=K,G===x&&!Z.done&&(g.push(""),G=0)),J=Z,Z=N.next(),z+=X.length}n=g.at(-1),!G&&n!==void 0&&n.length>0&&g.length>1&&(g[g.length-2]+=g.pop())},Lx=(g)=>{let $=g.split(" "),x=$.length;for(;x>0&&!(u1($[x-1])>0);)x--;return x===$.length?g:$.slice(0,x).join(" ")+$.slice(x).join("")},_x=(g,$,x={})=>{if(x.trim!==!1&&g.trim()==="")return"";let N="",I,C,n=g.split(" "),G=Tx(n),J=[""];for(let[j,Q]of n.entries()){x.trim!==!1&&(J[J.length-1]=(J.at(-1)??"").trimStart());let Y=u1(J.at(-1)??"");if(j!==0&&(Y>=$&&(x.wordWrap===!1||x.trim===!1)&&(J.push(""),Y=0),(Y>0||x.trim===!1)&&(J[J.length-1]+=" ",Y++)),x.hard&&G[j]>$){let V=$-Y,A=1+Math.floor((G[j]-V-1)/$);Math.floor((G[j]-1)/$)<A&&J.push(""),og(J,Q,$);continue}if(Y+G[j]>$&&Y>0&&G[j]>0){if(x.wordWrap===!1&&Y<$){og(J,Q,$);continue}J.push("")}if(Y+G[j]>$&&x.wordWrap===!1){og(J,Q,$);continue}J[J.length-1]+=Q}x.trim!==!1&&(J=J.map((j)=>Lx(j)));let Z=J.join(`
`),z=Z[Symbol.iterator](),X=z.next(),K=z.next(),R=0;for(;!X.done;){let j=X.value,Q=K.value;if(N+=j,j===Qg||j===x$){r0.lastIndex=R+1;let V=r0.exec(Z)?.groups;if(V?.code!==void 0){let A=Number.parseFloat(V.code);I=A===qx?void 0:A}else V?.uri!==void 0&&(C=V.uri.length===0?void 0:V.uri)}let Y=I?lx(I):void 0;Q===`
`?(C&&(N+=e0("")),I&&Y&&(N+=t0(Y))):j===`
`&&(I&&Y&&(N+=t0(I)),C&&(N+=e0(C))),R+=j.length,X=K,K=z.next()}return N};function sg(g,$,x){return String(g).normalize().replaceAll(`\r
`,`
`).split(`
`).map((N)=>_x(N,$,x)).join(`
`)}var mx=["up","down","left","right","space","enter","cancel"],$1={actions:new Set(mx),aliases:new Map([["k","up"],["j","down"],["h","left"],["l","right"],["\x03","cancel"],["escape","cancel"]]),messages:{cancel:"Canceled",error:"Something went wrong"},withGuide:!0};function g0(g,$){if(typeof g=="string")return $1.aliases.get(g)===$;for(let x of g)if(x!==void 0&&g0(x,$))return!0;return!1}function Sx(g,$){if(g===$)return;let x=g.split(`
`),N=$.split(`
`),I=Math.max(x.length,N.length),C=[];for(let n=0;n<I;n++)x[n]!==N[n]&&C.push(n);return{lines:C,numLinesBefore:x.length,numLinesAfter:N.length,numLines:I}}var Fx=globalThis.process.platform.startsWith("win"),ag=Symbol("clack:cancel");function W1(g){return g===ag}function Jg(g,$){let x=g;x.isTTY&&x.setRawMode($)}function C$({input:g=g$,output:$=rg,overwrite:x=!0,hideCursor:N=!0}={}){let I=X1.createInterface({input:g,output:$,prompt:"",tabSize:1});X1.emitKeypressEvents(g,I),g instanceof a0&&g.isTTY&&g.setRawMode(!0);let C=(n,{name:G,sequence:J})=>{let Z=String(n);if(g0([Z,G,J],"cancel")){N&&$.write(w.cursor.show),process.exit(0);return}if(!x)return;X1.moveCursor($,G==="return"?0:-1,G==="return"?-1:0,()=>{X1.clearLine($,1,()=>{g.once("keypress",C)})})};return N&&$.write(w.cursor.hide),g.once("keypress",C),()=>{g.off("keypress",C),N&&$.write(w.cursor.show),g instanceof a0&&g.isTTY&&!Fx&&g.setRawMode(!1),I.terminal=!1,I.close()}}var f1=(g)=>("columns"in g)&&typeof g.columns=="number"?g.columns:80,$0=(g)=>("rows"in g)&&typeof g.rows=="number"?g.rows:20;function O1(g,$,x,N=x){let I=f1(g??rg);return sg($,I-x.length,{hard:!0,trim:!1}).split(`
`).map((C,n)=>`${n===0?N:x}${C}`).join(`
`)}class v1{input;output;_abortSignal;rl;opts;_render;_track=!1;_prevFrame="";_subscribers=new Map;_cursor=0;state="initial";error="";value;userInput="";constructor(g,$=!0){let{input:x=g$,output:N=rg,render:I,signal:C,...n}=g;this.opts=n,this.onKeypress=this.onKeypress.bind(this),this.close=this.close.bind(this),this.render=this.render.bind(this),this._render=I.bind(this),this._track=$,this._abortSignal=C,this.input=x,this.output=N}unsubscribe(){this._subscribers.clear()}setSubscriber(g,$){let x=this._subscribers.get(g)??[];x.push($),this._subscribers.set(g,x)}on(g,$){this.setSubscriber(g,{cb:$})}once(g,$){this.setSubscriber(g,{cb:$,once:!0})}emit(g,...$){let x=this._subscribers.get(g)??[],N=[];for(let I of x)I.cb(...$),I.once&&N.push(()=>x.splice(x.indexOf(I),1));for(let I of N)I()}prompt(){return new Promise((g)=>{if(this._abortSignal){if(this._abortSignal.aborted)return this.state="cancel",this.close(),g(ag);this._abortSignal.addEventListener("abort",()=>{this.state="cancel",this.close()},{once:!0})}this.rl=Rx.createInterface({input:this.input,tabSize:2,prompt:"",escapeCodeTimeout:50,terminal:!0}),this.rl.prompt(),this.opts.initialUserInput!==void 0&&this._setUserInput(this.opts.initialUserInput,!0),this.input.on("keypress",this.onKeypress),Jg(this.input,!0),this.output.on("resize",this.render),this.render(),this.once("submit",()=>{this.output.write(w.cursor.show),this.output.off("resize",this.render),Jg(this.input,!1),g(this.value)}),this.once("cancel",()=>{this.output.write(w.cursor.show),this.output.off("resize",this.render),Jg(this.input,!1),g(ag)})})}_isActionKey(g,$){return g==="\t"}_setValue(g){this.value=g,this.emit("value",this.value)}_setUserInput(g,$){this.userInput=g??"",this.emit("userInput",this.userInput),$&&this._track&&this.rl&&(this.rl.write(this.userInput),this._cursor=this.rl.cursor)}_clearUserInput(){this.rl?.write(null,{ctrl:!0,name:"u"}),this._setUserInput("")}onKeypress(g,$){if(this._track&&$.name!=="return"&&($.name&&this._isActionKey(g,$)&&this.rl?.write(null,{ctrl:!0,name:"h"}),this._cursor=this.rl?.cursor??0,this._setUserInput(this.rl?.line)),this.state==="error"&&(this.state="active"),$?.name&&(!this._track&&$1.aliases.has($.name)&&this.emit("cursor",$1.aliases.get($.name)),$1.actions.has($.name)&&this.emit("cursor",$.name)),g&&(g.toLowerCase()==="y"||g.toLowerCase()==="n")&&this.emit("confirm",g.toLowerCase()==="y"),this.emit("key",g?.toLowerCase(),$),$?.name==="return"){if(this.opts.validate){let x=this.opts.validate(this.value);x&&(this.error=x instanceof Error?x.message:x,this.state="error",this.rl?.write(this.userInput))}this.state!=="error"&&(this.state="submit")}g0([g,$?.name,$?.sequence],"cancel")&&(this.state="cancel"),(this.state==="submit"||this.state==="cancel")&&this.emit("finalize"),this.render(),(this.state==="submit"||this.state==="cancel")&&this.close()}close(){this.input.unpipe(),this.input.removeListener("keypress",this.onKeypress),this.output.write(`
`),Jg(this.input,!1),this.rl?.close(),this.rl=void 0,this.emit(`${this.state}`,this.value),this.unsubscribe()}restoreCursor(){let g=sg(this._prevFrame,process.stdout.columns,{hard:!0,trim:!1}).split(`
`).length-1;this.output.write(w.cursor.move(-999,g*-1))}render(){let g=sg(this._render(this)??"",process.stdout.columns,{hard:!0,trim:!1});if(g!==this._prevFrame){if(this.state==="initial")this.output.write(w.cursor.hide);else{let $=Sx(this._prevFrame,g),x=$0(this.output);if(this.restoreCursor(),$){let N=Math.max(0,$.numLinesAfter-x),I=Math.max(0,$.numLinesBefore-x),C=$.lines.find((n)=>n>=N);if(C===void 0){this._prevFrame=g;return}if($.lines.length===1){this.output.write(w.cursor.move(0,C-I)),this.output.write(w.erase.lines(1));let n=g.split(`
`);this.output.write(n[C]),this._prevFrame=g,this.output.write(w.cursor.move(0,n.length-C-1));return}else if($.lines.length>1){if(N<I)C=N;else{let G=C-I;G>0&&this.output.write(w.cursor.move(0,G))}this.output.write(w.erase.down());let n=g.split(`
`).slice(C);this.output.write(n.join(`
`)),this._prevFrame=g;return}}this.output.write(w.erase.down())}this.output.write(g),this.state==="initial"&&(this.state="active"),this._prevFrame=g}}}function Px(g,$){if(g===void 0||$.length===0)return 0;let x=$.findIndex((N)=>N.value===g);return x!==-1?x:0}function ux(g,$){return($.label??String($.value)).toLowerCase().includes(g.toLowerCase())}function Wx(g,$){if($)return g?$:$[0]}class G$ extends v1{filteredOptions;multiple;isNavigating=!1;selectedValues=[];focusedValue;#g=0;#x="";#N;#$;get cursor(){return this.#g}get userInputWithCursor(){if(!this.userInput)return Zg.default.inverse(Zg.default.hidden("_"));if(this._cursor>=this.userInput.length)return`${this.userInput}`;let g=this.userInput.slice(0,this._cursor),[$,...x]=this.userInput.slice(this._cursor);return`${g}${Zg.default.inverse($)}${x.join("")}`}get options(){return typeof this.#$=="function"?this.#$():this.#$}constructor(g){super(g),this.#$=g.options;let $=this.options;this.filteredOptions=[...$],this.multiple=g.multiple===!0,this.#N=g.filter??ux;let x;if(g.initialValue&&Array.isArray(g.initialValue)?this.multiple?x=g.initialValue:x=g.initialValue.slice(0,1):!this.multiple&&this.options.length>0&&(x=[this.options[0].value]),x)for(let N of x){let I=$.findIndex((C)=>C.value===N);I!==-1&&(this.toggleSelected(N),this.#g=I)}this.focusedValue=this.options[this.#g]?.value,this.on("key",(N,I)=>this.#I(N,I)),this.on("userInput",(N)=>this.#C(N))}_isActionKey(g,$){return g==="\t"||this.multiple&&this.isNavigating&&$.name==="space"&&g!==void 0&&g!==""}#I(g,$){let x=$.name==="up",N=$.name==="down",I=$.name==="return";x||N?(this.#g=Math.max(0,Math.min(this.#g+(x?-1:1),this.filteredOptions.length-1)),this.focusedValue=this.filteredOptions[this.#g]?.value,this.multiple||(this.selectedValues=[this.focusedValue]),this.isNavigating=!0):I?this.value=Wx(this.multiple,this.selectedValues):this.multiple?this.focusedValue!==void 0&&($.name==="tab"||this.isNavigating&&$.name==="space")?this.toggleSelected(this.focusedValue):this.isNavigating=!1:(this.focusedValue&&(this.selectedValues=[this.focusedValue]),this.isNavigating=!1)}deselectAll(){this.selectedValues=[]}toggleSelected(g){this.filteredOptions.length!==0&&(this.multiple?this.selectedValues.includes(g)?this.selectedValues=this.selectedValues.filter(($)=>$!==g):this.selectedValues=[...this.selectedValues,g]:this.selectedValues=[g])}#C(g){if(g!==this.#x){this.#x=g;let $=this.options;g?this.filteredOptions=$.filter((x)=>this.#N(g,x)):this.filteredOptions=[...$],this.#g=Px(this.focusedValue,this.filteredOptions),this.focusedValue=this.filteredOptions[this.#g]?.value,this.multiple||(this.focusedValue!==void 0?this.toggleSelected(this.focusedValue):this.deselectAll())}}}class n$ extends v1{options;cursor=0;#g;getGroupItems(g){return this.options.filter(($)=>$.group===g)}isGroupSelected(g){let $=this.getGroupItems(g),x=this.value;return x===void 0?!1:$.every((N)=>x.includes(N.value))}toggleValue(){let g=this.options[this.cursor];if(this.value===void 0&&(this.value=[]),g.group===!0){let $=g.value,x=this.getGroupItems($);this.isGroupSelected($)?this.value=this.value.filter((N)=>x.findIndex((I)=>I.value===N)===-1):this.value=[...this.value,...x.map((N)=>N.value)],this.value=Array.from(new Set(this.value))}else{let $=this.value.includes(g.value);this.value=$?this.value.filter((x)=>x!==g.value):[...this.value,g.value]}}constructor(g){super(g,!1);let{options:$}=g;this.#g=g.selectableGroups!==!1,this.options=Object.entries($).flatMap(([x,N])=>[{value:x,group:!0,label:x},...N.map((I)=>({...I,group:x}))]),this.value=[...g.initialValues??[]],this.cursor=Math.max(this.options.findIndex(({value:x})=>x===g.cursorAt),this.#g?0:1),this.on("cursor",(x)=>{switch(x){case"left":case"up":{this.cursor=this.cursor===0?this.options.length-1:this.cursor-1;let N=this.options[this.cursor]?.group===!0;!this.#g&&N&&(this.cursor=this.cursor===0?this.options.length-1:this.cursor-1);break}case"down":case"right":{this.cursor=this.cursor===this.options.length-1?0:this.cursor+1;let N=this.options[this.cursor]?.group===!0;!this.#g&&N&&(this.cursor=this.cursor===this.options.length-1?0:this.cursor+1);break}case"space":this.toggleValue();break}})}}function R1(g,$,x){let N=g+$,I=Math.max(x.length-1,0),C=N<0?I:N>I?0:N;return x[C].disabled?R1(C,$<0?-1:1,x):C}class x0 extends v1{options;cursor=0;get _value(){return this.options[this.cursor].value}get _enabledOptions(){return this.options.filter((g)=>g.disabled!==!0)}toggleAll(){let g=this._enabledOptions,$=this.value!==void 0&&this.value.length===g.length;this.value=$?[]:g.map((x)=>x.value)}toggleInvert(){let g=this.value;if(!g)return;let $=this._enabledOptions.filter((x)=>!g.includes(x.value));this.value=$.map((x)=>x.value)}toggleValue(){this.value===void 0&&(this.value=[]);let g=this.value.includes(this._value);this.value=g?this.value.filter(($)=>$!==this._value):[...this.value,this._value]}constructor(g){super(g,!1),this.options=g.options,this.value=[...g.initialValues??[]];let $=Math.max(this.options.findIndex(({value:x})=>x===g.cursorAt),0);this.cursor=this.options[$].disabled?R1($,1,this.options):$,this.on("key",(x)=>{x==="a"&&this.toggleAll(),x==="i"&&this.toggleInvert()}),this.on("cursor",(x)=>{switch(x){case"left":case"up":this.cursor=R1(this.cursor,-1,this.options);break;case"down":case"right":this.cursor=R1(this.cursor,1,this.options);break;case"space":this.toggleValue();break}})}}class N0 extends v1{options;cursor=0;get _selectedValue(){return this.options[this.cursor]}changeValue(){this.value=this._selectedValue.value}constructor(g){super(g,!1),this.options=g.options;let $=this.options.findIndex(({value:N})=>N===g.initialValue),x=$===-1?0:$;this.cursor=this.options[x].disabled?R1(x,1,this.options):x,this.changeValue(),this.on("cursor",(N)=>{switch(N){case"left":case"up":this.cursor=R1(this.cursor,-1,this.options);break;case"down":case"right":this.cursor=R1(this.cursor,1,this.options);break}this.changeValue()})}}var M=p(q1(),1);import o from"node:process";var E1=p(hg(),1);function fx(){return o.platform!=="win32"?o.env.TERM!=="linux":!!o.env.CI||!!o.env.WT_SESSION||!!o.env.TERMINUS_SUBLIME||o.env.ConEmuTask==="{cmd::Cmder}"||o.env.TERM_PROGRAM==="Terminus-Sublime"||o.env.TERM_PROGRAM==="vscode"||o.env.TERM==="xterm-256color"||o.env.TERM==="alacritty"||o.env.TERMINAL_EMULATOR==="JetBrains-JediTerm"}var n0=fx(),vx=()=>process.env.CI==="true";var _=(g,$)=>n0?g:$,yx=_("","*"),M$=_("","x"),Y$=_("","x"),Mg=_("","o"),Ex=_("","T"),F=_("","|"),i1=_("",""),F6=_("","T"),P6=_("",""),ix=_("",">"),J$=_(""," "),wx=_("","[]"),Z$=_("","[+]"),Q$=_("","[ ]"),u6=_("",""),X$=_("","-"),dx=_("","+"),bx=_("","+"),cx=_("","+"),hx=_("","+"),W6=_("","+"),kx=_("",""),px=_("","*"),ox=_("","!"),sx=_("","x"),R$=(g)=>{switch(g){case"initial":case"active":return M.default.cyan(yx);case"cancel":return M.default.red(M$);case"error":return M.default.yellow(Y$);case"submit":return M.default.green(Mg)}},O$=(g)=>{switch(g){case"initial":case"active":return M.default.cyan(F);case"cancel":return M.default.red(F);case"error":return M.default.yellow(F);case"submit":return M.default.green(F)}},ax=(g)=>g===161||g===164||g===167||g===168||g===170||g===173||g===174||g>=176&&g<=180||g>=182&&g<=186||g>=188&&g<=191||g===198||g===208||g===215||g===216||g>=222&&g<=225||g===230||g>=232&&g<=234||g===236||g===237||g===240||g===242||g===243||g>=247&&g<=250||g===252||g===254||g===257||g===273||g===275||g===283||g===294||g===295||g===299||g>=305&&g<=307||g===312||g>=319&&g<=322||g===324||g>=328&&g<=331||g===333||g===338||g===339||g===358||g===359||g===363||g===462||g===464||g===466||g===468||g===470||g===472||g===474||g===476||g===593||g===609||g===708||g===711||g>=713&&g<=715||g===717||g===720||g>=728&&g<=731||g===733||g===735||g>=768&&g<=879||g>=913&&g<=929||g>=931&&g<=937||g>=945&&g<=961||g>=963&&g<=969||g===1025||g>=1040&&g<=1103||g===1105||g===8208||g>=8211&&g<=8214||g===8216||g===8217||g===8220||g===8221||g>=8224&&g<=8226||g>=8228&&g<=8231||g===8240||g===8242||g===8243||g===8245||g===8251||g===8254||g===8308||g===8319||g>=8321&&g<=8324||g===8364||g===8451||g===8453||g===8457||g===8467||g===8470||g===8481||g===8482||g===8486||g===8491||g===8531||g===8532||g>=8539&&g<=8542||g>=8544&&g<=8555||g>=8560&&g<=8569||g===8585||g>=8592&&g<=8601||g===8632||g===8633||g===8658||g===8660||g===8679||g===8704||g===8706||g===8707||g===8711||g===8712||g===8715||g===8719||g===8721||g===8725||g===8730||g>=8733&&g<=8736||g===8739||g===8741||g>=8743&&g<=8748||g===8750||g>=8756&&g<=8759||g===8764||g===8765||g===8776||g===8780||g===8786||g===8800||g===8801||g>=8804&&g<=8807||g===8810||g===8811||g===8814||g===8815||g===8834||g===8835||g===8838||g===8839||g===8853||g===8857||g===8869||g===8895||g===8978||g>=9312&&g<=9449||g>=9451&&g<=9547||g>=9552&&g<=9587||g>=9600&&g<=9615||g>=9618&&g<=9621||g===9632||g===9633||g>=9635&&g<=9641||g===9650||g===9651||g===9654||g===9655||g===9660||g===9661||g===9664||g===9665||g>=9670&&g<=9672||g===9675||g>=9678&&g<=9681||g>=9698&&g<=9701||g===9711||g===9733||g===9734||g===9737||g===9742||g===9743||g===9756||g===9758||g===9792||g===9794||g===9824||g===9825||g>=9827&&g<=9829||g>=9831&&g<=9834||g===9836||g===9837||g===9839||g===9886||g===9887||g===9919||g>=9926&&g<=9933||g>=9935&&g<=9939||g>=9941&&g<=9953||g===9955||g===9960||g===9961||g>=9963&&g<=9969||g===9972||g>=9974&&g<=9977||g===9979||g===9980||g===9982||g===9983||g===10045||g>=10102&&g<=10111||g>=11094&&g<=11097||g>=12872&&g<=12879||g>=57344&&g<=63743||g>=65024&&g<=65039||g===65533||g>=127232&&g<=127242||g>=127248&&g<=127277||g>=127280&&g<=127337||g>=127344&&g<=127373||g===127375||g===127376||g>=127387&&g<=127404||g>=917760&&g<=917999||g>=983040&&g<=1048573||g>=1048576&&g<=1114109,rx=(g)=>g===12288||g>=65281&&g<=65376||g>=65504&&g<=65510,tx=(g)=>g>=4352&&g<=4447||g===8986||g===8987||g===9001||g===9002||g>=9193&&g<=9196||g===9200||g===9203||g===9725||g===9726||g===9748||g===9749||g>=9800&&g<=9811||g===9855||g===9875||g===9889||g===9898||g===9899||g===9917||g===9918||g===9924||g===9925||g===9934||g===9940||g===9962||g===9970||g===9971||g===9973||g===9978||g===9981||g===9989||g===9994||g===9995||g===10024||g===10060||g===10062||g>=10067&&g<=10069||g===10071||g>=10133&&g<=10135||g===10160||g===10175||g===11035||g===11036||g===11088||g===11093||g>=11904&&g<=11929||g>=11931&&g<=12019||g>=12032&&g<=12245||g>=12272&&g<=12287||g>=12289&&g<=12350||g>=12353&&g<=12438||g>=12441&&g<=12543||g>=12549&&g<=12591||g>=12593&&g<=12686||g>=12688&&g<=12771||g>=12783&&g<=12830||g>=12832&&g<=12871||g>=12880&&g<=19903||g>=19968&&g<=42124||g>=42128&&g<=42182||g>=43360&&g<=43388||g>=44032&&g<=55203||g>=63744&&g<=64255||g>=65040&&g<=65049||g>=65072&&g<=65106||g>=65108&&g<=65126||g>=65128&&g<=65131||g>=94176&&g<=94180||g===94192||g===94193||g>=94208&&g<=100343||g>=100352&&g<=101589||g>=101632&&g<=101640||g>=110576&&g<=110579||g>=110581&&g<=110587||g===110589||g===110590||g>=110592&&g<=110882||g===110898||g>=110928&&g<=110930||g===110933||g>=110948&&g<=110951||g>=110960&&g<=111355||g===126980||g===127183||g===127374||g>=127377&&g<=127386||g>=127488&&g<=127490||g>=127504&&g<=127547||g>=127552&&g<=127560||g===127568||g===127569||g>=127584&&g<=127589||g>=127744&&g<=127776||g>=127789&&g<=127797||g>=127799&&g<=127868||g>=127870&&g<=127891||g>=127904&&g<=127946||g>=127951&&g<=127955||g>=127968&&g<=127984||g===127988||g>=127992&&g<=128062||g===128064||g>=128066&&g<=128252||g>=128255&&g<=128317||g>=128331&&g<=128334||g>=128336&&g<=128359||g===128378||g===128405||g===128406||g===128420||g>=128507&&g<=128591||g>=128640&&g<=128709||g===128716||g>=128720&&g<=128722||g>=128725&&g<=128727||g>=128732&&g<=128735||g===128747||g===128748||g>=128756&&g<=128764||g>=128992&&g<=129003||g===129008||g>=129292&&g<=129338||g>=129340&&g<=129349||g>=129351&&g<=129535||g>=129648&&g<=129660||g>=129664&&g<=129672||g>=129680&&g<=129725||g>=129727&&g<=129733||g>=129742&&g<=129755||g>=129760&&g<=129768||g>=129776&&g<=129784||g>=131072&&g<=196605||g>=196608&&g<=262141,I0=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/y,Xg=/[\x00-\x08\x0A-\x1F\x7F-\x9F]{1,1000}/y,zg=/\t{1,1000}/y,C0=/[\u{1F1E6}-\u{1F1FF}]{2}|\u{1F3F4}[\u{E0061}-\u{E007A}]{2}[\u{E0030}-\u{E0039}\u{E0061}-\u{E007A}]{1,3}\u{E007F}|(?:\p{Emoji}\uFE0F\u20E3?|\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation})(?:\u200D(?:\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F\u20E3?))*/yu,jg=/(?:[\x20-\x7E\xA0-\xFF](?!\uFE0F)){1,1000}/y,ex=/\p{M}+/gu,g4={limit:1/0,ellipsis:""},H$=(g,$={},x={})=>{let N=$.limit??1/0,I=$.ellipsis??"",C=$?.ellipsisWidth??(I?H$(I,g4,x).width:0),n=x.ansiWidth??0,G=x.controlWidth??0,J=x.tabWidth??8,Z=x.ambiguousWidth??1,z=x.emojiWidth??2,X=x.fullWidthWidth??2,K=x.regularWidth??1,R=x.wideWidth??2,j=0,Q=0,Y=g.length,V=0,A=!1,D=Y,l=Math.max(0,N-C),q=0,L=0,O=0,H=0;g:for(;;){if(L>q||Q>=Y&&Q>j){let u=g.slice(q,L)||g.slice(j,Q);V=0;for(let E of u.replaceAll(ex,"")){let d=E.codePointAt(0)||0;if(rx(d)?H=X:tx(d)?H=R:Z!==K&&ax(d)?H=Z:H=K,O+H>l&&(D=Math.min(D,Math.max(q,j)+V)),O+H>N){A=!0;break g}V+=E.length,O+=H}q=L=0}if(Q>=Y)break;if(jg.lastIndex=Q,jg.test(g)){if(V=jg.lastIndex-Q,H=V*K,O+H>l&&(D=Math.min(D,Q+Math.floor((l-O)/K))),O+H>N){A=!0;break}O+=H,q=j,L=Q,Q=j=jg.lastIndex;continue}if(I0.lastIndex=Q,I0.test(g)){if(O+n>l&&(D=Math.min(D,Q)),O+n>N){A=!0;break}O+=n,q=j,L=Q,Q=j=I0.lastIndex;continue}if(Xg.lastIndex=Q,Xg.test(g)){if(V=Xg.lastIndex-Q,H=V*G,O+H>l&&(D=Math.min(D,Q+Math.floor((l-O)/G))),O+H>N){A=!0;break}O+=H,q=j,L=Q,Q=j=Xg.lastIndex;continue}if(zg.lastIndex=Q,zg.test(g)){if(V=zg.lastIndex-Q,H=V*J,O+H>l&&(D=Math.min(D,Q+Math.floor((l-O)/J))),O+H>N){A=!0;break}O+=H,q=j,L=Q,Q=j=zg.lastIndex;continue}if(C0.lastIndex=Q,C0.test(g)){if(O+z>l&&(D=Math.min(D,Q)),O+z>N){A=!0;break}O+=z,q=j,L=Q,Q=j=C0.lastIndex;continue}Q+=1}return{width:A?l:O,index:A?D:Y,truncated:A,ellipsed:A&&N>=C}},$4={limit:1/0,ellipsis:"",ellipsisWidth:0},N1=(g,$={})=>H$(g,$4,$).width,Yg="\x1B",V$="",x4=39,Z0="\x07",A$="[",N4="]",U$="m",Q0=`${N4}8;;`,z$=new RegExp(`(?:\\${A$}(?<code>\\d+)m|\\${Q0}(?<uri>.*)${Z0})`,"y"),I4=(g)=>{if(g>=30&&g<=37||g>=90&&g<=97)return 39;if(g>=40&&g<=47||g>=100&&g<=107)return 49;if(g===1||g===2)return 22;if(g===3)return 23;if(g===4)return 24;if(g===7)return 27;if(g===8)return 28;if(g===9)return 29;if(g===0)return 0},j$=(g)=>`${Yg}${A$}${g}${U$}`,K$=(g)=>`${Yg}${Q0}${g}${Z0}`,C4=(g)=>g.map(($)=>N1($)),G0=(g,$,x)=>{let N=$[Symbol.iterator](),I=!1,C=!1,n=g.at(-1),G=n===void 0?0:N1(n),J=N.next(),Z=N.next(),z=0;for(;!J.done;){let X=J.value,K=N1(X);G+K<=x?g[g.length-1]+=X:(g.push(X),G=0),(X===Yg||X===V$)&&(I=!0,C=$.startsWith(Q0,z+1)),I?C?X===Z0&&(I=!1,C=!1):X===U$&&(I=!1):(G+=K,G===x&&!Z.done&&(g.push(""),G=0)),J=Z,Z=N.next(),z+=X.length}n=g.at(-1),!G&&n!==void 0&&n.length>0&&g.length>1&&(g[g.length-2]+=g.pop())},G4=(g)=>{let $=g.split(" "),x=$.length;for(;x>0&&!(N1($[x-1])>0);)x--;return x===$.length?g:$.slice(0,x).join(" ")+$.slice(x).join("")},n4=(g,$,x={})=>{if(x.trim!==!1&&g.trim()==="")return"";let N="",I,C,n=g.split(" "),G=C4(n),J=[""];for(let[j,Q]of n.entries()){x.trim!==!1&&(J[J.length-1]=(J.at(-1)??"").trimStart());let Y=N1(J.at(-1)??"");if(j!==0&&(Y>=$&&(x.wordWrap===!1||x.trim===!1)&&(J.push(""),Y=0),(Y>0||x.trim===!1)&&(J[J.length-1]+=" ",Y++)),x.hard&&G[j]>$){let V=$-Y,A=1+Math.floor((G[j]-V-1)/$);Math.floor((G[j]-1)/$)<A&&J.push(""),G0(J,Q,$);continue}if(Y+G[j]>$&&Y>0&&G[j]>0){if(x.wordWrap===!1&&Y<$){G0(J,Q,$);continue}J.push("")}if(Y+G[j]>$&&x.wordWrap===!1){G0(J,Q,$);continue}J[J.length-1]+=Q}x.trim!==!1&&(J=J.map((j)=>G4(j)));let Z=J.join(`
`),z=Z[Symbol.iterator](),X=z.next(),K=z.next(),R=0;for(;!X.done;){let j=X.value,Q=K.value;if(N+=j,j===Yg||j===V$){z$.lastIndex=R+1;let V=z$.exec(Z)?.groups;if(V?.code!==void 0){let A=Number.parseFloat(V.code);I=A===x4?void 0:A}else V?.uri!==void 0&&(C=V.uri.length===0?void 0:V.uri)}let Y=I?I4(I):void 0;Q===`
`?(C&&(N+=K$("")),I&&Y&&(N+=j$(Y))):j===`
`&&(I&&Y&&(N+=j$(I)),C&&(N+=K$(C))),R+=j.length,X=K,K=z.next()}return N};function w1(g,$,x){return String(g).normalize().replaceAll(`\r
`,`
`).split(`
`).map((N)=>n4(N,$,x)).join(`
`)}var J4=(g,$,x,N,I)=>{let C=$,n=0;for(let G=x;G<N;G++){let J=g[G];if(C=C-J.length,n++,C<=I)break}return{lineCount:C,removals:n}},J0=(g)=>{let{cursor:$,options:x,style:N}=g,I=g.output??process.stdout,C=f1(I),n=g.columnPadding??0,G=g.rowPadding??4,J=C-n,Z=$0(I),z=M.default.dim("..."),X=g.maxItems??Number.POSITIVE_INFINITY,K=Math.max(Z-G,0),R=Math.max(Math.min(X,K),5),j=0;$>=R-3&&(j=Math.max(Math.min($-R+3,x.length-R),0));let Q=R<x.length&&j>0,Y=R<x.length&&j+R<x.length,V=Math.min(j+R,x.length),A=[],D=0;Q&&D++,Y&&D++;let l=j+(Q?1:0),q=V-(Y?1:0);for(let O=l;O<q;O++){let H=w1(N(x[O],O===$),J,{hard:!0,trim:!1}).split(`
`);A.push(H),D+=H.length}if(D>K){let O=0,H=0,u=D,E=$-l,d=(Y1,S)=>J4(A,u,Y1,S,K);Q?({lineCount:u,removals:O}=d(0,E),u>K&&({lineCount:u,removals:H}=d(E+1,A.length))):({lineCount:u,removals:H}=d(E+1,A.length),u>K&&({lineCount:u,removals:O}=d(0,E))),O>0&&(Q=!0,A.splice(0,O)),H>0&&(Y=!0,A.splice(A.length-H,H))}let L=[];Q&&L.push(z);for(let O of A)for(let H of O)L.push(H);return Y&&L.push(z),L};var x1={message:(g=[],{symbol:$=M.default.gray(F),secondarySymbol:x=M.default.gray(F),output:N=process.stdout,spacing:I=1,withGuide:C}={})=>{let n=[],G=(C??$1.withGuide)!==!1,J=G?x:"",Z=G?`${$}  `:"",z=G?`${x}  `:"";for(let K=0;K<I;K++)n.push(J);let X=Array.isArray(g)?g:g.split(`
`);if(X.length>0){let[K,...R]=X;K.length>0?n.push(`${Z}${K}`):n.push(G?$:"");for(let j of R)j.length>0?n.push(`${z}${j}`):n.push(G?x:"")}N.write(`${n.join(`
`)}
`)},info:(g,$)=>{x1.message(g,{...$,symbol:M.default.blue(kx)})},success:(g,$)=>{x1.message(g,{...$,symbol:M.default.green(px)})},step:(g,$)=>{x1.message(g,{...$,symbol:M.default.green(Mg)})},warn:(g,$)=>{x1.message(g,{...$,symbol:M.default.yellow(ox)})},warning:(g,$)=>{x1.warn(g,$)},error:(g,$)=>{x1.message(g,{...$,symbol:M.default.red(sx)})}},X0=(g="",$)=>{($?.output??process.stdout).write(`${M.default.gray(i1)}  ${M.default.red(g)}

`)},Rg=(g="",$)=>{($?.output??process.stdout).write(`${M.default.gray(Ex)}  ${g}
`)},B1=(g="",$)=>{($?.output??process.stdout).write(`${M.default.gray(F)}
${M.default.gray(i1)}  ${g}

`)},y1=(g,$)=>g.split(`
`).map((x)=>$(x)).join(`
`),D$=(g)=>{let $=(N,I)=>{let C=N.label??String(N.value);return I==="disabled"?`${M.default.gray(Q$)} ${y1(C,(n)=>M.default.strikethrough(M.default.gray(n)))}${N.hint?` ${M.default.dim(`(${N.hint??"disabled"})`)}`:""}`:I==="active"?`${M.default.cyan(wx)} ${C}${N.hint?` ${M.default.dim(`(${N.hint})`)}`:""}`:I==="selected"?`${M.default.green(Z$)} ${y1(C,M.default.dim)}${N.hint?` ${M.default.dim(`(${N.hint})`)}`:""}`:I==="cancelled"?`${y1(C,(n)=>M.default.strikethrough(M.default.dim(n)))}`:I==="active-selected"?`${M.default.green(Z$)} ${C}${N.hint?` ${M.default.dim(`(${N.hint})`)}`:""}`:I==="submitted"?`${y1(C,M.default.dim)}`:`${M.default.dim(Q$)} ${y1(C,M.default.dim)}`},x=g.required??!0;return new x0({options:g.options,signal:g.signal,input:g.input,output:g.output,initialValues:g.initialValues,required:x,cursorAt:g.cursorAt,validate(N){if(x&&(N===void 0||N.length===0))return`Please select at least one option.
${M.default.reset(M.default.dim(`Press ${M.default.gray(M.default.bgWhite(M.default.inverse(" space ")))} to select, ${M.default.gray(M.default.bgWhite(M.default.inverse(" enter ")))} to submit`))}`},render(){let N=O1(g.output,g.message,`${O$(this.state)}  `,`${R$(this.state)}  `),I=`${M.default.gray(F)}
${N}
`,C=this.value??[],n=(G,J)=>{if(G.disabled)return $(G,"disabled");let Z=C.includes(G.value);return J&&Z?$(G,"active-selected"):Z?$(G,"selected"):$(G,J?"active":"inactive")};switch(this.state){case"submit":{let G=this.options.filter(({value:Z})=>C.includes(Z)).map((Z)=>$(Z,"submitted")).join(M.default.dim(", "))||M.default.dim("none"),J=O1(g.output,G,`${M.default.gray(F)}  `);return`${I}${J}`}case"cancel":{let G=this.options.filter(({value:Z})=>C.includes(Z)).map((Z)=>$(Z,"cancelled")).join(M.default.dim(", "));if(G.trim()==="")return`${I}${M.default.gray(F)}`;let J=O1(g.output,G,`${M.default.gray(F)}  `);return`${I}${J}
${M.default.gray(F)}`}case"error":{let G=`${M.default.yellow(F)}  `,J=this.error.split(`
`).map((X,K)=>K===0?`${M.default.yellow(i1)}  ${M.default.yellow(X)}`:`   ${X}`).join(`
`),Z=I.split(`
`).length,z=J.split(`
`).length+1;return`${I}${G}${J0({output:g.output,options:this.options,cursor:this.cursor,maxItems:g.maxItems,columnPadding:G.length,rowPadding:Z+z,style:n}).join(`
${G}`)}
${J}
`}default:{let G=`${M.default.cyan(F)}  `,J=I.split(`
`).length;return`${I}${G}${J0({output:g.output,options:this.options,cursor:this.cursor,maxItems:g.maxItems,columnPadding:G.length,rowPadding:J+2,style:n}).join(`
${G}`)}
${M.default.cyan(i1)}
`}}}}).prompt()},Z4=(g)=>M.default.dim(g),Q4=(g,$,x)=>{let N={hard:!0,trim:!1},I=w1(g,$,N).split(`
`),C=I.reduce((J,Z)=>Math.max(N1(Z),J),0),n=I.map(x).reduce((J,Z)=>Math.max(N1(Z),J),0),G=$-(n-C);return w1(g,G,N)},s=(g="",$="",x)=>{let N=x?.output??o.stdout,I=(x?.withGuide??$1.withGuide)!==!1,C=x?.format??Z4,n=["",...Q4(g,f1(N)-6,C).split(`
`).map(C),""],G=N1($),J=Math.max(n.reduce((K,R)=>{let j=N1(R);return j>K?j:K},0),G)+2,Z=n.map((K)=>`${M.default.gray(F)}  ${K}${" ".repeat(J-N1(K))}${M.default.gray(F)}`).join(`
`),z=I?`${M.default.gray(F)}
`:"",X=I?bx:hx;N.write(`${z}${M.default.green(Mg)}  ${M.default.reset($)} ${M.default.gray(X$.repeat(Math.max(J-G-1,1))+dx)}
${Z}
${M.default.gray(X+X$.repeat(J+2)+cx)}
`)};var X4=M.default.magenta,Og=({indicator:g="dots",onCancel:$,output:x=process.stdout,cancelMessage:N,errorMessage:I,frames:C=n0?["","","",""]:["","o","O","0"],delay:n=n0?80:120,signal:G,...J}={})=>{let Z=vx(),z,X,K=!1,R=!1,j="",Q,Y=performance.now(),V=f1(x),A=J?.styleFrame??X4,D=(S)=>{let k=S>1?I??$1.messages.error:N??$1.messages.cancel;R=S===1,K&&(Y1(k,S),R&&typeof $=="function"&&$())},l=()=>D(2),q=()=>D(1),L=()=>{process.on("uncaughtExceptionMonitor",l),process.on("unhandledRejection",l),process.on("SIGINT",q),process.on("SIGTERM",q),process.on("exit",D),G&&G.addEventListener("abort",q)},O=()=>{process.removeListener("uncaughtExceptionMonitor",l),process.removeListener("unhandledRejection",l),process.removeListener("SIGINT",q),process.removeListener("SIGTERM",q),process.removeListener("exit",D),G&&G.removeEventListener("abort",q)},H=()=>{if(Q===void 0)return;Z&&x.write(`
`);let S=w1(Q,V,{hard:!0,trim:!1}).split(`
`);S.length>1&&x.write(E1.cursor.up(S.length-1)),x.write(E1.cursor.to(0)),x.write(E1.erase.down())},u=(S)=>S.replace(/\.+$/,""),E=(S)=>{let k=(performance.now()-S)/1000,C1=Math.floor(k/60),G1=Math.floor(k%60);return C1>0?`[${C1}m ${G1}s]`:`[${G1}s]`},d=(S="")=>{K=!0,z=C$({output:x}),j=u(S),Y=performance.now(),x.write(`${M.default.gray(F)}
`);let k=0,C1=0;L(),X=setInterval(()=>{if(Z&&j===Q)return;H(),Q=j;let G1=A(C[k]),xg;if(Z)xg=`${G1}  ${j}...`;else if(g==="timer")xg=`${G1}  ${j} ${E(Y)}`;else{let Gx=".".repeat(Math.floor(C1)).slice(0,3);xg=`${G1}  ${j}${Gx}`}let Cx=w1(xg,V,{hard:!0,trim:!1});x.write(Cx),k=k+1<C.length?k+1:0,C1=C1<4?C1+0.125:0},n)},Y1=(S="",k=0,C1=!1)=>{if(!K)return;K=!1,clearInterval(X),H();let G1=k===0?M.default.green(Mg):k===1?M.default.red(M$):M.default.red(Y$);j=S??j,C1||(g==="timer"?x.write(`${G1}  ${j} ${E(Y)}
`):x.write(`${G1}  ${j}
`)),O(),z()};return{start:d,stop:(S="")=>Y1(S,0),message:(S="")=>{j=u(S??j)},cancel:(S="")=>Y1(S,1),error:(S="")=>Y1(S,2),clear:()=>Y1("",0,!0),get isCancelled(){return R}}},f6={light:_("","-"),heavy:_("","="),block:_("","#")};var Kg=(g,$)=>g.includes(`
`)?g.split(`
`).map((x)=>$(x)).join(`
`):$(g),q$=(g)=>{let $=(x,N)=>{let I=x.label??String(x.value);switch(N){case"disabled":return`${M.default.gray(J$)} ${Kg(I,M.default.gray)}${x.hint?` ${M.default.dim(`(${x.hint??"disabled"})`)}`:""}`;case"selected":return`${Kg(I,M.default.dim)}`;case"active":return`${M.default.green(ix)} ${I}${x.hint?` ${M.default.dim(`(${x.hint})`)}`:""}`;case"cancelled":return`${Kg(I,(C)=>M.default.strikethrough(M.default.dim(C)))}`;default:return`${M.default.dim(J$)} ${Kg(I,M.default.dim)}`}};return new N0({options:g.options,signal:g.signal,input:g.input,output:g.output,initialValue:g.initialValue,render(){let x=`${R$(this.state)}  `,N=`${O$(this.state)}  `,I=O1(g.output,g.message,N,x),C=`${M.default.gray(F)}
${I}
`;switch(this.state){case"submit":{let n=`${M.default.gray(F)}  `,G=O1(g.output,$(this.options[this.cursor],"selected"),n);return`${C}${G}`}case"cancel":{let n=`${M.default.gray(F)}  `,G=O1(g.output,$(this.options[this.cursor],"cancelled"),n);return`${C}${G}
${M.default.gray(F)}`}default:{let n=`${M.default.cyan(F)}  `,G=C.split(`
`).length;return`${C}${n}${J0({output:g.output,cursor:this.cursor,options:this.options,maxItems:g.maxItems,columnPadding:n.length,rowPadding:G+2,style:(J,Z)=>$(J,J.disabled?"disabled":Z?"active":"inactive")}).join(`
${n}`)}
${M.default.cyan(i1)}
`}}}}).prompt()};var v6=`${M.default.gray(F)}  `;var U=p(q1(),1);import{existsSync as h,mkdirSync as wg,readFileSync as Nx,writeFileSync as dg,readdirSync as g6}from"node:fs";import{execSync as Ix}from"node:child_process";import{dirname as b0,join as y}from"node:path";import{createHash as $6}from"node:crypto";async function z0(g,$,{concurrency:x=Number.POSITIVE_INFINITY,stopOnError:N=!0,signal:I}={}){return new Promise((C,n)=>{if(g[Symbol.iterator]===void 0&&g[Symbol.asyncIterator]===void 0)throw TypeError(`Expected \`input\` to be either an \`Iterable\` or \`AsyncIterable\`, got (${typeof g})`);if(typeof $!=="function")throw TypeError("Mapper function is required");if(!(Number.isSafeInteger(x)&&x>=1||x===Number.POSITIVE_INFINITY))throw TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${x}\` (${typeof x})`);let G=[],J=[],Z=new Map,z=!1,X=!1,K=!1,R=0,j=0,Q=g[Symbol.iterator]===void 0?g[Symbol.asyncIterator]():g[Symbol.iterator](),Y=()=>{D(I.reason)},V=()=>{I?.removeEventListener("abort",Y)},A=(q)=>{C(q),V()},D=(q)=>{z=!0,X=!0,n(q),V()};if(I){if(I.aborted)D(I.reason);I.addEventListener("abort",Y,{once:!0})}let l=async()=>{if(X)return;let q=await Q.next(),L=j;if(j++,q.done){if(K=!0,R===0&&!X){if(!N&&J.length>0){D(AggregateError(J));return}if(X=!0,Z.size===0){A(G);return}let O=[];for(let[H,u]of G.entries()){if(Z.get(H)===B$)continue;O.push(u)}A(O)}return}R++,(async()=>{try{let O=await q.value;if(X)return;let H=await $(O,L);if(H===B$)Z.set(L,H);G[L]=H,R--,await l()}catch(O){if(N)D(O);else{J.push(O),R--;try{await l()}catch(H){D(H)}}}})()};(async()=>{for(let q=0;q<x;q++){try{await l()}catch(L){D(L);break}if(K||z)break}})()})}var B$=Symbol("skip");import{stat as d4}from"fs";import{stat as b4,readdir as c4}from"fs/promises";import{EventEmitter as h4}from"events";import*as T from"path";import{stat as j4,lstat as l$,readdir as K4,realpath as M4}from"node:fs/promises";import{Readable as Y4}from"node:stream";import{resolve as T$,relative as R4,join as O4,sep as H4}from"node:path";var b={FILE_TYPE:"files",DIR_TYPE:"directories",FILE_DIR_TYPE:"files_directories",EVERYTHING_TYPE:"all"},j0={root:".",fileFilter:(g)=>!0,directoryFilter:(g)=>!0,type:b.FILE_TYPE,lstat:!1,depth:2147483648,alwaysStat:!1,highWaterMark:4096};Object.freeze(j0);var S$="READDIRP_RECURSIVE_ERROR",V4=new Set(["ENOENT","EPERM","EACCES","ELOOP",S$]),L$=[b.DIR_TYPE,b.EVERYTHING_TYPE,b.FILE_DIR_TYPE,b.FILE_TYPE],A4=new Set([b.DIR_TYPE,b.EVERYTHING_TYPE,b.FILE_DIR_TYPE]),U4=new Set([b.EVERYTHING_TYPE,b.FILE_DIR_TYPE,b.FILE_TYPE]),D4=(g)=>V4.has(g.code),q4=process.platform==="win32",_$=(g)=>!0,m$=(g)=>{if(g===void 0)return _$;if(typeof g==="function")return g;if(typeof g==="string"){let $=g.trim();return(x)=>x.basename===$}if(Array.isArray(g)){let $=g.map((x)=>x.trim());return(x)=>$.some((N)=>x.basename===N)}return _$};class F$ extends Y4{constructor(g={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:g.highWaterMark});let $={...j0,...g},{root:x,type:N}=$;this._fileFilter=m$($.fileFilter),this._directoryFilter=m$($.directoryFilter);let I=$.lstat?l$:j4;if(q4)this._stat=(C)=>I(C,{bigint:!0});else this._stat=I;this._maxDepth=$.depth??j0.depth,this._wantsDir=N?A4.has(N):!1,this._wantsFile=N?U4.has(N):!1,this._wantsEverything=N===b.EVERYTHING_TYPE,this._root=T$(x),this._isDirent=!$.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir(x,1)],this.reading=!1,this.parent=void 0}async _read(g){if(this.reading)return;this.reading=!0;try{while(!this.destroyed&&g>0){let $=this.parent,x=$&&$.files;if(x&&x.length>0){let{path:N,depth:I}=$,C=x.splice(0,g).map((G)=>this._formatEntry(G,N)),n=await Promise.all(C);for(let G of n){if(!G)continue;if(this.destroyed)return;let J=await this._getEntryType(G);if(J==="directory"&&this._directoryFilter(G)){if(I<=this._maxDepth)this.parents.push(this._exploreDir(G.fullPath,I+1));if(this._wantsDir)this.push(G),g--}else if((J==="file"||this._includeAsFile(G))&&this._fileFilter(G)){if(this._wantsFile)this.push(G),g--}}}else{let N=this.parents.pop();if(!N){this.push(null);break}if(this.parent=await N,this.destroyed)return}}}catch($){this.destroy($)}finally{this.reading=!1}}async _exploreDir(g,$){let x;try{x=await K4(g,this._rdOptions)}catch(N){this._onError(N)}return{files:x,depth:$,path:g}}async _formatEntry(g,$){let x,N=this._isDirent?g.name:g;try{let I=T$(O4($,N));x={path:R4(this._root,I),fullPath:I,basename:N},x[this._statsProp]=this._isDirent?g:await this._stat(I)}catch(I){this._onError(I);return}return x}_onError(g){if(D4(g)&&!this.destroyed)this.emit("warn",g);else this.destroy(g)}async _getEntryType(g){if(!g&&this._statsProp in g)return"";let $=g[this._statsProp];if($.isFile())return"file";if($.isDirectory())return"directory";if($&&$.isSymbolicLink()){let x=g.fullPath;try{let N=await M4(x),I=await l$(N);if(I.isFile())return"file";if(I.isDirectory()){let C=N.length;if(x.startsWith(N)&&x.substr(C,1)===H4){let n=Error(`Circular symlink detected: "${x}" points to "${N}"`);return n.code=S$,this._onError(n)}return"directory"}}catch(N){return this._onError(N),""}}}_includeAsFile(g){let $=g&&g[this._statsProp];return $&&this._wantsEverything&&!$.isDirectory()}}function P$(g,$={}){let x=$.entryType||$.type;if(x==="both")x=b.FILE_DIR_TYPE;if(x)$.type=x;if(!g)throw Error("readdirp: root argument is required. Usage: readdirp(root, options)");else if(typeof g!=="string")throw TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");else if(x&&!L$.includes(x))throw Error(`readdirp: Invalid type passed. Use one of ${L$.join(", ")}`);return $.root=g,new F$($)}import{watchFile as B4,unwatchFile as u$,watch as l4}from"fs";import{open as T4,stat as f$,lstat as L4,realpath as K0}from"fs/promises";import*as P from"path";import{type as _4}from"os";var m4="data",R0="end",v$="close",Ug=()=>{};var Dg=process.platform,O0=Dg==="win32",S4=Dg==="darwin",F4=Dg==="linux",P4=Dg==="freebsd",y$=_4()==="OS400",m={ALL:"all",READY:"ready",ADD:"add",CHANGE:"change",ADD_DIR:"addDir",UNLINK:"unlink",UNLINK_DIR:"unlinkDir",RAW:"raw",ERROR:"error"},r=m,u4="watch",W4={lstat:L4,stat:f$},H1="listeners",Hg="errHandlers",l1="rawEmitters",f4=[H1,Hg,l1],v4=new Set(["3dm","3ds","3g2","3gp","7z","a","aac","adp","afdesign","afphoto","afpub","ai","aif","aiff","alz","ape","apk","appimage","ar","arj","asf","au","avi","bak","baml","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","cur","dat","dcm","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","flatpak","fli","flv","fpx","fst","fvt","g3","gh","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lib","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","nupkg","o","odp","ods","odt","oga","ogg","ogv","otf","ott","pages","pbm","pcx","pdb","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","resources","rgb","rip","rlc","rmf","rmvb","rpm","rtf","rz","s3m","s7z","scpt","sgi","shar","snap","sil","sketch","slk","smv","snk","so","stl","suo","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wrm","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"]),y4=(g)=>v4.has(P.extname(g).slice(1).toLowerCase()),Y0=(g,$)=>{if(g instanceof Set)g.forEach($);else $(g)},d1=(g,$,x)=>{let N=g[$];if(!(N instanceof Set))g[$]=N=new Set([N]);N.add(x)},E4=(g)=>($)=>{let x=g[$];if(x instanceof Set)x.clear();else delete g[$]},b1=(g,$,x)=>{let N=g[$];if(N instanceof Set)N.delete(x);else if(N===x)delete g[$]},E$=(g)=>g instanceof Set?g.size===0:!g,Vg=new Map;function W$(g,$,x,N,I){let C=(n,G)=>{if(x(g),I(n,G,{watchedPath:g}),G&&g!==G)Ag(P.resolve(g,G),H1,P.join(g,G))};try{return l4(g,{persistent:$.persistent},C)}catch(n){N(n);return}}var Ag=(g,$,x,N,I)=>{let C=Vg.get(g);if(!C)return;Y0(C[$],(n)=>{n(x,N,I)})},i4=(g,$,x,N)=>{let{listener:I,errHandler:C,rawEmitter:n}=N,G=Vg.get($),J;if(!x.persistent){if(J=W$(g,x,I,C,n),!J)return;return J.close.bind(J)}if(G)d1(G,H1,I),d1(G,Hg,C),d1(G,l1,n);else{if(J=W$(g,x,Ag.bind(null,$,H1),C,Ag.bind(null,$,l1)),!J)return;J.on(r.ERROR,async(Z)=>{let z=Ag.bind(null,$,Hg);if(G)G.watcherUnusable=!0;if(O0&&Z.code==="EPERM")try{await(await T4(g,"r")).close(),z(Z)}catch(X){}else z(Z)}),G={listeners:I,errHandlers:C,rawEmitters:n,watcher:J},Vg.set($,G)}return()=>{if(b1(G,H1,I),b1(G,Hg,C),b1(G,l1,n),E$(G.listeners))G.watcher.close(),Vg.delete($),f4.forEach(E4(G)),G.watcher=void 0,Object.freeze(G)}},M0=new Map,w4=(g,$,x,N)=>{let{listener:I,rawEmitter:C}=N,n=M0.get($),G=n&&n.options;if(G&&(G.persistent<x.persistent||G.interval>x.interval))u$($),n=void 0;if(n)d1(n,H1,I),d1(n,l1,C);else n={listeners:I,rawEmitters:C,options:x,watcher:B4($,x,(J,Z)=>{Y0(n.rawEmitters,(X)=>{X(r.CHANGE,$,{curr:J,prev:Z})});let z=J.mtimeMs;if(J.size!==Z.size||z>Z.mtimeMs||z===0)Y0(n.listeners,(X)=>X(g,J))})},M0.set($,n);return()=>{if(b1(n,H1,I),b1(n,l1,C),E$(n.listeners))M0.delete($),u$($),n.options=n.watcher=void 0,Object.freeze(n)}};class H0{constructor(g){this.fsw=g,this._boundHandleError=($)=>g._handleError($)}_watchWithNodeFs(g,$){let x=this.fsw.options,N=P.dirname(g),I=P.basename(g);this.fsw._getWatchedDir(N).add(I);let n=P.resolve(g),G={persistent:x.persistent};if(!$)$=Ug;let J;if(x.usePolling){let Z=x.interval!==x.binaryInterval;G.interval=Z&&y4(I)?x.binaryInterval:x.interval,J=w4(g,n,G,{listener:$,rawEmitter:this.fsw._emitRaw})}else J=i4(g,n,G,{listener:$,errHandler:this._boundHandleError,rawEmitter:this.fsw._emitRaw});return J}_handleFile(g,$,x){if(this.fsw.closed)return;let N=P.dirname(g),I=P.basename(g),C=this.fsw._getWatchedDir(N),n=$;if(C.has(I))return;let G=async(Z,z)=>{if(!this.fsw._throttle(u4,g,5))return;if(!z||z.mtimeMs===0)try{let X=await f$(g);if(this.fsw.closed)return;let{atimeMs:K,mtimeMs:R}=X;if(!K||K<=R||R!==n.mtimeMs)this.fsw._emit(r.CHANGE,g,X);if((S4||F4||P4)&&n.ino!==X.ino){this.fsw._closeFile(Z),n=X;let j=this._watchWithNodeFs(g,G);if(j)this.fsw._addPathCloser(Z,j)}else n=X}catch(X){this.fsw._remove(N,I)}else if(C.has(I)){let{atimeMs:X,mtimeMs:K}=z;if(!X||X<=K||K!==n.mtimeMs)this.fsw._emit(r.CHANGE,g,z);n=z}},J=this._watchWithNodeFs(g,G);if(!(x&&this.fsw.options.ignoreInitial)&&this.fsw._isntIgnored(g)){if(!this.fsw._throttle(r.ADD,g,0))return;this.fsw._emit(r.ADD,g,$)}return J}async _handleSymlink(g,$,x,N){if(this.fsw.closed)return;let I=g.fullPath,C=this.fsw._getWatchedDir($);if(!this.fsw.options.followSymlinks){this.fsw._incrReadyCount();let n;try{n=await K0(x)}catch(G){return this.fsw._emitReady(),!0}if(this.fsw.closed)return;if(C.has(N)){if(this.fsw._symlinkPaths.get(I)!==n)this.fsw._symlinkPaths.set(I,n),this.fsw._emit(r.CHANGE,x,g.stats)}else C.add(N),this.fsw._symlinkPaths.set(I,n),this.fsw._emit(r.ADD,x,g.stats);return this.fsw._emitReady(),!0}if(this.fsw._symlinkPaths.has(I))return!0;this.fsw._symlinkPaths.set(I,!0)}_handleRead(g,$,x,N,I,C,n){if(g=P.join(g,""),n=this.fsw._throttle("readdir",g,1000),!n)return;let G=this.fsw._getWatchedDir(x.path),J=new Set,Z=this.fsw._readdirp(g,{fileFilter:(z)=>x.filterPath(z),directoryFilter:(z)=>x.filterDir(z)});if(!Z)return;return Z.on(m4,async(z)=>{if(this.fsw.closed){Z=void 0;return}let X=z.path,K=P.join(g,X);if(J.add(X),z.stats.isSymbolicLink()&&await this._handleSymlink(z,g,K,X))return;if(this.fsw.closed){Z=void 0;return}if(X===N||!N&&!G.has(X))this.fsw._incrReadyCount(),K=P.join(I,P.relative(I,K)),this._addToNodeFs(K,$,x,C+1)}).on(r.ERROR,this._boundHandleError),new Promise((z,X)=>{if(!Z)return X();Z.once(R0,()=>{if(this.fsw.closed){Z=void 0;return}let K=n?n.clear():!1;if(z(void 0),G.getChildren().filter((R)=>{return R!==g&&!J.has(R)}).forEach((R)=>{this.fsw._remove(g,R)}),Z=void 0,K)this._handleRead(g,!1,x,N,I,C,n)})})}async _handleDir(g,$,x,N,I,C,n){let G=this.fsw._getWatchedDir(P.dirname(g)),J=G.has(P.basename(g));if(!(x&&this.fsw.options.ignoreInitial)&&!I&&!J)this.fsw._emit(r.ADD_DIR,g,$);G.add(P.basename(g)),this.fsw._getWatchedDir(g);let Z,z,X=this.fsw.options.depth;if((X==null||N<=X)&&!this.fsw._symlinkPaths.has(n)){if(!I){if(await this._handleRead(g,x,C,I,g,N,Z),this.fsw.closed)return}z=this._watchWithNodeFs(g,(K,R)=>{if(R&&R.mtimeMs===0)return;this._handleRead(K,!1,C,I,g,N,Z)})}return z}async _addToNodeFs(g,$,x,N,I){let C=this.fsw._emitReady;if(this.fsw._isIgnored(g)||this.fsw.closed)return C(),!1;let n=this.fsw._getWatchHelpers(g);if(x)n.filterPath=(G)=>x.filterPath(G),n.filterDir=(G)=>x.filterDir(G);try{let G=await W4[n.statMethod](n.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(n.watchPath,G))return C(),!1;let J=this.fsw.options.followSymlinks,Z;if(G.isDirectory()){let z=P.resolve(g),X=J?await K0(g):g;if(this.fsw.closed)return;if(Z=await this._handleDir(n.watchPath,G,$,N,I,n,X),this.fsw.closed)return;if(z!==X&&X!==void 0)this.fsw._symlinkPaths.set(z,X)}else if(G.isSymbolicLink()){let z=J?await K0(g):g;if(this.fsw.closed)return;let X=P.dirname(n.watchPath);if(this.fsw._getWatchedDir(X).add(n.watchPath),this.fsw._emit(r.ADD,n.watchPath,G),Z=await this._handleDir(X,G,$,N,g,n,z),this.fsw.closed)return;if(z!==void 0)this.fsw._symlinkPaths.set(P.resolve(g),z)}else Z=this._handleFile(n.watchPath,G,$);if(C(),Z)this.fsw._addPathCloser(g,Z);return!1}catch(G){if(this.fsw._handleError(G))return C(),g}}}/*! chokidar - MIT License (c) 2012 Paul Miller (paulmillr.com) */var V0="/",k4="//",h$=".",p4="..",o4="string",s4=/\\/g,i$=/\/\//,a4=/\..*\.(sw[px])$|~$|\.subl.*\.tmp/,r4=/^\.[/\\]/;function qg(g){return Array.isArray(g)?g:[g]}var A0=(g)=>typeof g==="object"&&g!==null&&!(g instanceof RegExp);function t4(g){if(typeof g==="function")return g;if(typeof g==="string")return($)=>g===$;if(g instanceof RegExp)return($)=>g.test($);if(typeof g==="object"&&g!==null)return($)=>{if(g.path===$)return!0;if(g.recursive){let x=T.relative(g.path,$);if(!x)return!1;return!x.startsWith("..")&&!T.isAbsolute(x)}return!1};return()=>!1}function e4(g){if(typeof g!=="string")throw Error("string expected");g=T.normalize(g),g=g.replace(/\\/g,"/");let $=!1;if(g.startsWith("//"))$=!0;let x=/\/\//;while(g.match(x))g=g.replace(x,"/");if($)g="/"+g;return g}function w$(g,$,x){let N=e4($);for(let I=0;I<g.length;I++){let C=g[I];if(C(N,x))return!0}return!1}function g3(g,$){if(g==null)throw TypeError("anymatch: specify first argument");let N=qg(g).map((I)=>t4(I));if($==null)return(I,C)=>{return w$(N,I,C)};return w$(N,$)}var d$=(g)=>{let $=qg(g).flat();if(!$.every((x)=>typeof x===o4))throw TypeError(`Non-string provided as watch path: ${$}`);return $.map(k$)},b$=(g)=>{let $=g.replace(s4,V0),x=!1;if($.startsWith(k4))x=!0;while($.match(i$))$=$.replace(i$,V0);if(x)$=V0+$;return $},k$=(g)=>b$(T.normalize(b$(g))),c$=(g="")=>($)=>{if(typeof $==="string")return k$(T.isAbsolute($)?$:T.join(g,$));else return $},$3=(g,$)=>{if(T.isAbsolute(g))return g;return T.join($,g)},x3=Object.freeze(new Set);class p${constructor(g,$){this.path=g,this._removeWatcher=$,this.items=new Set}add(g){let{items:$}=this;if(!$)return;if(g!==h$&&g!==p4)$.add(g)}async remove(g){let{items:$}=this;if(!$)return;if($.delete(g),$.size>0)return;let x=this.path;try{await c4(x)}catch(N){if(this._removeWatcher)this._removeWatcher(T.dirname(x),T.basename(x))}}has(g){let{items:$}=this;if(!$)return;return $.has(g)}getChildren(){let{items:g}=this;if(!g)return[];return[...g.values()]}dispose(){this.items.clear(),this.path="",this._removeWatcher=Ug,this.items=x3,Object.freeze(this)}}var N3="stat",I3="lstat";class o${constructor(g,$,x){this.fsw=x;let N=g;this.path=g=g.replace(r4,""),this.watchPath=N,this.fullWatchPath=T.resolve(N),this.dirParts=[],this.dirParts.forEach((I)=>{if(I.length>1)I.pop()}),this.followSymlinks=$,this.statMethod=$?N3:I3}entryPath(g){return T.join(this.watchPath,T.relative(this.watchPath,g.fullPath))}filterPath(g){let{stats:$}=g;if($&&$.isSymbolicLink())return this.filterDir(g);let x=this.entryPath(g);return this.fsw._isntIgnored(x,$)&&this.fsw._hasReadPermissions($)}filterDir(g){return this.fsw._isntIgnored(this.entryPath(g),g.stats)}}class s$ extends h4{constructor(g={}){super();this.closed=!1,this._closers=new Map,this._ignoredPaths=new Set,this._throttled=new Map,this._streams=new Set,this._symlinkPaths=new Map,this._watched=new Map,this._pendingWrites=new Map,this._pendingUnlinks=new Map,this._readyCount=0,this._readyEmitted=!1;let $=g.awaitWriteFinish,x={stabilityThreshold:2000,pollInterval:100},N={persistent:!0,ignoreInitial:!1,ignorePermissionErrors:!1,interval:100,binaryInterval:300,followSymlinks:!0,usePolling:!1,atomic:!0,...g,ignored:g.ignored?qg(g.ignored):qg([]),awaitWriteFinish:$===!0?x:typeof $==="object"?{...x,...$}:!1};if(y$)N.usePolling=!0;if(N.atomic===void 0)N.atomic=!N.usePolling;let I=process.env.CHOKIDAR_USEPOLLING;if(I!==void 0){let G=I.toLowerCase();if(G==="false"||G==="0")N.usePolling=!1;else if(G==="true"||G==="1")N.usePolling=!0;else N.usePolling=!!G}let C=process.env.CHOKIDAR_INTERVAL;if(C)N.interval=Number.parseInt(C,10);let n=0;this._emitReady=()=>{if(n++,n>=this._readyCount)this._emitReady=Ug,this._readyEmitted=!0,process.nextTick(()=>this.emit(m.READY))},this._emitRaw=(...G)=>this.emit(m.RAW,...G),this._boundRemove=this._remove.bind(this),this.options=N,this._nodeFsHandler=new H0(this),Object.freeze(N)}_addIgnoredPath(g){if(A0(g)){for(let $ of this._ignoredPaths)if(A0($)&&$.path===g.path&&$.recursive===g.recursive)return}this._ignoredPaths.add(g)}_removeIgnoredPath(g){if(this._ignoredPaths.delete(g),typeof g==="string"){for(let $ of this._ignoredPaths)if(A0($)&&$.path===g)this._ignoredPaths.delete($)}}add(g,$,x){let{cwd:N}=this.options;this.closed=!1,this._closePromise=void 0;let I=d$(g);if(N)I=I.map((C)=>{return $3(C,N)});if(I.forEach((C)=>{this._removeIgnoredPath(C)}),this._userIgnored=void 0,!this._readyCount)this._readyCount=0;return this._readyCount+=I.length,Promise.all(I.map(async(C)=>{let n=await this._nodeFsHandler._addToNodeFs(C,!x,void 0,0,$);if(n)this._emitReady();return n})).then((C)=>{if(this.closed)return;C.forEach((n)=>{if(n)this.add(T.dirname(n),T.basename($||n))})}),this}unwatch(g){if(this.closed)return this;let $=d$(g),{cwd:x}=this.options;return $.forEach((N)=>{if(!T.isAbsolute(N)&&!this._closers.has(N)){if(x)N=T.join(x,N);N=T.resolve(N)}if(this._closePath(N),this._addIgnoredPath(N),this._watched.has(N))this._addIgnoredPath({path:N,recursive:!0});this._userIgnored=void 0}),this}close(){if(this._closePromise)return this._closePromise;this.closed=!0,this.removeAllListeners();let g=[];return this._closers.forEach(($)=>$.forEach((x)=>{let N=x();if(N instanceof Promise)g.push(N)})),this._streams.forEach(($)=>$.destroy()),this._userIgnored=void 0,this._readyCount=0,this._readyEmitted=!1,this._watched.forEach(($)=>$.dispose()),this._closers.clear(),this._watched.clear(),this._streams.clear(),this._symlinkPaths.clear(),this._throttled.clear(),this._closePromise=g.length?Promise.all(g).then(()=>{return}):Promise.resolve(),this._closePromise}getWatched(){let g={};return this._watched.forEach(($,x)=>{let I=(this.options.cwd?T.relative(this.options.cwd,x):x)||h$;g[I]=$.getChildren().sort()}),g}emitWithAll(g,$){if(this.emit(g,...$),g!==m.ERROR)this.emit(m.ALL,g,...$)}async _emit(g,$,x){if(this.closed)return;let N=this.options;if(O0)$=T.normalize($);if(N.cwd)$=T.relative(N.cwd,$);let I=[$];if(x!=null)I.push(x);let C=N.awaitWriteFinish,n;if(C&&(n=this._pendingWrites.get($)))return n.lastChange=new Date,this;if(N.atomic){if(g===m.UNLINK)return this._pendingUnlinks.set($,[g,...I]),setTimeout(()=>{this._pendingUnlinks.forEach((G,J)=>{this.emit(...G),this.emit(m.ALL,...G),this._pendingUnlinks.delete(J)})},typeof N.atomic==="number"?N.atomic:100),this;if(g===m.ADD&&this._pendingUnlinks.has($))g=m.CHANGE,this._pendingUnlinks.delete($)}if(C&&(g===m.ADD||g===m.CHANGE)&&this._readyEmitted){let G=(J,Z)=>{if(J)g=m.ERROR,I[0]=J,this.emitWithAll(g,I);else if(Z){if(I.length>1)I[1]=Z;else I.push(Z);this.emitWithAll(g,I)}};return this._awaitWriteFinish($,C.stabilityThreshold,g,G),this}if(g===m.CHANGE){if(!this._throttle(m.CHANGE,$,50))return this}if(N.alwaysStat&&x===void 0&&(g===m.ADD||g===m.ADD_DIR||g===m.CHANGE)){let G=N.cwd?T.join(N.cwd,$):$,J;try{J=await b4(G)}catch(Z){}if(!J||this.closed)return;I.push(J)}return this.emitWithAll(g,I),this}_handleError(g){let $=g&&g.code;if(g&&$!=="ENOENT"&&$!=="ENOTDIR"&&(!this.options.ignorePermissionErrors||$!=="EPERM"&&$!=="EACCES"))this.emit(m.ERROR,g);return g||this.closed}_throttle(g,$,x){if(!this._throttled.has(g))this._throttled.set(g,new Map);let N=this._throttled.get(g);if(!N)throw Error("invalid throttle");let I=N.get($);if(I)return I.count++,!1;let C,n=()=>{let J=N.get($),Z=J?J.count:0;if(N.delete($),clearTimeout(C),J)clearTimeout(J.timeoutObject);return Z};C=setTimeout(n,x);let G={timeoutObject:C,clear:n,count:0};return N.set($,G),G}_incrReadyCount(){return this._readyCount++}_awaitWriteFinish(g,$,x,N){let I=this.options.awaitWriteFinish;if(typeof I!=="object")return;let C=I.pollInterval,n,G=g;if(this.options.cwd&&!T.isAbsolute(g))G=T.join(this.options.cwd,g);let J=new Date,Z=this._pendingWrites;function z(X){d4(G,(K,R)=>{if(K||!Z.has(g)){if(K&&K.code!=="ENOENT")N(K);return}let j=Number(new Date);if(X&&R.size!==X.size)Z.get(g).lastChange=j;let Q=Z.get(g);if(j-Q.lastChange>=$)Z.delete(g),N(void 0,R);else n=setTimeout(z,C,R)})}if(!Z.has(g))Z.set(g,{lastChange:J,cancelWait:()=>{return Z.delete(g),clearTimeout(n),x}}),n=setTimeout(z,C)}_isIgnored(g,$){if(this.options.atomic&&a4.test(g))return!0;if(!this._userIgnored){let{cwd:x}=this.options,I=(this.options.ignored||[]).map(c$(x)),n=[...[...this._ignoredPaths].map(c$(x)),...I];this._userIgnored=g3(n,void 0)}return this._userIgnored(g,$)}_isntIgnored(g,$){return!this._isIgnored(g,$)}_getWatchHelpers(g){return new o$(g,this.options.followSymlinks,this)}_getWatchedDir(g){let $=T.resolve(g);if(!this._watched.has($))this._watched.set($,new p$($,this._boundRemove));return this._watched.get($)}_hasReadPermissions(g){if(this.options.ignorePermissionErrors)return!0;return Boolean(Number(g.mode)&256)}_remove(g,$,x){let N=T.join(g,$),I=T.resolve(N);if(x=x!=null?x:this._watched.has(N)||this._watched.has(I),!this._throttle("remove",N,100))return;if(!x&&this._watched.size===1)this.add(g,$,!0);this._getWatchedDir(N).getChildren().forEach((X)=>this._remove(N,X));let G=this._getWatchedDir(g),J=G.has($);if(G.remove($),this._symlinkPaths.has(I))this._symlinkPaths.delete(I);let Z=N;if(this.options.cwd)Z=T.relative(this.options.cwd,N);if(this.options.awaitWriteFinish&&this._pendingWrites.has(Z)){if(this._pendingWrites.get(Z).cancelWait()===m.ADD)return}this._watched.delete(N),this._watched.delete(I);let z=x?m.UNLINK_DIR:m.UNLINK;if(J&&!this._isIgnored(N))this._emit(z,N);this._closePath(N)}_closePath(g){this._closeFile(g);let $=T.dirname(g);this._getWatchedDir($).remove(T.basename(g))}_closeFile(g){let $=this._closers.get(g);if(!$)return;$.forEach((x)=>x()),this._closers.delete(g)}_addPathCloser(g,$){if(!$)return;let x=this._closers.get(g);if(!x)x=[],this._closers.set(g,x);x.push($)}_readdirp(g,$){if(this.closed)return;let x={type:m.ALL,alwaysStat:!0,lstat:!0,...$,depth:0},N=P$(g,x);return this._streams.add(N),N.once(v$,()=>{N=void 0}),N.once(R0,()=>{if(N)this._streams.delete(N),N=void 0}),N}}function Bg(g,$={}){let x=new s$($);return x.add(g),x}import{createServer as T5}from"node:http";import{readFileSync as L5,existsSync as _5,readdirSync as t1,statSync as i0,mkdirSync as m5}from"node:fs";import{join as e,basename as e2}from"node:path";var q5=p(c2(),1),B5=p(T0(),1),l5=p(_0(),1),f0=p(fg(),1),v0=p(r2(),1);var yg=p(q1(),1),t2=process.env.DASHBOARD_PORT?parseInt(process.env.DASHBOARD_PORT):9847;function S5(){if(process.env.MEMORIES_DIR)return process.env.MEMORIES_DIR;let g=process.argv[3];if(g)return e(g,".serena","memories");return e(process.cwd(),".serena","memories")}function e1(g){try{return L5(g,"utf-8")}catch{return""}}function F5(g){try{let $=t1(g);if($.includes("orchestrator-session.md"))return e(g,"orchestrator-session.md");let x=$.filter((N)=>/^session-.*\.md$/.test(N)).map((N)=>({name:N,mtime:i0(e(g,N)).mtimeMs})).sort((N,I)=>I.mtime-N.mtime);if(x.length>0)return e(g,x[0].name)}catch{}return null}function P5(g){let $=F5(g);if(!$)return{id:"N/A",status:"UNKNOWN"};let x=e1($);if(!x)return{id:"N/A",status:"UNKNOWN"};let N=(x.match(/session-id:\s*(.+)/i)||[])[1]||(x.match(/# Session:\s*(.+)/i)||[])[1]||x.match(/(session-\d{8}-\d{6})/)?.[1]||e2($,".md")||"N/A",I="UNKNOWN";if(/IN PROGRESS|RUNNING|## Active|\[IN PROGRESS\]/i.test(x))I="RUNNING";else if(/COMPLETED|DONE|## Completed|\[COMPLETED\]/i.test(x))I="COMPLETED";else if(/FAILED|ERROR|## Failed|\[FAILED\]/i.test(x))I="FAILED";else if(/Step \d+:.*\[/i.test(x))I="RUNNING";return{id:N.trim(),status:I}}function u5(g){let $=e1(e(g,"task-board.md"));if(!$)return[];let x=[],N=$.split(`
`);for(let I of N){if(!I.startsWith("|")||/^\|\s*-+/.test(I))continue;let C=I.split("|").map((n)=>n.trim()).filter(Boolean);if(C.length<2||/^agent$/i.test(C[0]))continue;x.push({agent:C[0]||"",status:C[1]||"pending",task:C[2]||""})}return x}function E0(g,$){try{let x=t1(g).filter((C)=>C.startsWith(`progress-${$}`)&&C.endsWith(".md")).sort().reverse();if(x.length===0)return null;let I=e1(e(g,x[0])).match(/turn[:\s]*(\d+)/i);return I?parseInt(I[1],10):null}catch{return null}}function W5(g){try{return t1(g).filter((x)=>x.endsWith(".md")&&x!==".gitkeep").map((x)=>({name:x,mtime:i0(e(g,x)).mtimeMs})).sort((x,N)=>N.mtime-x.mtime).slice(0,10).map((x)=>{let N=x.name.replace(/^(progress|result|session|debug|task)-?/,"").replace(/[-_]agent/,"").replace(/[-_]completion/,"").replace(/\.md$/,"").replace(/[-_]/g," ").trim()||x.name.replace(/\.md$/,""),C=e1(e(g,x.name)).split(`
`).map((G)=>G.trim()).filter((G)=>G&&!G.startsWith("---")&&G.length>3),n="";for(let G=C.length-1;G>=0;G--){let J=C[G];if(/^\*\*|^#+|^-|^\d+\.|Status|Result|Action|Step/i.test(J)){if(n=J.replace(/^[#*\-\d.]+\s*/,"").replace(/\*\*/g,"").trim(),n.length>5)break}}if(n.length>80)n=n.substring(0,77)+"...";return{agent:N,message:n,file:x.name}}).filter((x)=>x.message)}catch{return[]}}function f5(g){let $=[],x=new Set;try{let N=t1(g).filter((I)=>I.endsWith(".md")&&I!==".gitkeep").map((I)=>({name:I,mtime:i0(e(g,I)).mtimeMs})).sort((I,C)=>C.mtime-I.mtime);for(let I of N){let C=e1(e(g,I.name)),n=C.match(/\*\*Agent\*\*:\s*(.+)/i)||C.match(/Agent:\s*(.+)/i)||C.match(/^#+\s*(.+?)\s*Agent/im),G=null;if(n)G=n[1].trim();else if(/_agent|agent_|-agent/i.test(I.name))G=I.name.replace(/\.md$/,"").replace(/[-_]completion|[-_]progress|[-_]result/gi,"").replace(/[-_]/g," ").trim();if(G&&!x.has(G.toLowerCase())){x.add(G.toLowerCase());let J="unknown";if(/\[COMPLETED\]|## Completed|## Results/i.test(C))J="completed";else if(/\[IN PROGRESS\]|## Progress|IN PROGRESS/i.test(C))J="running";else if(/\[FAILED\]|## Failed|ERROR/i.test(C))J="failed";let Z=C.match(/## Task\s*\n+(.+)/i)||C.match(/\*\*Task\*\*:\s*(.+)/i),z=Z?Z[1].trim().substring(0,60):"";$.push({agent:G,status:J,task:z,turn:E0(g,G)})}}}catch{}return $}function y0(g){let $=P5(g),N=u5(g).map((I)=>({...I,turn:E0(g,I.agent)}));if(N.length===0)N=f5(g);if(N.length===0)try{let I=t1(g).filter((C)=>C.startsWith("progress-")&&C.endsWith(".md"));for(let C of I){let n=C.replace(/^progress-/,"").replace(/\.md$/,"");N.push({agent:n,status:"running",task:"",turn:E0(g,n)})}}catch{}return{session:$,agents:N,activity:W5(g),memoriesDir:g,updatedAt:new Date().toISOString()}}var v5=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Serena Memory Dashboard</title>
  <style>
    :root { --bg:#0f0b1a;--surface:#1a1428;--surface-2:#241e33;--border:#3d2e5c;--purple:#9b59b6;--purple-light:#c39bd3;--purple-dark:#6c3483;--text:#e8e0f0;--text-dim:#8a7da0;--green:#2ecc71;--red:#e74c3c;--yellow:#f1c40f;--cyan:#1abc9c; }
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:var(--bg);color:var(--text);font-family:'SF Mono','Fira Code',monospace;min-height:100vh;padding:24px}
    .header{display:flex;align-items:center;gap:16px;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid var(--border)}
    .logo{width:48px;height:48px;background:linear-gradient(135deg,var(--purple),var(--purple-dark));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:bold;color:white}
    .header-text h1{font-size:20px;color:var(--purple-light)} .header-text .subtitle{font-size:12px;color:var(--text-dim)}
    .connection-badge{margin-left:auto;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:600}
    .connection-badge.connected{background:rgba(46,204,113,0.15);color:var(--green);border:1px solid rgba(46,204,113,0.3)}
    .connection-badge.disconnected{background:rgba(231,76,60,0.15);color:var(--red);border:1px solid rgba(231,76,60,0.3)}
    .connection-badge.connecting{background:rgba(241,196,15,0.15);color:var(--yellow);border:1px solid rgba(241,196,15,0.3)}
    .session-bar{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:16px 20px;margin-bottom:20px;display:flex;align-items:center;gap:20px}
    .session-id{font-size:14px;font-weight:600}
    .session-status{padding:3px 10px;border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px}
    .session-status.running{background:rgba(46,204,113,0.15);color:var(--green)}
    .session-status.completed{background:rgba(26,188,156,0.15);color:var(--cyan)}
    .session-status.failed{background:rgba(231,76,60,0.15);color:var(--red)}
    .session-status.unknown{background:rgba(138,125,160,0.15);color:var(--text-dim)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px} @media(max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:hidden}
    .card-header{padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:var(--purple-light);background:var(--surface-2)}
    .card-body{padding:16px}
    .agent-table{width:100%;border-collapse:collapse;font-size:13px}
    .agent-table th{text-align:left;padding:8px 12px;color:var(--text-dim);font-weight:500;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid var(--border)}
    .agent-table td{padding:10px 12px;border-bottom:1px solid rgba(61,46,92,0.4)} .agent-table tr:last-child td{border-bottom:none}
    .status-dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:6px}
    .status-dot.running{background:var(--green);box-shadow:0 0 6px var(--green)} .status-dot.completed{background:var(--cyan)} .status-dot.failed{background:var(--red)} .status-dot.blocked{background:var(--yellow)} .status-dot.pending{background:var(--text-dim)}
    .activity-list{list-style:none;font-size:12px} .activity-list li{padding:8px 0;border-bottom:1px solid rgba(61,46,92,0.3);display:flex;gap:8px} .activity-list li:last-child{border-bottom:none}
    .activity-agent{color:var(--purple-light);font-weight:600;white-space:nowrap} .activity-msg{color:var(--text-dim)}
    .empty{color:var(--text-dim);font-size:12px;font-style:italic;padding:12px 0}
    .footer{margin-top:20px;padding-top:12px;border-top:1px solid var(--border);display:flex;justify-content:space-between;font-size:11px;color:var(--text-dim)}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}} .pulse{animation:pulse 2s ease-in-out infinite}
  </style>
</head>
<body>
  <div class="header"><div class="logo">S</div><div class="header-text"><h1>Serena Memory Dashboard</h1><div class="subtitle">Real-time agent orchestration monitor</div></div><div class="connection-badge connecting" id="connBadge">Connecting...</div></div>
  <div class="session-bar"><span>Session:</span><span class="session-id" id="sessionId">N/A</span><span class="session-status unknown" id="sessionStatus">UNKNOWN</span><span style="margin-left:auto;font-size:11px;color:var(--text-dim)" id="updatedAt">--</span></div>
  <div class="grid"><div class="card"><div class="card-header">Agent Status</div><div class="card-body"><table class="agent-table"><thead><tr><th>Agent</th><th>Status</th><th>Turn</th><th>Task</th></tr></thead><tbody id="agentBody"><tr><td colspan="4" class="empty">No agents detected yet</td></tr></tbody></table></div></div><div class="card"><div class="card-header">Latest Activity</div><div class="card-body"><ul class="activity-list" id="activityList"><li class="empty">No activity yet</li></ul></div></div></div>
  <div class="footer"><span>Serena Memory Dashboard</span><span id="footerTime">--</span></div>
  <script>
    const $=s=>document.querySelector(s);
    function normalizeStatus(s){const l=(s||'').toLowerCase();if(['running','active','in_progress','in-progress'].includes(l))return'running';if(['completed','done','finished'].includes(l))return'completed';if(['failed','error'].includes(l))return'failed';if(['blocked','waiting'].includes(l))return'blocked';return'pending'}
    function clearChildren(el){while(el.firstChild)el.removeChild(el.firstChild)}
    function createTextEl(tag,text,cls){const el=document.createElement(tag);el.textContent=text;if(cls)el.className=cls;return el}
    function renderAgents(agents){const tbody=$('#agentBody');clearChildren(tbody);if(!agents||!agents.length){const tr=document.createElement('tr'),td=createTextEl('td','No agents detected yet','empty');td.setAttribute('colspan','4');tr.appendChild(td);tbody.appendChild(tr);return}agents.forEach(a=>{const ns=normalizeStatus(a.status),tr=document.createElement('tr');tr.appendChild(createTextEl('td',a.agent));const std=document.createElement('td'),dot=document.createElement('span');dot.className='status-dot '+ns+(ns==='running'?' pulse':'');std.appendChild(dot);std.appendChild(createTextEl('span',ns,'status-text'));tr.appendChild(std);tr.appendChild(createTextEl('td',a.turn!=null?String(a.turn):'-'));tr.appendChild(createTextEl('td',a.task||''));tbody.appendChild(tr)})}
    function renderActivity(activity){const list=$('#activityList');clearChildren(list);if(!activity||!activity.length){list.appendChild(createTextEl('li','No activity yet','empty'));return}activity.forEach(a=>{const li=document.createElement('li');li.appendChild(createTextEl('span','['+a.agent+']','activity-agent'));li.appendChild(createTextEl('span',a.message,'activity-msg'));list.appendChild(li)})}
    function renderState(state){$('#sessionId').textContent=state.session?.id||'N/A';const st=(state.session?.status||'UNKNOWN').toUpperCase(),sel=$('#sessionStatus');sel.textContent=st;sel.className='session-status '+st.toLowerCase();if(state.updatedAt){const ts=new Date(state.updatedAt).toLocaleString();$('#updatedAt').textContent='Updated: '+ts;$('#footerTime').textContent=ts}renderAgents(state.agents);renderActivity(state.activity)}
    let ws,rd=1000;function connect(){const b=$('#connBadge');b.textContent='Connecting...';b.className='connection-badge connecting';const p=location.protocol==='https:'?'wss:':'ws:';ws=new WebSocket(p+'//'+location.host);ws.onopen=()=>{b.textContent='Connected';b.className='connection-badge connected';rd=1000};ws.onmessage=e=>{try{const m=JSON.parse(e.data);if(m.data)renderState(m.data)}catch{}};ws.onclose=()=>{b.textContent='Disconnected';b.className='connection-badge disconnected';setTimeout(()=>{rd=Math.min(rd*1.5,10000);connect()},rd)};ws.onerror=()=>ws.close()}
    fetch('/api/state').then(r=>r.json()).then(renderState).catch(()=>{});connect();
  </script>
</body>
</html>`;function gx(){let g=S5();if(!_5(g))m5(g,{recursive:!0});let $=T5((n,G)=>{if(n.url==="/api/state")G.writeHead(200,{"Content-Type":"application/json"}),G.end(JSON.stringify(y0(g)));else G.writeHead(200,{"Content-Type":"text/html"}),G.end(v5)}),x=new v0.default({server:$}),N=null;function I(n,G){if(N)clearTimeout(N);N=setTimeout(()=>{let J=JSON.stringify({type:"update",event:n,file:G,data:y0(g)});x.clients.forEach((Z)=>{if(Z.readyState===f0.default.OPEN)Z.send(J)})},100)}let C=Bg(g,{persistent:!0,ignoreInitial:!0,awaitWriteFinish:{stabilityThreshold:200,pollInterval:50}});C.on("all",(n,G)=>I(n,e2(G))),x.on("connection",(n)=>{n.send(JSON.stringify({type:"full",data:y0(g)})),n.on("error",()=>n.terminate())}),process.on("SIGINT",()=>{console.log(`
Shutting down...`),C.close(),x.clients.forEach((n)=>n.terminate()),x.close(()=>$.close(()=>process.exit(0))),setTimeout(()=>process.exit(1),3000).unref()}),process.on("SIGTERM",()=>process.emit("SIGINT")),$.listen(t2,()=>{console.log(yg.default.magenta(`
  \uD83D\uDEF8 Serena Memory Dashboard`)),console.log(yg.default.white(`     http://localhost:${t2}`)),console.log(yg.default.dim(`     Watching: ${g}
`))})}var v=p(q1(),1);import{readFileSync as y5,existsSync as E5,readdirSync as gg,statSync as d0,mkdirSync as i5}from"node:fs";import{join as g1,basename as w5}from"node:path";var d5="",b5="",c5="",h5="",k5="";function p5(){if(process.env.MEMORIES_DIR)return process.env.MEMORIES_DIR;let g=process.argv[3];if(g)return g1(g,".serena","memories");return g1(process.cwd(),".serena","memories")}function $g(g){try{return y5(g,"utf-8")}catch{return""}}function o5(g){try{let $=gg(g);if($.includes("orchestrator-session.md"))return g1(g,"orchestrator-session.md");let x=$.filter((N)=>/^session-.*\.md$/.test(N)).map((N)=>({name:N,mtime:d0(g1(g,N)).mtimeMs})).sort((N,I)=>I.mtime-N.mtime);if(x.length>0&&x[0])return g1(g,x[0].name)}catch{}return null}function s5(g){let $=o5(g);if(!$)return{id:"N/A",status:"UNKNOWN"};let x=$g($);if(!x)return{id:"N/A",status:"UNKNOWN"};let N=(x.match(/session-id:\s*(.+)/i)||[])[1]||(x.match(/# Session:\s*(.+)/i)||[])[1]||x.match(/(session-\d{8}-\d{6})/)?.[1]||w5($,".md"),I="UNKNOWN";if(/IN PROGRESS|RUNNING|## Active|\[IN PROGRESS\]/i.test(x))I="RUNNING";else if(/COMPLETED|DONE|## Completed|\[COMPLETED\]/i.test(x))I="COMPLETED";else if(/FAILED|ERROR|## Failed|\[FAILED\]/i.test(x))I="FAILED";else if(/Step \d+:.*\[/i.test(x))I="RUNNING";return{id:(N||"N/A").trim(),status:I}}function a5(g){let $=$g(g1(g,"task-board.md"));if(!$)return[];let x=[],N=$.split(`
`);for(let I of N){if(!I.startsWith("|")||/^\|\s*-+/.test(I))continue;let C=I.split("|").map((Z)=>Z.trim()).filter(Boolean),n=C[0];if(C.length<2||!n||/^agent$/i.test(n))continue;let G=C[1],J=C[2];x.push({agent:n,status:G||"pending",task:J||""})}return x}function w0(g,$){try{let x=gg(g).filter((C)=>C.startsWith(`progress-${$}`)&&C.endsWith(".md")).sort().reverse();if(x.length===0||!x[0])return null;let I=$g(g1(g,x[0])).match(/turn[:\s]*(\d+)/i);return I&&I[1]?parseInt(I[1],10):null}catch{return null}}function r5(g){try{let $=gg(g).filter((N)=>N.endsWith(".md")&&N!==".gitkeep").map((N)=>({name:N,mtime:d0(g1(g,N)).mtimeMs})).sort((N,I)=>I.mtime-N.mtime).slice(0,5),x=[];for(let N of $){let I=N.name.replace(/^(progress|result|session|debug|task)-?/,"").replace(/[-_]agent/,"").replace(/[-_]completion/,"").replace(/\.md$/,"").replace(/[-_]/g," ").trim()||N.name.replace(/\.md$/,""),n=$g(g1(g,N.name)).split(`
`).map((J)=>J.trim()).filter((J)=>J&&!J.startsWith("---")&&J.length>3),G="";for(let J=n.length-1;J>=0;J--){let Z=n[J];if(!Z)continue;if(/^\*\*|^#+|^-|^\d+\.|Status|Result|Action|Step/i.test(Z)){if(G=Z.replace(/^[#*\-\d.]+\s*/,"").replace(/\*\*/g,"").trim(),G.length>5)break}}if(G.length>52)G=G.substring(0,49)+"...";if(G)x.push({agent:I,message:G})}return x}catch{return[]}}function t5(g){let $=[],x=new Set;try{let N=gg(g).filter((I)=>I.endsWith(".md")&&I!==".gitkeep").map((I)=>({name:I,mtime:d0(g1(g,I)).mtimeMs})).sort((I,C)=>C.mtime-I.mtime);for(let I of N){let C=$g(g1(g,I.name)),n=C.match(/\*\*Agent\*\*:\s*(.+)/i)||C.match(/Agent:\s*(.+)/i)||C.match(/^#+\s*(.+?)\s*Agent/im),G=null;if(n&&n[1])G=n[1].trim();else if(/_agent|agent_|-agent/i.test(I.name))G=I.name.replace(/\.md$/,"").replace(/[-_]completion|[-_]progress|[-_]result/gi,"").replace(/[-_]/g," ").trim();if(G&&!x.has(G.toLowerCase())){x.add(G.toLowerCase());let J="unknown";if(/\[COMPLETED\]|## Completed|## Results/i.test(C))J="completed";else if(/\[IN PROGRESS\]|## Progress|IN PROGRESS/i.test(C))J="running";else if(/\[FAILED\]|## Failed|ERROR/i.test(C))J="failed";let Z=C.match(/## Task\s*\n+(.+)/i)||C.match(/\*\*Task\*\*:\s*(.+)/i),z=Z&&Z[1]?Z[1].trim().substring(0,20):"";$.push({agent:G,status:J,task:z,turn:w0(g,G)})}}}catch{}return $}function e5(g){let $=g.toLowerCase();if(["running","active","in_progress","in-progress"].includes($))return`${v.default.green(d5)} running`;else if(["completed","done","finished"].includes($))return`${v.default.cyan(b5)} completed`;else if(["failed","error"].includes($))return`${v.default.red(c5)} failed`;else if(["blocked","waiting"].includes($))return`${v.default.yellow(h5)} blocked`;return`${v.default.dim(k5)} pending`}function $x(g){console.clear();let $=s5(g),N=a5(g).map((Q)=>({...Q,turn:w0(g,Q.agent)}));if(N.length===0)N=t5(g);if(N.length===0)try{let Q=gg(g).filter((Y)=>Y.startsWith("progress-")&&Y.endsWith(".md"));for(let Y of Q){let V=Y.replace(/^progress-/,"").replace(/\.md$/,"");N.push({agent:V,status:"running",task:"",turn:w0(g,V)})}}catch{}let I=56,C="".repeat(I),n=(Q)=>" ".repeat(Math.max(0,Q)),G=(Q)=>v.default.magenta(Q),J=(Q)=>v.default.bold(Q),Z=(Q)=>v.default.dim(Q),z=v.default.yellow;if($.status==="RUNNING")z=v.default.green;else if($.status==="COMPLETED")z=v.default.cyan;else if($.status==="FAILED")z=v.default.red;console.log(`${G(""+C+"")}`),console.log(`${G("")}  ${J(G("Serena Memory Dashboard"))}${n(I-25)}${G("")}`);let X=`Session: ${J($.id.padEnd(20))} [${z($.status)}]`;if(console.log(`${G("")}  ${X}${n(I-4-X.length-9)}${G("")}`),console.log(`${G(""+C+"")}`),console.log(`${G("")}  ${J("Agent".padEnd(12)+" "+"Status".padEnd(12)+" "+"Turn".padEnd(6)+" "+"Task".padEnd(20))}  ${G("")}`),console.log(`${G("")}  ${Z("".padEnd(12)+" "+"".padEnd(12)+" "+"".padEnd(6)+" "+"".padEnd(20))}  ${G("")}`),N.length===0)console.log(`${G("")}  ${Z("No agents detected yet"+n(32))}${G("")}`);else for(let Q of N){let Y=e5(Q.status),V=Q.turn!=null?String(Q.turn):"-",A=Q.task.substring(0,20);console.log(`${G("")}  ${Q.agent.padEnd(12)} ${Y.padEnd(22)} ${V.padEnd(6)} ${A.padEnd(20)}${G("")}`)}console.log(`${G(""+C+"")}`),console.log(`${G("")}  ${J("Latest Activity:")}${n(I-18)}${G("")}`);let K=r5(g);if(K.length===0)console.log(`${G("")}  ${Z("No activity yet"+n(38))}${G("")}`);else for(let Q of K){let Y=`[${Q.agent}] ${Q.message}`;console.log(`${G("")}  ${Z(Y.substring(0,52).padEnd(52))}${G("")}`)}console.log(`${G(""+C+"")}`);let j=`Updated: ${new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}  |  Ctrl+C to exit`;console.log(`${G("")}  ${Z(j)}${n(I-4-j.length)}${G("")}`),console.log(`${G(""+C+"")}`)}function xx(){let g=p5();if(!E5(g))i5(g,{recursive:!0}),console.log(v.default.yellow(`Created ${g}  waiting for memory files...`));console.log(v.default.magenta(`
  \uD83D\uDEF8 Serena Terminal Dashboard`)),console.log(v.default.dim(`     Watching: ${g}
`)),$x(g);let $=Bg(g,{persistent:!0,ignoreInitial:!0,awaitWriteFinish:{stabilityThreshold:200,pollInterval:50}});$.on("all",()=>$x(g)),process.on("SIGINT",()=>{console.log(`
`),$.close(),process.exit(0)}),process.on("SIGTERM",()=>process.emit("SIGINT"))}var Eg=process.argv.slice(2);if(Eg[0]==="dashboard")xx();else if(Eg[0]==="dashboard:web")gx();else if(Eg[0]==="update")Q6().catch(console.error);else if(Eg[0]==="doctor")M6().catch(console.error);else Y6().catch(console.error);var c0="first-fluke/oh-my-antigravity",h0=`https://raw.githubusercontent.com/${c0}/main/.agent/skills`,Q1={domain:[{name:"frontend-agent",desc:"React/Next.js UI specialist"},{name:"backend-agent",desc:"FastAPI/SQLAlchemy API specialist"},{name:"mobile-agent",desc:"Flutter/Dart mobile specialist"}],coordination:[{name:"pm-agent",desc:"Product manager - task decomposition"},{name:"qa-agent",desc:"QA - OWASP, Lighthouse, WCAG"},{name:"workflow-guide",desc:"Manual multi-agent orchestration"},{name:"orchestrator",desc:"Automated parallel CLI execution"}],utility:[{name:"debug-agent",desc:"Bug fixing specialist"},{name:"commit",desc:"Conventional Commits helper"}]},x6={fullstack:["frontend-agent","backend-agent","pm-agent","qa-agent","debug-agent","commit"],frontend:["frontend-agent","pm-agent","qa-agent","debug-agent","commit"],backend:["backend-agent","pm-agent","qa-agent","debug-agent","commit"],mobile:["mobile-agent","pm-agent","qa-agent","debug-agent","commit"],all:[...Q1.domain,...Q1.coordination,...Q1.utility].map((g)=>g.name)};async function N6(g){let $=["SKILL.md"],x=["resources/execution-protocol.md","resources/tech-stack.md","resources/checklist.md","resources/templates.md","resources/error-playbook.md"];for(let N of x){let I=`${h0}/${g}/${N}`;if((await fetch(I,{method:"HEAD"})).ok)$.push(N)}return $}async function I6(g,$){let x=y($,".agent","skills",g),N=await N6(g);for(let I of N){let C=`${h0}/${g}/${I}`,n=await fetch(C);if(!n.ok)continue;let G=await n.text(),J=y(x,I),Z=b0(J);if(!h(Z))wg(Z,{recursive:!0});dg(J,G,"utf-8")}return!0}function C6(g){return $6("sha256").update(g,"utf-8").digest("hex")}async function G6(g){let $=y(g,".agent","skills","_version.json");if(!h($))return null;try{let x=Nx($,"utf-8");return JSON.parse(x).version||null}catch{return null}}async function n6(g,$){let x=y(g,".agent","skills","_version.json"),N=b0(x);if(!h(N))wg(N,{recursive:!0});dg(x,JSON.stringify({version:$},null,2),"utf-8")}async function J6(){let g=`https://raw.githubusercontent.com/${c0}/main/prompt-manifest.json`,$=await fetch(g);if(!$.ok)throw Error("Failed to fetch remote manifest");return await $.json()}async function Z6(g){let $=`https://raw.githubusercontent.com/${c0}/main/${g.path}`,x=await fetch($);if(!x.ok)return{path:g.path,success:!1,error:`HTTP ${x.status}`};let N=await x.text();if(C6(N)!==g.sha256)return{path:g.path,success:!1,error:"SHA256 mismatch"};let C=y(process.cwd(),g.path),n=b0(C);if(!h(n))wg(n,{recursive:!0});return dg(C,N,"utf-8"),{path:g.path,success:!0}}async function Q6(){console.clear(),Rg(U.default.bgMagenta(U.default.white(" \uD83D\uDEF8 oh-my-antigravity update ")));let g=process.cwd(),$=Og();try{$.start("Checking for updates...");let x=await J6(),N=await G6(g);if(N===x.version){$.stop(U.default.green("Already up to date!")),B1(`Current version: ${U.default.cyan(N)}`);return}$.message(`Updating from ${N||"not installed"} to ${U.default.cyan(x.version)}...`);let I=await z0(x.files,async(G)=>Z6(G),{concurrency:10}),C=I.filter((G)=>!G.success);if(C.length>0)$.stop("Update completed with errors"),s(C.map((G)=>`${U.default.red("")} ${G.path}: ${G.error}`).join(`
`),`${C.length} files failed`);else $.stop(`Updated to version ${U.default.cyan(x.version)}!`);await n6(g,x.version);let n=I.length-C.length;B1(C.length>0?`${n} files updated, ${C.length} failed`:`${n} files updated successfully`)}catch(x){$.stop("Update failed"),x1.error(x instanceof Error?x.message:String(x)),process.exit(1)}}async function X6(g){let $=y(g,".agent","skills","_shared"),x=["reasoning-templates.md","clarification-protocol.md","context-loading.md","skill-routing.md"];if(!h($))wg($,{recursive:!0});for(let N of x){let I=`${h0}/_shared/${N}`,C=await fetch(I);if(!C.ok)continue;let n=await C.text();dg(y($,N),n,"utf-8")}}async function ig(g,$,x){try{let N=Ix(`${$} --version`,{encoding:"utf-8",stdio:["pipe","pipe","ignore"]}).trim();return{name:g,installed:!0,version:N,installCmd:x}}catch{return{name:g,installed:!1,installCmd:x}}}async function z6(g){let $=process.env.HOME||process.env.USERPROFILE||"",N={gemini:{path:`${$}/.gemini/settings.json`,type:"json"},claude:{path:`${$}/.claude.json`,type:"json"},codex:{path:`${$}/.codex/config.toml`,type:"toml"}}[g];if(!N)return{configured:!1};if(h(N.path))try{let I=Nx(N.path,"utf-8");if(N.type==="json"){let C=JSON.parse(I);return{configured:!!(C.mcpServers||C.mcp),path:N.path}}return{configured:!0,path:N.path}}catch{return{configured:!1}}return{configured:!1}}async function j6(){let g=[];try{Ix("which fswatch",{stdio:"ignore"}),g.push({name:"fswatch",available:!0,type:"terminal"})}catch{g.push({name:"fswatch",available:!1,type:"terminal",installCmd:"brew install fswatch (macOS) or apt install inotify-tools (Linux)"})}let $=y(process.cwd(),"scripts","dashboard-web","server.js");if(h($))try{let x=y(process.cwd(),"node_modules"),N=h(y(x,"chokidar")),I=h(y(x,"ws"));if(N&&I)g.push({name:"chokidar + ws",available:!0,type:"web"});else g.push({name:"chokidar + ws",available:!1,type:"web",installCmd:"npm install"})}catch{g.push({name:"chokidar + ws",available:!1,type:"web",installCmd:"npm install"})}return g}async function K6(){let g=y(process.cwd(),".agent","skills");if(!h(g))return[];let $=[...Q1.domain,...Q1.coordination,...Q1.utility],x=[];for(let N of $){let I=y(g,N.name),C=y(I,"SKILL.md");x.push({name:N.name,installed:h(I),hasSkillMd:h(C)})}return x}async function M6(){console.clear(),Rg(U.default.bgMagenta(U.default.white(" \uD83E\uDE7A oh-my-antigravity doctor ")));let g=process.cwd(),$=Og();try{$.start("Checking CLI installations...");let x=await Promise.all([ig("gemini","gemini","npm install -g @anthropic-ai/gemini-cli"),ig("claude","claude","npm install -g @anthropic-ai/claude-code"),ig("codex","codex","npm install -g @openai/codex"),ig("qwen","qwen","pip install qwen-cli")]);$.stop("CLI check complete");let N=[U.default.bold("\uD83D\uDD0D CLI Installation Status"),"",` ${U.default.bold("CLI")}      ${U.default.bold("Status")}      ${U.default.bold("Version")}       `,"",...x.map((K)=>{let R=K.installed?U.default.green(" Installed"):U.default.red(" Missing"),j=K.version||"-";return` ${K.name.padEnd(7)}  ${R.padEnd(8)}  ${j.padEnd(11)} `}),""].join(`
`);s(N,"CLI Status");let I=x.filter((K)=>!K.installed);if(I.length>0)s(I.map((K)=>`${U.default.yellow("")} ${K.name}: ${U.default.dim(K.installCmd)}`).join(`
`),"Install missing CLIs");$.start("Checking MCP configurations...");let C=await Promise.all(x.filter((K)=>K.installed).map(async(K)=>{let R=await z6(K.name);return{...K,mcp:R}}));if($.stop("MCP check complete"),C.length>0){let K=[U.default.bold("\uD83D\uDD17 MCP Connection Status"),"",` ${U.default.bold("CLI")}      ${U.default.bold("MCP Config")}  ${U.default.bold("Path")}                `,"",...C.map((R)=>{let j=R.mcp.configured?U.default.green(" Configured"):U.default.yellow("  Not configured"),Q=R.mcp.path?R.mcp.path.split("/").pop()||"":"-";return` ${R.name.padEnd(7)}  ${j.padEnd(8)}  ${Q.padEnd(19)} `}),""].join(`
`);s(K,"MCP Status")}$.start("Checking dashboard dependencies...");let n=await j6();$.stop("Dashboard check complete");let G=[U.default.bold("\uD83D\uDCCA Dashboard Dependencies"),"",` ${U.default.bold("Dependency")}       ${U.default.bold("Status")}      ${U.default.bold("Install Command")}                    `,"",...n.map((K)=>{let R=K.available?U.default.green(" Available"):U.default.red(" Missing"),j=K.installCmd||"-";return` ${K.name.padEnd(15)}  ${R.padEnd(8)}  ${j.padEnd(34)} `}),""].join(`
`);s(G,"Dashboard Status"),$.start("Checking skills installation...");let J=await K6();if($.stop("Skills check complete"),J.length>0){let K=J.filter((Q)=>Q.installed).length,R=J.filter((Q)=>Q.hasSkillMd).length,j=[U.default.bold(`\uD83D\uDCE6 Skills (${K}/${J.length} installed, ${R} complete)`),"",` ${U.default.bold("Skill")}                 ${U.default.bold("Installed")}  ${U.default.bold("SKILL.md")}    `,"",...J.map((Q)=>{let Y=Q.installed?U.default.green(""):U.default.red(""),V=Q.hasSkillMd?U.default.green(""):U.default.red("");return` ${Q.name.padEnd(18)}  ${Y.padEnd(8)}  ${V.padEnd(11)} `}),""].join(`
`);s(j,"Skills Status")}else s(U.default.yellow("No skills installed. Run `oh-my-antigravity` to install."),"Skills Status");let Z=y(g,".serena","memories");if(h(Z))try{let K=g6(Z);s(`${U.default.green("")} Serena memory directory exists
${U.default.dim(`${K.length} memory files found`)}`,"Serena Memory")}catch{s(U.default.yellow("  Serena directory exists but cannot read files"),"Serena Memory")}else s(`${U.default.yellow("")} Serena memory directory not found
${U.default.dim("Dashboard will show 'No agents detected'")}`,"Serena Memory");let X=I.length+C.filter((K)=>!K.mcp.configured).length+n.filter((K)=>!K.available).length+(J.length===0?1:0);if(X===0)B1(U.default.green(" All checks passed! Ready to use."));else B1(U.default.yellow(`  Found ${X} issue(s). See details above.`))}catch(x){$.stop("Check failed"),x1.error(x instanceof Error?x.message:String(x)),process.exit(1)}}async function Y6(){console.clear(),Rg(U.default.bgMagenta(U.default.white(" \uD83D\uDEF8 oh-my-antigravity ")));let g=await q$({message:"What type of project?",options:[{value:"all",label:" All",hint:"Install everything"},{value:"fullstack",label:"\uD83C\uDF10 Fullstack",hint:"Frontend + Backend + PM + QA"},{value:"frontend",label:"\uD83C\uDFA8 Frontend",hint:"React/Next.js"},{value:"backend",label:" Backend",hint:"FastAPI/Python"},{value:"mobile",label:"\uD83D\uDCF1 Mobile",hint:"Flutter/Dart"},{value:"custom",label:"\uD83D\uDD27 Custom",hint:"Choose skills"}]});if(W1(g))X0("Cancelled."),process.exit(0);let $;if(g==="custom"){let I=[...Q1.domain,...Q1.coordination,...Q1.utility],C=await D$({message:"Select skills:",options:I.map((n)=>({value:n.name,label:n.name,hint:n.desc})),required:!0});if(W1(C))X0("Cancelled."),process.exit(0);$=C}else $=x6[g]??[];let x=process.cwd(),N=Og();N.start("Installing skills...");try{await X6(x);for(let I of $)N.message(`Installing ${U.default.cyan(I)}...`),await I6(I,x);N.stop("Skills installed!"),s([...$.map((I)=>`${U.default.green("")} ${I}`),"",U.default.dim(`Location: ${y(x,".agent","skills")}`)].join(`
`),"Installed"),B1(U.default.green("Done! Open your project in your IDE to use the skills."))}catch(I){N.stop("Installation failed"),x1.error(I instanceof Error?I.message:String(I)),process.exit(1)}}
