#!/usr/bin/env node
import{createRequire as fi}from"node:module";var Ri=Object.create;var{getPrototypeOf:Oi,defineProperty:N1,getOwnPropertyNames:Yi}=Object;var Ai=Object.prototype.hasOwnProperty;var o=(n,g,l)=>{l=n!=null?Ri(Oi(n)):{};let i=g||!n||!n.__esModule?N1(l,"default",{value:n,enumerable:!0}):l;for(let $ of Yi(n))if(!Ai.call(i,$))N1(i,$,{get:()=>n[$],enumerable:!0});return i};var w=(n,g)=>()=>(g||n((g={exports:{}}).exports,g),g.exports);var F=fi(import.meta.url);var qn=w((Wm,tg)=>{var Jg=process||{},I1=Jg.argv||[],Gg=Jg.env||{},Hi=!(!!Gg.NO_COLOR||I1.includes("--no-color"))&&(!!Gg.FORCE_COLOR||I1.includes("--color")||Jg.platform==="win32"||(Jg.stdout||{}).isTTY&&Gg.TERM!=="dumb"||!!Gg.CI),Di=(n,g,l=n)=>(i)=>{let $=""+i,x=$.indexOf(g,n.length);return~x?n+Si($,g,l,x)+g:n+$+g},Si=(n,g,l,i)=>{let $="",x=0;do $+=n.substring(x,i)+l,x=i+g.length,i=n.indexOf(g,x);while(~i);return $+n.substring(x)},u1=(n=Hi)=>{let g=n?Di:()=>String;return{isColorSupported:n,reset:g("\x1B[0m","\x1B[0m"),bold:g("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"),dim:g("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"),italic:g("\x1B[3m","\x1B[23m"),underline:g("\x1B[4m","\x1B[24m"),inverse:g("\x1B[7m","\x1B[27m"),hidden:g("\x1B[8m","\x1B[28m"),strikethrough:g("\x1B[9m","\x1B[29m"),black:g("\x1B[30m","\x1B[39m"),red:g("\x1B[31m","\x1B[39m"),green:g("\x1B[32m","\x1B[39m"),yellow:g("\x1B[33m","\x1B[39m"),blue:g("\x1B[34m","\x1B[39m"),magenta:g("\x1B[35m","\x1B[39m"),cyan:g("\x1B[36m","\x1B[39m"),white:g("\x1B[37m","\x1B[39m"),gray:g("\x1B[90m","\x1B[39m"),bgBlack:g("\x1B[40m","\x1B[49m"),bgRed:g("\x1B[41m","\x1B[49m"),bgGreen:g("\x1B[42m","\x1B[49m"),bgYellow:g("\x1B[43m","\x1B[49m"),bgBlue:g("\x1B[44m","\x1B[49m"),bgMagenta:g("\x1B[45m","\x1B[49m"),bgCyan:g("\x1B[46m","\x1B[49m"),bgWhite:g("\x1B[47m","\x1B[49m"),blackBright:g("\x1B[90m","\x1B[39m"),redBright:g("\x1B[91m","\x1B[39m"),greenBright:g("\x1B[92m","\x1B[39m"),yellowBright:g("\x1B[93m","\x1B[39m"),blueBright:g("\x1B[94m","\x1B[39m"),magentaBright:g("\x1B[95m","\x1B[39m"),cyanBright:g("\x1B[96m","\x1B[39m"),whiteBright:g("\x1B[97m","\x1B[39m"),bgBlackBright:g("\x1B[100m","\x1B[49m"),bgRedBright:g("\x1B[101m","\x1B[49m"),bgGreenBright:g("\x1B[102m","\x1B[49m"),bgYellowBright:g("\x1B[103m","\x1B[49m"),bgBlueBright:g("\x1B[104m","\x1B[49m"),bgMagentaBright:g("\x1B[105m","\x1B[49m"),bgCyanBright:g("\x1B[106m","\x1B[49m"),bgWhiteBright:g("\x1B[107m","\x1B[49m")}};tg.exports=u1();tg.exports.createColors=u1});var nl=w((cm,G1)=>{var eg={to(n,g){if(!g)return`\x1B[${n+1}G`;return`\x1B[${g+1};${n+1}H`},move(n,g){let l="";if(n<0)l+=`\x1B[${-n}D`;else if(n>0)l+=`\x1B[${n}C`;if(g<0)l+=`\x1B[${-g}A`;else if(g>0)l+=`\x1B[${g}B`;return l},up:(n=1)=>`\x1B[${n}A`,down:(n=1)=>`\x1B[${n}B`,forward:(n=1)=>`\x1B[${n}C`,backward:(n=1)=>`\x1B[${n}D`,nextLine:(n=1)=>"\x1B[E".repeat(n),prevLine:(n=1)=>"\x1B[F".repeat(n),left:"\x1B[G",hide:"\x1B[?25l",show:"\x1B[?25h",save:"\x1B7",restore:"\x1B8"},Ui={up:(n=1)=>"\x1B[S".repeat(n),down:(n=1)=>"\x1B[T".repeat(n)},Vi={screen:"\x1B[2J",up:(n=1)=>"\x1B[1J".repeat(n),down:(n=1)=>"\x1B[J".repeat(n),line:"\x1B[2K",lineEnd:"\x1B[K",lineStart:"\x1B[1K",lines(n){let g="";for(let l=0;l<n;l++)g+=this.line+(l<n-1?eg.up():"");if(n)g+=eg.left;return g}};G1.exports={cursor:eg,scroll:Ui,erase:Vi,beep:"\x07"}});var Mn=w((K4,G0)=>{var I0=["nodebuffer","arraybuffer","fragments"],u0=typeof Blob<"u";if(u0)I0.push("blob");G0.exports={BINARY_TYPES:I0,CLOSE_TIMEOUT:30000,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:u0,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var rn=w((R4,Pg)=>{var{EMPTY_BUFFER:Xx}=Mn(),dl=Buffer[Symbol.species];function zx(n,g){if(n.length===0)return Xx;if(n.length===1)return n[0];let l=Buffer.allocUnsafe(g),i=0;for(let $=0;$<n.length;$++){let x=n[$];l.set(x,i),i+=x.length}if(i<g)return new dl(l.buffer,l.byteOffset,i);return l}function J0(n,g,l,i,$){for(let x=0;x<$;x++)l[i+x]=n[x]^g[x&3]}function M0(n,g){for(let l=0;l<n.length;l++)n[l]^=g[l&3]}function Kx(n){if(n.length===n.buffer.byteLength)return n.buffer;return n.buffer.slice(n.byteOffset,n.byteOffset+n.length)}function _l(n){if(_l.readOnly=!0,Buffer.isBuffer(n))return n;let g;if(n instanceof ArrayBuffer)g=new dl(n);else if(ArrayBuffer.isView(n))g=new dl(n.buffer,n.byteOffset,n.byteLength);else g=Buffer.from(n),_l.readOnly=!1;return g}Pg.exports={concat:zx,mask:J0,toArrayBuffer:Kx,toBuffer:_l,unmask:M0};if(!process.env.WS_NO_BUFFER_UTIL)try{let n=(()=>{throw new Error("Cannot require module "+"bufferutil");})();Pg.exports.mask=function(g,l,i,$,x){if(x<48)J0(g,l,i,$,x);else n.mask(g,l,i,$,x)},Pg.exports.unmask=function(g,l){if(g.length<32)M0(g,l);else n.unmask(g,l)}}catch(n){}});var X0=w((O4,Z0)=>{var j0=Symbol("kDone"),Pl=Symbol("kRun");class Q0{constructor(n){this[j0]=()=>{this.pending--,this[Pl]()},this.concurrency=n||1/0,this.jobs=[],this.pending=0}add(n){this.jobs.push(n),this[Pl]()}[Pl](){if(this.pending===this.concurrency)return;if(this.jobs.length){let n=this.jobs.shift();this.pending++,n(this[j0])}}}Z0.exports=Q0});var en=w((Y4,Y0)=>{var tn=F("zlib"),z0=rn(),Rx=X0(),{kStatusCode:K0}=Mn(),Ox=Buffer[Symbol.species],Yx=Buffer.from([0,0,255,255]),yg=Symbol("permessage-deflate"),jn=Symbol("total-length"),_n=Symbol("callback"),zn=Symbol("buffers"),Pn=Symbol("error"),Fg;class R0{constructor(n,g,l){if(this._maxPayload=l|0,this._options=n||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!g,this._deflate=null,this._inflate=null,this.params=null,!Fg){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Fg=new Rx(i)}}static get extensionName(){return"permessage-deflate"}offer(){let n={};if(this._options.serverNoContextTakeover)n.server_no_context_takeover=!0;if(this._options.clientNoContextTakeover)n.client_no_context_takeover=!0;if(this._options.serverMaxWindowBits)n.server_max_window_bits=this._options.serverMaxWindowBits;if(this._options.clientMaxWindowBits)n.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits==null)n.client_max_window_bits=!0;return n}accept(n){return n=this.normalizeParams(n),this.params=this._isServer?this.acceptAsServer(n):this.acceptAsClient(n),this.params}cleanup(){if(this._inflate)this._inflate.close(),this._inflate=null;if(this._deflate){let n=this._deflate[_n];if(this._deflate.close(),this._deflate=null,n)n(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(n){let g=this._options,l=n.find((i)=>{if(g.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(g.serverMaxWindowBits===!1||typeof g.serverMaxWindowBits==="number"&&g.serverMaxWindowBits>i.server_max_window_bits)||typeof g.clientMaxWindowBits==="number"&&!i.client_max_window_bits)return!1;return!0});if(!l)throw Error("None of the extension offers can be accepted");if(g.serverNoContextTakeover)l.server_no_context_takeover=!0;if(g.clientNoContextTakeover)l.client_no_context_takeover=!0;if(typeof g.serverMaxWindowBits==="number")l.server_max_window_bits=g.serverMaxWindowBits;if(typeof g.clientMaxWindowBits==="number")l.client_max_window_bits=g.clientMaxWindowBits;else if(l.client_max_window_bits===!0||g.clientMaxWindowBits===!1)delete l.client_max_window_bits;return l}acceptAsClient(n){let g=n[0];if(this._options.clientNoContextTakeover===!1&&g.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(!g.client_max_window_bits){if(typeof this._options.clientMaxWindowBits==="number")g.client_max_window_bits=this._options.clientMaxWindowBits}else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits==="number"&&g.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"');return g}normalizeParams(n){return n.forEach((g)=>{Object.keys(g).forEach((l)=>{let i=g[l];if(i.length>1)throw Error(`Parameter "${l}" must have only a single value`);if(i=i[0],l==="client_max_window_bits"){if(i!==!0){let $=+i;if(!Number.isInteger($)||$<8||$>15)throw TypeError(`Invalid value for parameter "${l}": ${i}`);i=$}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${l}": ${i}`)}else if(l==="server_max_window_bits"){let $=+i;if(!Number.isInteger($)||$<8||$>15)throw TypeError(`Invalid value for parameter "${l}": ${i}`);i=$}else if(l==="client_no_context_takeover"||l==="server_no_context_takeover"){if(i!==!0)throw TypeError(`Invalid value for parameter "${l}": ${i}`)}else throw Error(`Unknown parameter "${l}"`);g[l]=i})}),n}decompress(n,g,l){Fg.add((i)=>{this._decompress(n,g,($,x)=>{i(),l($,x)})})}compress(n,g,l){Fg.add((i)=>{this._compress(n,g,($,x)=>{i(),l($,x)})})}_decompress(n,g,l){let i=this._isServer?"client":"server";if(!this._inflate){let $=`${i}_max_window_bits`,x=typeof this.params[$]!=="number"?tn.Z_DEFAULT_WINDOWBITS:this.params[$];this._inflate=tn.createInflateRaw({...this._options.zlibInflateOptions,windowBits:x}),this._inflate[yg]=this,this._inflate[jn]=0,this._inflate[zn]=[],this._inflate.on("error",fx),this._inflate.on("data",O0)}if(this._inflate[_n]=l,this._inflate.write(n),g)this._inflate.write(Yx);this._inflate.flush(()=>{let $=this._inflate[Pn];if($){this._inflate.close(),this._inflate=null,l($);return}let x=z0.concat(this._inflate[zn],this._inflate[jn]);if(this._inflate._readableState.endEmitted)this._inflate.close(),this._inflate=null;else if(this._inflate[jn]=0,this._inflate[zn]=[],g&&this.params[`${i}_no_context_takeover`])this._inflate.reset();l(null,x)})}_compress(n,g,l){let i=this._isServer?"server":"client";if(!this._deflate){let $=`${i}_max_window_bits`,x=typeof this.params[$]!=="number"?tn.Z_DEFAULT_WINDOWBITS:this.params[$];this._deflate=tn.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:x}),this._deflate[jn]=0,this._deflate[zn]=[],this._deflate.on("data",Ax)}this._deflate[_n]=l,this._deflate.write(n),this._deflate.flush(tn.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let $=z0.concat(this._deflate[zn],this._deflate[jn]);if(g)$=new Ox($.buffer,$.byteOffset,$.length-4);if(this._deflate[_n]=null,this._deflate[jn]=0,this._deflate[zn]=[],g&&this.params[`${i}_no_context_takeover`])this._deflate.reset();l(null,$)})}}Y0.exports=R0;function Ax(n){this[zn].push(n),this[jn]+=n.length}function O0(n){if(this[jn]+=n.length,this[yg]._maxPayload<1||this[jn]<=this[yg]._maxPayload){this[zn].push(n);return}this[Pn]=RangeError("Max payload size exceeded"),this[Pn].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Pn][K0]=1009,this.removeListener("data",O0),this.reset()}function fx(n){if(this[yg]._inflate=null,this[Pn]){this[_n](this[Pn]);return}n[K0]=1007,this[_n](n)}});var Fn=w((A4,vg)=>{var{isUtf8:A0}=F("buffer"),{hasBlob:Hx}=Mn(),Dx=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Sx(n){return n>=1000&&n<=1014&&n!==1004&&n!==1005&&n!==1006||n>=3000&&n<=4999}function Fl(n){let g=n.length,l=0;while(l<g)if((n[l]&128)===0)l++;else if((n[l]&224)===192){if(l+1===g||(n[l+1]&192)!==128||(n[l]&254)===192)return!1;l+=2}else if((n[l]&240)===224){if(l+2>=g||(n[l+1]&192)!==128||(n[l+2]&192)!==128||n[l]===224&&(n[l+1]&224)===128||n[l]===237&&(n[l+1]&224)===160)return!1;l+=3}else if((n[l]&248)===240){if(l+3>=g||(n[l+1]&192)!==128||(n[l+2]&192)!==128||(n[l+3]&192)!==128||n[l]===240&&(n[l+1]&240)===128||n[l]===244&&n[l+1]>143||n[l]>244)return!1;l+=4}else return!1;return!0}function Ux(n){return Hx&&typeof n==="object"&&typeof n.arrayBuffer==="function"&&typeof n.type==="string"&&typeof n.stream==="function"&&(n[Symbol.toStringTag]==="Blob"||n[Symbol.toStringTag]==="File")}vg.exports={isBlob:Ux,isValidStatusCode:Sx,isValidUTF8:Fl,tokenChars:Dx};if(A0)vg.exports.isValidUTF8=function(n){return n.length<24?Fl(n):A0(n)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let n=(()=>{throw new Error("Cannot require module "+"utf-8-validate");})();vg.exports.isValidUTF8=function(g){return g.length<32?Fl(g):n(g)}}catch(n){}});var vl=w((f4,U0)=>{var{Writable:Vx}=F("stream"),f0=en(),{BINARY_TYPES:Tx,EMPTY_BUFFER:H0,kStatusCode:Bx,kWebSocket:qx}=Mn(),{concat:yl,toArrayBuffer:Lx,unmask:dx}=rn(),{isValidStatusCode:_x,isValidUTF8:D0}=Fn(),Wg=Buffer[Symbol.species];class S0 extends Vx{constructor(n={}){super();this._allowSynchronousEvents=n.allowSynchronousEvents!==void 0?n.allowSynchronousEvents:!0,this._binaryType=n.binaryType||Tx[0],this._extensions=n.extensions||{},this._isServer=!!n.isServer,this._maxPayload=n.maxPayload|0,this._skipUTF8Validation=!!n.skipUTF8Validation,this[qx]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(n,g,l){if(this._opcode===8&&this._state==0)return l();this._bufferedBytes+=n.length,this._buffers.push(n),this.startLoop(l)}consume(n){if(this._bufferedBytes-=n,n===this._buffers[0].length)return this._buffers.shift();if(n<this._buffers[0].length){let l=this._buffers[0];return this._buffers[0]=new Wg(l.buffer,l.byteOffset+n,l.length-n),new Wg(l.buffer,l.byteOffset,n)}let g=Buffer.allocUnsafe(n);do{let l=this._buffers[0],i=g.length-n;if(n>=l.length)g.set(this._buffers.shift(),i);else g.set(new Uint8Array(l.buffer,l.byteOffset,n),i),this._buffers[0]=new Wg(l.buffer,l.byteOffset+n,l.length-n);n-=l.length}while(n>0);return g}startLoop(n){this._loop=!0;do switch(this._state){case 0:this.getInfo(n);break;case 1:this.getPayloadLength16(n);break;case 2:this.getPayloadLength64(n);break;case 3:this.getMask();break;case 4:this.getData(n);break;case 5:case 6:this._loop=!1;return}while(this._loop);if(!this._errored)n()}getInfo(n){if(this._bufferedBytes<2){this._loop=!1;return}let g=this.consume(2);if((g[0]&48)!==0){let i=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");n(i);return}let l=(g[0]&64)===64;if(l&&!this._extensions[f0.extensionName]){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");n(i);return}if(this._fin=(g[0]&128)===128,this._opcode=g[0]&15,this._payloadLength=g[1]&127,this._opcode===0){if(l){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");n(i);return}if(!this._fragmented){let i=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");n(i);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");n(i);return}this._compressed=l}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let i=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");n(i);return}if(l){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");n(i);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let i=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");n(i);return}}else{let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");n(i);return}if(!this._fin&&!this._fragmented)this._fragmented=this._opcode;if(this._masked=(g[1]&128)===128,this._isServer){if(!this._masked){let i=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");n(i);return}}else if(this._masked){let i=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");n(i);return}if(this._payloadLength===126)this._state=1;else if(this._payloadLength===127)this._state=2;else this.haveLength(n)}getPayloadLength16(n){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(n)}getPayloadLength64(n){if(this._bufferedBytes<8){this._loop=!1;return}let g=this.consume(8),l=g.readUInt32BE(0);if(l>Math.pow(2,21)-1){let i=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");n(i);return}this._payloadLength=l*Math.pow(2,32)+g.readUInt32BE(4),this.haveLength(n)}haveLength(n){if(this._payloadLength&&this._opcode<8){if(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0){let g=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");n(g);return}}if(this._masked)this._state=3;else this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(n){let g=H0;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}if(g=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0)dx(g,this._mask)}if(this._opcode>7){this.controlMessage(g,n);return}if(this._compressed){this._state=5,this.decompress(g,n);return}if(g.length)this._messageLength=this._totalPayloadLength,this._fragments.push(g);this.dataMessage(n)}decompress(n,g){this._extensions[f0.extensionName].decompress(n,this._fin,(i,$)=>{if(i)return g(i);if($.length){if(this._messageLength+=$.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let x=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");g(x);return}this._fragments.push($)}if(this.dataMessage(g),this._state===0)this.startLoop(g)})}dataMessage(n){if(!this._fin){this._state=0;return}let g=this._messageLength,l=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let i;if(this._binaryType==="nodebuffer")i=yl(l,g);else if(this._binaryType==="arraybuffer")i=Lx(yl(l,g));else if(this._binaryType==="blob")i=new Blob(l);else i=l;if(this._allowSynchronousEvents)this.emit("message",i,!0),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",i,!0),this._state=0,this.startLoop(n)})}else{let i=yl(l,g);if(!this._skipUTF8Validation&&!D0(i)){let $=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");n($);return}if(this._state===5||this._allowSynchronousEvents)this.emit("message",i,!1),this._state=0;else this._state=6,setImmediate(()=>{this.emit("message",i,!1),this._state=0,this.startLoop(n)})}}controlMessage(n,g){if(this._opcode===8){if(n.length===0)this._loop=!1,this.emit("conclude",1005,H0),this.end();else{let l=n.readUInt16BE(0);if(!_x(l)){let $=this.createError(RangeError,`invalid status code ${l}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");g($);return}let i=new Wg(n.buffer,n.byteOffset+2,n.length-2);if(!this._skipUTF8Validation&&!D0(i)){let $=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");g($);return}this._loop=!1,this.emit("conclude",l,i),this.end()}this._state=0;return}if(this._allowSynchronousEvents)this.emit(this._opcode===9?"ping":"pong",n),this._state=0;else this._state=6,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",n),this._state=0,this.startLoop(g)})}createError(n,g,l,i,$){this._loop=!1,this._errored=!0;let x=new n(l?`Invalid WebSocket frame: ${g}`:g);return Error.captureStackTrace(x,this.createError),x.code=$,x[Bx]=i,x}}U0.exports=S0});var cl=w((D4,B0)=>{var{Duplex:H4}=F("stream"),{randomFillSync:Px}=F("crypto"),V0=en(),{EMPTY_BUFFER:Fx,kWebSocket:yx,NOOP:vx}=Mn(),{isBlob:yn,isValidStatusCode:Wx}=Fn(),{mask:T0,toBuffer:Sn}=rn(),t=Symbol("kByteLength"),cx=Buffer.alloc(4),Un,vn=8192,ln=0,Ex=1,wx=2;class Kn{constructor(n,g,l){if(this._extensions=g||{},l)this._generateMask=l,this._maskBuffer=Buffer.alloc(4);this._socket=n,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=ln,this.onerror=vx,this[yx]=void 0}static frame(n,g){let l,i=!1,$=2,x=!1;if(g.mask){if(l=g.maskBuffer||cx,g.generateMask)g.generateMask(l);else{if(vn===8192){if(Un===void 0)Un=Buffer.alloc(8192);Px(Un,0,8192),vn=0}l[0]=Un[vn++],l[1]=Un[vn++],l[2]=Un[vn++],l[3]=Un[vn++]}x=(l[0]|l[1]|l[2]|l[3])===0,$=6}let C;if(typeof n==="string")if((!g.mask||x)&&g[t]!==void 0)C=g[t];else n=Buffer.from(n),C=n.length;else C=n.length,i=g.mask&&g.readOnly&&!x;let m=C;if(C>=65536)$+=8,m=127;else if(C>125)$+=2,m=126;let N=Buffer.allocUnsafe(i?C+$:$);if(N[0]=g.fin?g.opcode|128:g.opcode,g.rsv1)N[0]|=64;if(N[1]=m,m===126)N.writeUInt16BE(C,2);else if(m===127)N[2]=N[3]=0,N.writeUIntBE(C,4,6);if(!g.mask)return[N,n];if(N[1]|=128,N[$-4]=l[0],N[$-3]=l[1],N[$-2]=l[2],N[$-1]=l[3],x)return[N,n];if(i)return T0(n,l,N,$,C),[N];return T0(n,l,n,0,C),[N,n]}close(n,g,l,i){let $;if(n===void 0)$=Fx;else if(typeof n!=="number"||!Wx(n))throw TypeError("First argument must be a valid error code number");else if(g===void 0||!g.length)$=Buffer.allocUnsafe(2),$.writeUInt16BE(n,0);else{let C=Buffer.byteLength(g);if(C>123)throw RangeError("The message must not be greater than 123 bytes");if($=Buffer.allocUnsafe(2+C),$.writeUInt16BE(n,0),typeof g==="string")$.write(g,2);else $.set(g,2)}let x={[t]:$.length,fin:!0,generateMask:this._generateMask,mask:l,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};if(this._state!==ln)this.enqueue([this.dispatch,$,!1,x,i]);else this.sendFrame(Kn.frame($,x),i)}ping(n,g,l){let i,$;if(typeof n==="string")i=Buffer.byteLength(n),$=!1;else if(yn(n))i=n.size,$=!1;else n=Sn(n),i=n.length,$=Sn.readOnly;if(i>125)throw RangeError("The data size must not be greater than 125 bytes");let x={[t]:i,fin:!0,generateMask:this._generateMask,mask:g,maskBuffer:this._maskBuffer,opcode:9,readOnly:$,rsv1:!1};if(yn(n))if(this._state!==ln)this.enqueue([this.getBlobData,n,!1,x,l]);else this.getBlobData(n,!1,x,l);else if(this._state!==ln)this.enqueue([this.dispatch,n,!1,x,l]);else this.sendFrame(Kn.frame(n,x),l)}pong(n,g,l){let i,$;if(typeof n==="string")i=Buffer.byteLength(n),$=!1;else if(yn(n))i=n.size,$=!1;else n=Sn(n),i=n.length,$=Sn.readOnly;if(i>125)throw RangeError("The data size must not be greater than 125 bytes");let x={[t]:i,fin:!0,generateMask:this._generateMask,mask:g,maskBuffer:this._maskBuffer,opcode:10,readOnly:$,rsv1:!1};if(yn(n))if(this._state!==ln)this.enqueue([this.getBlobData,n,!1,x,l]);else this.getBlobData(n,!1,x,l);else if(this._state!==ln)this.enqueue([this.dispatch,n,!1,x,l]);else this.sendFrame(Kn.frame(n,x),l)}send(n,g,l){let i=this._extensions[V0.extensionName],$=g.binary?2:1,x=g.compress,C,m;if(typeof n==="string")C=Buffer.byteLength(n),m=!1;else if(yn(n))C=n.size,m=!1;else n=Sn(n),C=n.length,m=Sn.readOnly;if(this._firstFragment){if(this._firstFragment=!1,x&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"])x=C>=i._threshold;this._compress=x}else x=!1,$=0;if(g.fin)this._firstFragment=!0;let N={[t]:C,fin:g.fin,generateMask:this._generateMask,mask:g.mask,maskBuffer:this._maskBuffer,opcode:$,readOnly:m,rsv1:x};if(yn(n))if(this._state!==ln)this.enqueue([this.getBlobData,n,this._compress,N,l]);else this.getBlobData(n,this._compress,N,l);else if(this._state!==ln)this.enqueue([this.dispatch,n,this._compress,N,l]);else this.dispatch(n,this._compress,N,l)}getBlobData(n,g,l,i){this._bufferedBytes+=l[t],this._state=wx,n.arrayBuffer().then(($)=>{if(this._socket.destroyed){let C=Error("The socket was closed while the blob was being read");process.nextTick(Wl,this,C,i);return}this._bufferedBytes-=l[t];let x=Sn($);if(!g)this._state=ln,this.sendFrame(Kn.frame(x,l),i),this.dequeue();else this.dispatch(x,g,l,i)}).catch(($)=>{process.nextTick(bx,this,$,i)})}dispatch(n,g,l,i){if(!g){this.sendFrame(Kn.frame(n,l),i);return}let $=this._extensions[V0.extensionName];this._bufferedBytes+=l[t],this._state=Ex,$.compress(n,l.fin,(x,C)=>{if(this._socket.destroyed){let m=Error("The socket was closed while data was being compressed");Wl(this,m,i);return}this._bufferedBytes-=l[t],this._state=ln,l.readOnly=!1,this.sendFrame(Kn.frame(C,l),i),this.dequeue()})}dequeue(){while(this._state===ln&&this._queue.length){let n=this._queue.shift();this._bufferedBytes-=n[3][t],Reflect.apply(n[0],this,n.slice(1))}}enqueue(n){this._bufferedBytes+=n[3][t],this._queue.push(n)}sendFrame(n,g){if(n.length===2)this._socket.cork(),this._socket.write(n[0]),this._socket.write(n[1],g),this._socket.uncork();else this._socket.write(n[0],g)}}B0.exports=Kn;function Wl(n,g,l){if(typeof l==="function")l(g);for(let i=0;i<n._queue.length;i++){let $=n._queue[i],x=$[$.length-1];if(typeof x==="function")x(g)}}function bx(n,g,l){Wl(n,g,l),n.onerror(g)}});var W0=w((S4,v0)=>{var{kForOnEventAttribute:ng,kListener:El}=Mn(),q0=Symbol("kCode"),L0=Symbol("kData"),d0=Symbol("kError"),_0=Symbol("kMessage"),P0=Symbol("kReason"),Wn=Symbol("kTarget"),F0=Symbol("kType"),y0=Symbol("kWasClean");class Rn{constructor(n){this[Wn]=null,this[F0]=n}get target(){return this[Wn]}get type(){return this[F0]}}Object.defineProperty(Rn.prototype,"target",{enumerable:!0});Object.defineProperty(Rn.prototype,"type",{enumerable:!0});class cn extends Rn{constructor(n,g={}){super(n);this[q0]=g.code===void 0?0:g.code,this[P0]=g.reason===void 0?"":g.reason,this[y0]=g.wasClean===void 0?!1:g.wasClean}get code(){return this[q0]}get reason(){return this[P0]}get wasClean(){return this[y0]}}Object.defineProperty(cn.prototype,"code",{enumerable:!0});Object.defineProperty(cn.prototype,"reason",{enumerable:!0});Object.defineProperty(cn.prototype,"wasClean",{enumerable:!0});class gg extends Rn{constructor(n,g={}){super(n);this[d0]=g.error===void 0?null:g.error,this[_0]=g.message===void 0?"":g.message}get error(){return this[d0]}get message(){return this[_0]}}Object.defineProperty(gg.prototype,"error",{enumerable:!0});Object.defineProperty(gg.prototype,"message",{enumerable:!0});class Eg extends Rn{constructor(n,g={}){super(n);this[L0]=g.data===void 0?null:g.data}get data(){return this[L0]}}Object.defineProperty(Eg.prototype,"data",{enumerable:!0});var hx={addEventListener(n,g,l={}){for(let $ of this.listeners(n))if(!l[ng]&&$[El]===g&&!$[ng])return;let i;if(n==="message")i=function(x,C){let m=new Eg("message",{data:C?x:x.toString()});m[Wn]=this,cg(g,this,m)};else if(n==="close")i=function(x,C){let m=new cn("close",{code:x,reason:C.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});m[Wn]=this,cg(g,this,m)};else if(n==="error")i=function(x){let C=new gg("error",{error:x,message:x.message});C[Wn]=this,cg(g,this,C)};else if(n==="open")i=function(){let x=new Rn("open");x[Wn]=this,cg(g,this,x)};else return;if(i[ng]=!!l[ng],i[El]=g,l.once)this.once(n,i);else this.on(n,i)},removeEventListener(n,g){for(let l of this.listeners(n))if(l[El]===g&&!l[ng]){this.removeListener(n,l);break}}};v0.exports={CloseEvent:cn,ErrorEvent:gg,Event:Rn,EventTarget:hx,MessageEvent:Eg};function cg(n,g,l){if(typeof n==="object"&&n.handleEvent)n.handleEvent.call(n,l);else n.call(g,l)}});var wl=w((U4,c0)=>{var{tokenChars:lg}=Fn();function In(n,g,l){if(n[g]===void 0)n[g]=[l];else n[g].push(l)}function sx(n){let g=Object.create(null),l=Object.create(null),i=!1,$=!1,x=!1,C,m,N=-1,I=-1,M=-1,u=0;for(;u<n.length;u++)if(I=n.charCodeAt(u),C===void 0)if(M===-1&&lg[I]===1){if(N===-1)N=u}else if(u!==0&&(I===32||I===9)){if(M===-1&&N!==-1)M=u}else if(I===59||I===44){if(N===-1)throw SyntaxError(`Unexpected character at index ${u}`);if(M===-1)M=u;let X=n.slice(N,M);if(I===44)In(g,X,l),l=Object.create(null);else C=X;N=M=-1}else throw SyntaxError(`Unexpected character at index ${u}`);else if(m===void 0)if(M===-1&&lg[I]===1){if(N===-1)N=u}else if(I===32||I===9){if(M===-1&&N!==-1)M=u}else if(I===59||I===44){if(N===-1)throw SyntaxError(`Unexpected character at index ${u}`);if(M===-1)M=u;if(In(l,n.slice(N,M),!0),I===44)In(g,C,l),l=Object.create(null),C=void 0;N=M=-1}else if(I===61&&N!==-1&&M===-1)m=n.slice(N,u),N=M=-1;else throw SyntaxError(`Unexpected character at index ${u}`);else if($){if(lg[I]!==1)throw SyntaxError(`Unexpected character at index ${u}`);if(N===-1)N=u;else if(!i)i=!0;$=!1}else if(x)if(lg[I]===1){if(N===-1)N=u}else if(I===34&&N!==-1)x=!1,M=u;else if(I===92)$=!0;else throw SyntaxError(`Unexpected character at index ${u}`);else if(I===34&&n.charCodeAt(u-1)===61)x=!0;else if(M===-1&&lg[I]===1){if(N===-1)N=u}else if(N!==-1&&(I===32||I===9)){if(M===-1)M=u}else if(I===59||I===44){if(N===-1)throw SyntaxError(`Unexpected character at index ${u}`);if(M===-1)M=u;let X=n.slice(N,M);if(i)X=X.replace(/\\/g,""),i=!1;if(In(l,m,X),I===44)In(g,C,l),l=Object.create(null),C=void 0;m=void 0,N=M=-1}else throw SyntaxError(`Unexpected character at index ${u}`);if(N===-1||x||I===32||I===9)throw SyntaxError("Unexpected end of input");if(M===-1)M=u;let Q=n.slice(N,M);if(C===void 0)In(g,Q,l);else{if(m===void 0)In(l,Q,!0);else if(i)In(l,m,Q.replace(/\\/g,""));else In(l,m,Q);In(g,C,l)}return g}function kx(n){return Object.keys(n).map((g)=>{let l=n[g];if(!Array.isArray(l))l=[l];return l.map((i)=>{return[g].concat(Object.keys(i).map(($)=>{let x=i[$];if(!Array.isArray(x))x=[x];return x.map((C)=>C===!0?$:`${$}=${C}`).join("; ")})).join("; ")}).join(", ")}).join(", ")}c0.exports={format:kx,parse:sx}});var sg=w((B4,e0)=>{var px=F("events"),ox=F("https"),ax=F("http"),b0=F("net"),rx=F("tls"),{randomBytes:tx,createHash:ex}=F("crypto"),{Duplex:V4,Readable:T4}=F("stream"),{URL:bl}=F("url"),On=en(),n2=vl(),g2=cl(),{isBlob:l2}=Fn(),{BINARY_TYPES:E0,CLOSE_TIMEOUT:i2,EMPTY_BUFFER:wg,GUID:$2,kForOnEventAttribute:hl,kListener:x2,kStatusCode:m2,kWebSocket:v,NOOP:h0}=Mn(),{EventTarget:{addEventListener:C2,removeEventListener:N2}}=W0(),{format:I2,parse:u2}=wl(),{toBuffer:G2}=rn(),s0=Symbol("kAborted"),sl=[8,13],Qn=["CONNECTING","OPEN","CLOSING","CLOSED"],J2=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class D extends px{constructor(n,g,l){super();if(this._binaryType=E0[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=wg,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=D.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,n!==null){if(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,g===void 0)g=[];else if(!Array.isArray(g))if(typeof g==="object"&&g!==null)l=g,g=[];else g=[g];k0(this,n,g,l)}else this._autoPong=l.autoPong,this._closeTimeout=l.closeTimeout,this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(n){if(!E0.includes(n))return;if(this._binaryType=n,this._receiver)this._receiver._binaryType=n}get bufferedAmount(){if(!this._socket)return this._bufferedAmount;return this._socket._writableState.length+this._sender._bufferedBytes}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(n,g,l){let i=new n2({allowSynchronousEvents:l.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:l.maxPayload,skipUTF8Validation:l.skipUTF8Validation}),$=new g2(n,this._extensions,l.generateMask);if(this._receiver=i,this._sender=$,this._socket=n,i[v]=this,$[v]=this,n[v]=this,i.on("conclude",Q2),i.on("drain",Z2),i.on("error",X2),i.on("message",z2),i.on("ping",K2),i.on("pong",R2),$.onerror=O2,n.setTimeout)n.setTimeout(0);if(n.setNoDelay)n.setNoDelay();if(g.length>0)n.unshift(g);n.on("close",a0),n.on("data",hg),n.on("end",r0),n.on("error",t0),this._readyState=D.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=D.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}if(this._extensions[On.extensionName])this._extensions[On.extensionName].cleanup();this._receiver.removeAllListeners(),this._readyState=D.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(n,g){if(this.readyState===D.CLOSED)return;if(this.readyState===D.CONNECTING){k(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===D.CLOSING){if(this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted))this._socket.end();return}this._readyState=D.CLOSING,this._sender.close(n,g,!this._isServer,(l)=>{if(l)return;if(this._closeFrameSent=!0,this._closeFrameReceived||this._receiver._writableState.errorEmitted)this._socket.end()}),o0(this)}pause(){if(this.readyState===D.CONNECTING||this.readyState===D.CLOSED)return;this._paused=!0,this._socket.pause()}ping(n,g,l){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof n==="function")l=n,n=g=void 0;else if(typeof g==="function")l=g,g=void 0;if(typeof n==="number")n=n.toString();if(this.readyState!==D.OPEN){kl(this,n,l);return}if(g===void 0)g=!this._isServer;this._sender.ping(n||wg,g,l)}pong(n,g,l){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof n==="function")l=n,n=g=void 0;else if(typeof g==="function")l=g,g=void 0;if(typeof n==="number")n=n.toString();if(this.readyState!==D.OPEN){kl(this,n,l);return}if(g===void 0)g=!this._isServer;this._sender.pong(n||wg,g,l)}resume(){if(this.readyState===D.CONNECTING||this.readyState===D.CLOSED)return;if(this._paused=!1,!this._receiver._writableState.needDrain)this._socket.resume()}send(n,g,l){if(this.readyState===D.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof g==="function")l=g,g={};if(typeof n==="number")n=n.toString();if(this.readyState!==D.OPEN){kl(this,n,l);return}let i={binary:typeof n!=="string",mask:!this._isServer,compress:!0,fin:!0,...g};if(!this._extensions[On.extensionName])i.compress=!1;this._sender.send(n||wg,i,l)}terminate(){if(this.readyState===D.CLOSED)return;if(this.readyState===D.CONNECTING){k(this,this._req,"WebSocket was closed before the connection was established");return}if(this._socket)this._readyState=D.CLOSING,this._socket.destroy()}}Object.defineProperty(D,"CONNECTING",{enumerable:!0,value:Qn.indexOf("CONNECTING")});Object.defineProperty(D.prototype,"CONNECTING",{enumerable:!0,value:Qn.indexOf("CONNECTING")});Object.defineProperty(D,"OPEN",{enumerable:!0,value:Qn.indexOf("OPEN")});Object.defineProperty(D.prototype,"OPEN",{enumerable:!0,value:Qn.indexOf("OPEN")});Object.defineProperty(D,"CLOSING",{enumerable:!0,value:Qn.indexOf("CLOSING")});Object.defineProperty(D.prototype,"CLOSING",{enumerable:!0,value:Qn.indexOf("CLOSING")});Object.defineProperty(D,"CLOSED",{enumerable:!0,value:Qn.indexOf("CLOSED")});Object.defineProperty(D.prototype,"CLOSED",{enumerable:!0,value:Qn.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((n)=>{Object.defineProperty(D.prototype,n,{enumerable:!0})});["open","error","close","message"].forEach((n)=>{Object.defineProperty(D.prototype,`on${n}`,{enumerable:!0,get(){for(let g of this.listeners(n))if(g[hl])return g[x2];return null},set(g){for(let l of this.listeners(n))if(l[hl]){this.removeListener(n,l);break}if(typeof g!=="function")return;this.addEventListener(n,g,{[hl]:!0})}})});D.prototype.addEventListener=C2;D.prototype.removeEventListener=N2;e0.exports=D;function k0(n,g,l,i){let $={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:i2,protocolVersion:sl[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...i,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(n._autoPong=$.autoPong,n._closeTimeout=$.closeTimeout,!sl.includes($.protocolVersion))throw RangeError(`Unsupported protocol version: ${$.protocolVersion} (supported versions: ${sl.join(", ")})`);let x;if(g instanceof bl)x=g;else try{x=new bl(g)}catch(J){throw SyntaxError(`Invalid URL: ${g}`)}if(x.protocol==="http:")x.protocol="ws:";else if(x.protocol==="https:")x.protocol="wss:";n._url=x.href;let C=x.protocol==="wss:",m=x.protocol==="ws+unix:",N;if(x.protocol!=="ws:"&&!C&&!m)N=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`;else if(m&&!x.pathname)N="The URL's pathname is empty";else if(x.hash)N="The URL contains a fragment identifier";if(N){let J=SyntaxError(N);if(n._redirects===0)throw J;else{bg(n,J);return}}let I=C?443:80,M=tx(16).toString("base64"),u=C?ox.request:ax.request,Q=new Set,X;if($.createConnection=$.createConnection||(C?j2:M2),$.defaultPort=$.defaultPort||I,$.port=x.port||I,$.host=x.hostname.startsWith("[")?x.hostname.slice(1,-1):x.hostname,$.headers={...$.headers,"Sec-WebSocket-Version":$.protocolVersion,"Sec-WebSocket-Key":M,Connection:"Upgrade",Upgrade:"websocket"},$.path=x.pathname+x.search,$.timeout=$.handshakeTimeout,$.perMessageDeflate)X=new On($.perMessageDeflate!==!0?$.perMessageDeflate:{},!1,$.maxPayload),$.headers["Sec-WebSocket-Extensions"]=I2({[On.extensionName]:X.offer()});if(l.length){for(let J of l){if(typeof J!=="string"||!J2.test(J)||Q.has(J))throw SyntaxError("An invalid or duplicated subprotocol was specified");Q.add(J)}$.headers["Sec-WebSocket-Protocol"]=l.join(",")}if($.origin)if($.protocolVersion<13)$.headers["Sec-WebSocket-Origin"]=$.origin;else $.headers.Origin=$.origin;if(x.username||x.password)$.auth=`${x.username}:${x.password}`;if(m){let J=$.path.split(":");$.socketPath=J[0],$.path=J[1]}let G;if($.followRedirects){if(n._redirects===0){n._originalIpc=m,n._originalSecure=C,n._originalHostOrSocketPath=m?$.socketPath:x.host;let J=i&&i.headers;if(i={...i,headers:{}},J)for(let[K,z]of Object.entries(J))i.headers[K.toLowerCase()]=z}else if(n.listenerCount("redirect")===0){let J=m?n._originalIpc?$.socketPath===n._originalHostOrSocketPath:!1:n._originalIpc?!1:x.host===n._originalHostOrSocketPath;if(!J||n._originalSecure&&!C){if(delete $.headers.authorization,delete $.headers.cookie,!J)delete $.headers.host;$.auth=void 0}}if($.auth&&!i.headers.authorization)i.headers.authorization="Basic "+Buffer.from($.auth).toString("base64");if(G=n._req=u($),n._redirects)n.emit("redirect",n.url,G)}else G=n._req=u($);if($.timeout)G.on("timeout",()=>{k(n,G,"Opening handshake has timed out")});if(G.on("error",(J)=>{if(G===null||G[s0])return;G=n._req=null,bg(n,J)}),G.on("response",(J)=>{let K=J.headers.location,z=J.statusCode;if(K&&$.followRedirects&&z>=300&&z<400){if(++n._redirects>$.maxRedirects){k(n,G,"Maximum redirects exceeded");return}G.abort();let O;try{O=new bl(K,g)}catch(A){let H=SyntaxError(`Invalid URL: ${K}`);bg(n,H);return}k0(n,O,l,i)}else if(!n.emit("unexpected-response",G,J))k(n,G,`Unexpected server response: ${J.statusCode}`)}),G.on("upgrade",(J,K,z)=>{if(n.emit("upgrade",J),n.readyState!==D.CONNECTING)return;G=n._req=null;let O=J.headers.upgrade;if(O===void 0||O.toLowerCase()!=="websocket"){k(n,K,"Invalid Upgrade header");return}let A=ex("sha1").update(M+$2).digest("base64");if(J.headers["sec-websocket-accept"]!==A){k(n,K,"Invalid Sec-WebSocket-Accept header");return}let H=J.headers["sec-websocket-protocol"],f;if(H!==void 0){if(!Q.size)f="Server sent a subprotocol but none was requested";else if(!Q.has(H))f="Server sent an invalid subprotocol"}else if(Q.size)f="Server sent no subprotocol";if(f){k(n,K,f);return}if(H)n._protocol=H;let U=J.headers["sec-websocket-extensions"];if(U!==void 0){if(!X){k(n,K,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let R;try{R=u2(U)}catch(d){k(n,K,"Invalid Sec-WebSocket-Extensions header");return}let Y=Object.keys(R);if(Y.length!==1||Y[0]!==On.extensionName){k(n,K,"Server indicated an extension that was not requested");return}try{X.accept(R[On.extensionName])}catch(d){k(n,K,"Invalid Sec-WebSocket-Extensions header");return}n._extensions[On.extensionName]=X}n.setSocket(K,z,{allowSynchronousEvents:$.allowSynchronousEvents,generateMask:$.generateMask,maxPayload:$.maxPayload,skipUTF8Validation:$.skipUTF8Validation})}),$.finishRequest)$.finishRequest(G,n);else G.end()}function bg(n,g){n._readyState=D.CLOSING,n._errorEmitted=!0,n.emit("error",g),n.emitClose()}function M2(n){return n.path=n.socketPath,b0.connect(n)}function j2(n){if(n.path=void 0,!n.servername&&n.servername!=="")n.servername=b0.isIP(n.host)?"":n.host;return rx.connect(n)}function k(n,g,l){n._readyState=D.CLOSING;let i=Error(l);if(Error.captureStackTrace(i,k),g.setHeader){if(g[s0]=!0,g.abort(),g.socket&&!g.socket.destroyed)g.socket.destroy();process.nextTick(bg,n,i)}else g.destroy(i),g.once("error",n.emit.bind(n,"error")),g.once("close",n.emitClose.bind(n))}function kl(n,g,l){if(g){let i=l2(g)?g.size:G2(g).length;if(n._socket)n._sender._bufferedBytes+=i;else n._bufferedAmount+=i}if(l){let i=Error(`WebSocket is not open: readyState ${n.readyState} (${Qn[n.readyState]})`);process.nextTick(l,i)}}function Q2(n,g){let l=this[v];if(l._closeFrameReceived=!0,l._closeMessage=g,l._closeCode=n,l._socket[v]===void 0)return;if(l._socket.removeListener("data",hg),process.nextTick(p0,l._socket),n===1005)l.close();else l.close(n,g)}function Z2(){let n=this[v];if(!n.isPaused)n._socket.resume()}function X2(n){let g=this[v];if(g._socket[v]!==void 0)g._socket.removeListener("data",hg),process.nextTick(p0,g._socket),g.close(n[m2]);if(!g._errorEmitted)g._errorEmitted=!0,g.emit("error",n)}function w0(){this[v].emitClose()}function z2(n,g){this[v].emit("message",n,g)}function K2(n){let g=this[v];if(g._autoPong)g.pong(n,!this._isServer,h0);g.emit("ping",n)}function R2(n){this[v].emit("pong",n)}function p0(n){n.resume()}function O2(n){let g=this[v];if(g.readyState===D.CLOSED)return;if(g.readyState===D.OPEN)g._readyState=D.CLOSING,o0(g);if(this._socket.end(),!g._errorEmitted)g._errorEmitted=!0,g.emit("error",n)}function o0(n){n._closeTimer=setTimeout(n._socket.destroy.bind(n._socket),n._closeTimeout)}function a0(){let n=this[v];if(this.removeListener("close",a0),this.removeListener("data",hg),this.removeListener("end",r0),n._readyState=D.CLOSING,!this._readableState.endEmitted&&!n._closeFrameReceived&&!n._receiver._writableState.errorEmitted&&this._readableState.length!==0){let g=this.read(this._readableState.length);n._receiver.write(g)}if(n._receiver.end(),this[v]=void 0,clearTimeout(n._closeTimer),n._receiver._writableState.finished||n._receiver._writableState.errorEmitted)n.emitClose();else n._receiver.on("error",w0),n._receiver.on("finish",w0)}function hg(n){if(!this[v]._receiver.write(n))this.pause()}function r0(){let n=this[v];n._readyState=D.CLOSING,n._receiver.end(),this.end()}function t0(){let n=this[v];if(this.removeListener("error",t0),this.on("error",h0),n)n._readyState=D.CLOSING,this.destroy()}});var ii=w((L4,li)=>{var q4=sg(),{Duplex:Y2}=F("stream");function ni(n){n.emit("close")}function A2(){if(!this.destroyed&&this._writableState.finished)this.destroy()}function gi(n){if(this.removeListener("error",gi),this.destroy(),this.listenerCount("error")===0)this.emit("error",n)}function f2(n,g){let l=!0,i=new Y2({...g,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return n.on("message",function(x,C){let m=!C&&i._readableState.objectMode?x.toString():x;if(!i.push(m))n.pause()}),n.once("error",function(x){if(i.destroyed)return;l=!1,i.destroy(x)}),n.once("close",function(){if(i.destroyed)return;i.push(null)}),i._destroy=function($,x){if(n.readyState===n.CLOSED){x($),process.nextTick(ni,i);return}let C=!1;if(n.once("error",function(N){C=!0,x(N)}),n.once("close",function(){if(!C)x($);process.nextTick(ni,i)}),l)n.terminate()},i._final=function($){if(n.readyState===n.CONNECTING){n.once("open",function(){i._final($)});return}if(n._socket===null)return;if(n._socket._writableState.finished){if($(),i._readableState.endEmitted)i.destroy()}else n._socket.once("finish",function(){$()}),n.close()},i._read=function(){if(n.isPaused)n.resume()},i._write=function($,x,C){if(n.readyState===n.CONNECTING){n.once("open",function(){i._write($,x,C)});return}n.send($,C)},i.on("end",A2),i.on("error",gi),i}li.exports=f2});var xi=w((d4,$i)=>{var{tokenChars:H2}=Fn();function D2(n){let g=new Set,l=-1,i=-1,$=0;for($;$<n.length;$++){let C=n.charCodeAt($);if(i===-1&&H2[C]===1){if(l===-1)l=$}else if($!==0&&(C===32||C===9)){if(i===-1&&l!==-1)i=$}else if(C===44){if(l===-1)throw SyntaxError(`Unexpected character at index ${$}`);if(i===-1)i=$;let m=n.slice(l,i);if(g.has(m))throw SyntaxError(`The "${m}" subprotocol is duplicated`);g.add(m),l=i=-1}else throw SyntaxError(`Unexpected character at index ${$}`)}if(l===-1||i!==-1)throw SyntaxError("Unexpected end of input");let x=n.slice(l,$);if(g.has(x))throw SyntaxError(`The "${x}" subprotocol is duplicated`);return g.add(x),g}$i.exports={parse:D2}});var ui=w((P4,Ii)=>{var S2=F("events"),kg=F("http"),{Duplex:_4}=F("stream"),{createHash:U2}=F("crypto"),mi=wl(),Vn=en(),V2=xi(),T2=sg(),{CLOSE_TIMEOUT:B2,GUID:q2,kWebSocket:L2}=Mn(),d2=/^[+/0-9A-Za-z]{22}==$/;class Ni extends S2{constructor(n,g){super();if(n={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:B2,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:T2,...n},n.port==null&&!n.server&&!n.noServer||n.port!=null&&(n.server||n.noServer)||n.server&&n.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(n.port!=null)this._server=kg.createServer((l,i)=>{let $=kg.STATUS_CODES[426];i.writeHead(426,{"Content-Length":$.length,"Content-Type":"text/plain"}),i.end($)}),this._server.listen(n.port,n.host,n.backlog,g);else if(n.server)this._server=n.server;if(this._server){let l=this.emit.bind(this,"connection");this._removeListeners=_2(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(i,$,x)=>{this.handleUpgrade(i,$,x,l)}})}if(n.perMessageDeflate===!0)n.perMessageDeflate={};if(n.clientTracking)this.clients=new Set,this._shouldEmitClose=!1;this.options=n,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');if(!this._server)return null;return this._server.address()}close(n){if(this._state===2){if(n)this.once("close",()=>{n(Error("The server is not running"))});process.nextTick(ig,this);return}if(n)this.once("close",n);if(this._state===1)return;if(this._state=1,this.options.noServer||this.options.server){if(this._server)this._removeListeners(),this._removeListeners=this._server=null;if(this.clients)if(!this.clients.size)process.nextTick(ig,this);else this._shouldEmitClose=!0;else process.nextTick(ig,this)}else{let g=this._server;this._removeListeners(),this._removeListeners=this._server=null,g.close(()=>{ig(this)})}}shouldHandle(n){if(this.options.path){let g=n.url.indexOf("?");if((g!==-1?n.url.slice(0,g):n.url)!==this.options.path)return!1}return!0}handleUpgrade(n,g,l,i){g.on("error",Ci);let $=n.headers["sec-websocket-key"],x=n.headers.upgrade,C=+n.headers["sec-websocket-version"];if(n.method!=="GET"){Tn(this,n,g,405,"Invalid HTTP method");return}if(x===void 0||x.toLowerCase()!=="websocket"){Tn(this,n,g,400,"Invalid Upgrade header");return}if($===void 0||!d2.test($)){Tn(this,n,g,400,"Missing or invalid Sec-WebSocket-Key header");return}if(C!==13&&C!==8){Tn(this,n,g,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(n)){$g(g,400);return}let m=n.headers["sec-websocket-protocol"],N=new Set;if(m!==void 0)try{N=V2.parse(m)}catch(u){Tn(this,n,g,400,"Invalid Sec-WebSocket-Protocol header");return}let I=n.headers["sec-websocket-extensions"],M={};if(this.options.perMessageDeflate&&I!==void 0){let u=new Vn(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let Q=mi.parse(I);if(Q[Vn.extensionName])u.accept(Q[Vn.extensionName]),M[Vn.extensionName]=u}catch(Q){Tn(this,n,g,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let u={origin:n.headers[`${C===8?"sec-websocket-origin":"origin"}`],secure:!!(n.socket.authorized||n.socket.encrypted),req:n};if(this.options.verifyClient.length===2){this.options.verifyClient(u,(Q,X,G,J)=>{if(!Q)return $g(g,X||401,G,J);this.completeUpgrade(M,$,N,n,g,l,i)});return}if(!this.options.verifyClient(u))return $g(g,401)}this.completeUpgrade(M,$,N,n,g,l,i)}completeUpgrade(n,g,l,i,$,x,C){if(!$.readable||!$.writable)return $.destroy();if($[L2])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return $g($,503);let N=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${U2("sha1").update(g+q2).digest("base64")}`],I=new this.options.WebSocket(null,void 0,this.options);if(l.size){let M=this.options.handleProtocols?this.options.handleProtocols(l,i):l.values().next().value;if(M)N.push(`Sec-WebSocket-Protocol: ${M}`),I._protocol=M}if(n[Vn.extensionName]){let M=n[Vn.extensionName].params,u=mi.format({[Vn.extensionName]:[M]});N.push(`Sec-WebSocket-Extensions: ${u}`),I._extensions=n}if(this.emit("headers",N,i),$.write(N.concat(`\r
`).join(`\r
`)),$.removeListener("error",Ci),I.setSocket($,x,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients)this.clients.add(I),I.on("close",()=>{if(this.clients.delete(I),this._shouldEmitClose&&!this.clients.size)process.nextTick(ig,this)});C(I,i)}}Ii.exports=Ni;function _2(n,g){for(let l of Object.keys(g))n.on(l,g[l]);return function(){for(let i of Object.keys(g))n.removeListener(i,g[i])}}function ig(n){n._state=2,n.emit("close")}function Ci(){this.destroy()}function $g(n,g,l,i){l=l||kg.STATUS_CODES[g],i={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(l),...i},n.once("finish",n.destroy),n.end(`HTTP/1.1 ${g} ${kg.STATUS_CODES[g]}\r
`+Object.keys(i).map(($)=>`${$}: ${i[$]}`).join(`\r
`)+`\r
\r
`+l)}function Tn(n,g,l,i,$,x){if(n.listenerCount("wsClientError")){let C=Error($);Error.captureStackTrace(C,Tn),n.emit("wsClientError",C,l,g)}else $g(l,i,$,x)}});var wn=o(qn(),1),W=o(nl(),1);import{stdout as ml,stdin as Z1}from"node:process";import*as Zn from"node:readline";import Ti from"node:readline";import{ReadStream as J1}from"node:tty";var Bi=(n)=>n===161||n===164||n===167||n===168||n===170||n===173||n===174||n>=176&&n<=180||n>=182&&n<=186||n>=188&&n<=191||n===198||n===208||n===215||n===216||n>=222&&n<=225||n===230||n>=232&&n<=234||n===236||n===237||n===240||n===242||n===243||n>=247&&n<=250||n===252||n===254||n===257||n===273||n===275||n===283||n===294||n===295||n===299||n>=305&&n<=307||n===312||n>=319&&n<=322||n===324||n>=328&&n<=331||n===333||n===338||n===339||n===358||n===359||n===363||n===462||n===464||n===466||n===468||n===470||n===472||n===474||n===476||n===593||n===609||n===708||n===711||n>=713&&n<=715||n===717||n===720||n>=728&&n<=731||n===733||n===735||n>=768&&n<=879||n>=913&&n<=929||n>=931&&n<=937||n>=945&&n<=961||n>=963&&n<=969||n===1025||n>=1040&&n<=1103||n===1105||n===8208||n>=8211&&n<=8214||n===8216||n===8217||n===8220||n===8221||n>=8224&&n<=8226||n>=8228&&n<=8231||n===8240||n===8242||n===8243||n===8245||n===8251||n===8254||n===8308||n===8319||n>=8321&&n<=8324||n===8364||n===8451||n===8453||n===8457||n===8467||n===8470||n===8481||n===8482||n===8486||n===8491||n===8531||n===8532||n>=8539&&n<=8542||n>=8544&&n<=8555||n>=8560&&n<=8569||n===8585||n>=8592&&n<=8601||n===8632||n===8633||n===8658||n===8660||n===8679||n===8704||n===8706||n===8707||n===8711||n===8712||n===8715||n===8719||n===8721||n===8725||n===8730||n>=8733&&n<=8736||n===8739||n===8741||n>=8743&&n<=8748||n===8750||n>=8756&&n<=8759||n===8764||n===8765||n===8776||n===8780||n===8786||n===8800||n===8801||n>=8804&&n<=8807||n===8810||n===8811||n===8814||n===8815||n===8834||n===8835||n===8838||n===8839||n===8853||n===8857||n===8869||n===8895||n===8978||n>=9312&&n<=9449||n>=9451&&n<=9547||n>=9552&&n<=9587||n>=9600&&n<=9615||n>=9618&&n<=9621||n===9632||n===9633||n>=9635&&n<=9641||n===9650||n===9651||n===9654||n===9655||n===9660||n===9661||n===9664||n===9665||n>=9670&&n<=9672||n===9675||n>=9678&&n<=9681||n>=9698&&n<=9701||n===9711||n===9733||n===9734||n===9737||n===9742||n===9743||n===9756||n===9758||n===9792||n===9794||n===9824||n===9825||n>=9827&&n<=9829||n>=9831&&n<=9834||n===9836||n===9837||n===9839||n===9886||n===9887||n===9919||n>=9926&&n<=9933||n>=9935&&n<=9939||n>=9941&&n<=9953||n===9955||n===9960||n===9961||n>=9963&&n<=9969||n===9972||n>=9974&&n<=9977||n===9979||n===9980||n===9982||n===9983||n===10045||n>=10102&&n<=10111||n>=11094&&n<=11097||n>=12872&&n<=12879||n>=57344&&n<=63743||n>=65024&&n<=65039||n===65533||n>=127232&&n<=127242||n>=127248&&n<=127277||n>=127280&&n<=127337||n>=127344&&n<=127373||n===127375||n===127376||n>=127387&&n<=127404||n>=917760&&n<=917999||n>=983040&&n<=1048573||n>=1048576&&n<=1114109,qi=(n)=>n===12288||n>=65281&&n<=65376||n>=65504&&n<=65510,Li=(n)=>n>=4352&&n<=4447||n===8986||n===8987||n===9001||n===9002||n>=9193&&n<=9196||n===9200||n===9203||n===9725||n===9726||n===9748||n===9749||n>=9800&&n<=9811||n===9855||n===9875||n===9889||n===9898||n===9899||n===9917||n===9918||n===9924||n===9925||n===9934||n===9940||n===9962||n===9970||n===9971||n===9973||n===9978||n===9981||n===9989||n===9994||n===9995||n===10024||n===10060||n===10062||n>=10067&&n<=10069||n===10071||n>=10133&&n<=10135||n===10160||n===10175||n===11035||n===11036||n===11088||n===11093||n>=11904&&n<=11929||n>=11931&&n<=12019||n>=12032&&n<=12245||n>=12272&&n<=12287||n>=12289&&n<=12350||n>=12353&&n<=12438||n>=12441&&n<=12543||n>=12549&&n<=12591||n>=12593&&n<=12686||n>=12688&&n<=12771||n>=12783&&n<=12830||n>=12832&&n<=12871||n>=12880&&n<=19903||n>=19968&&n<=42124||n>=42128&&n<=42182||n>=43360&&n<=43388||n>=44032&&n<=55203||n>=63744&&n<=64255||n>=65040&&n<=65049||n>=65072&&n<=65106||n>=65108&&n<=65126||n>=65128&&n<=65131||n>=94176&&n<=94180||n===94192||n===94193||n>=94208&&n<=100343||n>=100352&&n<=101589||n>=101632&&n<=101640||n>=110576&&n<=110579||n>=110581&&n<=110587||n===110589||n===110590||n>=110592&&n<=110882||n===110898||n>=110928&&n<=110930||n===110933||n>=110948&&n<=110951||n>=110960&&n<=111355||n===126980||n===127183||n===127374||n>=127377&&n<=127386||n>=127488&&n<=127490||n>=127504&&n<=127547||n>=127552&&n<=127560||n===127568||n===127569||n>=127584&&n<=127589||n>=127744&&n<=127776||n>=127789&&n<=127797||n>=127799&&n<=127868||n>=127870&&n<=127891||n>=127904&&n<=127946||n>=127951&&n<=127955||n>=127968&&n<=127984||n===127988||n>=127992&&n<=128062||n===128064||n>=128066&&n<=128252||n>=128255&&n<=128317||n>=128331&&n<=128334||n>=128336&&n<=128359||n===128378||n===128405||n===128406||n===128420||n>=128507&&n<=128591||n>=128640&&n<=128709||n===128716||n>=128720&&n<=128722||n>=128725&&n<=128727||n>=128732&&n<=128735||n===128747||n===128748||n>=128756&&n<=128764||n>=128992&&n<=129003||n===129008||n>=129292&&n<=129338||n>=129340&&n<=129349||n>=129351&&n<=129535||n>=129648&&n<=129660||n>=129664&&n<=129672||n>=129680&&n<=129725||n>=129727&&n<=129733||n>=129742&&n<=129755||n>=129760&&n<=129768||n>=129776&&n<=129784||n>=131072&&n<=196605||n>=196608&&n<=262141,gl=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/y,Mg=/[\x00-\x08\x0A-\x1F\x7F-\x9F]{1,1000}/y,jg=/\t{1,1000}/y,ll=/[\u{1F1E6}-\u{1F1FF}]{2}|\u{1F3F4}[\u{E0061}-\u{E007A}]{2}[\u{E0030}-\u{E0039}\u{E0061}-\u{E007A}]{1,3}\u{E007F}|(?:\p{Emoji}\uFE0F\u20E3?|\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation})(?:\u200D(?:\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F\u20E3?))*/yu,Qg=/(?:[\x20-\x7E\xA0-\xFF](?!\uFE0F)){1,1000}/y,di=/\p{M}+/gu,_i={limit:1/0,ellipsis:""},X1=(n,g={},l={})=>{let i=g.limit??1/0,$=g.ellipsis??"",x=g?.ellipsisWidth??($?X1($,_i,l).width:0),C=l.ansiWidth??0,m=l.controlWidth??0,N=l.tabWidth??8,I=l.ambiguousWidth??1,M=l.emojiWidth??2,u=l.fullWidthWidth??2,Q=l.regularWidth??1,X=l.wideWidth??2,G=0,J=0,K=n.length,z=0,O=!1,A=K,H=Math.max(0,i-x),f=0,U=0,R=0,Y=0;n:for(;;){if(U>f||J>=K&&J>G){let d=n.slice(f,U)||n.slice(G,J);z=0;for(let E of d.replaceAll(di,"")){let h=E.codePointAt(0)||0;if(qi(h)?Y=u:Li(h)?Y=X:I!==Q&&Bi(h)?Y=I:Y=Q,R+Y>H&&(A=Math.min(A,Math.max(f,G)+z)),R+Y>i){O=!0;break n}z+=E.length,R+=Y}f=U=0}if(J>=K)break;if(Qg.lastIndex=J,Qg.test(n)){if(z=Qg.lastIndex-J,Y=z*Q,R+Y>H&&(A=Math.min(A,J+Math.floor((H-R)/Q))),R+Y>i){O=!0;break}R+=Y,f=G,U=J,J=G=Qg.lastIndex;continue}if(gl.lastIndex=J,gl.test(n)){if(R+C>H&&(A=Math.min(A,J)),R+C>i){O=!0;break}R+=C,f=G,U=J,J=G=gl.lastIndex;continue}if(Mg.lastIndex=J,Mg.test(n)){if(z=Mg.lastIndex-J,Y=z*m,R+Y>H&&(A=Math.min(A,J+Math.floor((H-R)/m))),R+Y>i){O=!0;break}R+=Y,f=G,U=J,J=G=Mg.lastIndex;continue}if(jg.lastIndex=J,jg.test(n)){if(z=jg.lastIndex-J,Y=z*N,R+Y>H&&(A=Math.min(A,J+Math.floor((H-R)/N))),R+Y>i){O=!0;break}R+=Y,f=G,U=J,J=G=jg.lastIndex;continue}if(ll.lastIndex=J,ll.test(n)){if(R+M>H&&(A=Math.min(A,J)),R+M>i){O=!0;break}R+=M,f=G,U=J,J=G=ll.lastIndex;continue}J+=1}return{width:O?H:R,index:O?A:K,truncated:O,ellipsed:O&&i>=x}},Pi={limit:1/0,ellipsis:"",ellipsisWidth:0},bn=(n,g={})=>X1(n,Pi,g).width,Xg="\x1B",z1="",Fi=39,Cl="\x07",K1="[",yi="]",R1="m",Nl=`${yi}8;;`,M1=new RegExp(`(?:\\${K1}(?<code>\\d+)m|\\${Nl}(?<uri>.*)${Cl})`,"y"),vi=(n)=>{if(n>=30&&n<=37||n>=90&&n<=97)return 39;if(n>=40&&n<=47||n>=100&&n<=107)return 49;if(n===1||n===2)return 22;if(n===3)return 23;if(n===4)return 24;if(n===7)return 27;if(n===8)return 28;if(n===9)return 29;if(n===0)return 0},j1=(n)=>`${Xg}${K1}${n}${R1}`,Q1=(n)=>`${Xg}${Nl}${n}${Cl}`,Wi=(n)=>n.map((g)=>bn(g)),il=(n,g,l)=>{let i=g[Symbol.iterator](),$=!1,x=!1,C=n.at(-1),m=C===void 0?0:bn(C),N=i.next(),I=i.next(),M=0;for(;!N.done;){let u=N.value,Q=bn(u);m+Q<=l?n[n.length-1]+=u:(n.push(u),m=0),(u===Xg||u===z1)&&($=!0,x=g.startsWith(Nl,M+1)),$?x?u===Cl&&($=!1,x=!1):u===R1&&($=!1):(m+=Q,m===l&&!I.done&&(n.push(""),m=0)),N=I,I=i.next(),M+=u.length}C=n.at(-1),!m&&C!==void 0&&C.length>0&&n.length>1&&(n[n.length-2]+=n.pop())},ci=(n)=>{let g=n.split(" "),l=g.length;for(;l>0&&!(bn(g[l-1])>0);)l--;return l===g.length?n:g.slice(0,l).join(" ")+g.slice(l).join("")},Ei=(n,g,l={})=>{if(l.trim!==!1&&n.trim()==="")return"";let i="",$,x,C=n.split(" "),m=Wi(C),N=[""];for(let[G,J]of C.entries()){l.trim!==!1&&(N[N.length-1]=(N.at(-1)??"").trimStart());let K=bn(N.at(-1)??"");if(G!==0&&(K>=g&&(l.wordWrap===!1||l.trim===!1)&&(N.push(""),K=0),(K>0||l.trim===!1)&&(N[N.length-1]+=" ",K++)),l.hard&&m[G]>g){let z=g-K,O=1+Math.floor((m[G]-z-1)/g);Math.floor((m[G]-1)/g)<O&&N.push(""),il(N,J,g);continue}if(K+m[G]>g&&K>0&&m[G]>0){if(l.wordWrap===!1&&K<g){il(N,J,g);continue}N.push("")}if(K+m[G]>g&&l.wordWrap===!1){il(N,J,g);continue}N[N.length-1]+=J}l.trim!==!1&&(N=N.map((G)=>ci(G)));let I=N.join(`
`),M=I[Symbol.iterator](),u=M.next(),Q=M.next(),X=0;for(;!u.done;){let G=u.value,J=Q.value;if(i+=G,G===Xg||G===z1){M1.lastIndex=X+1;let z=M1.exec(I)?.groups;if(z?.code!==void 0){let O=Number.parseFloat(z.code);$=O===Fi?void 0:O}else z?.uri!==void 0&&(x=z.uri.length===0?void 0:z.uri)}let K=$?vi($):void 0;J===`
`?(x&&(i+=Q1("")),$&&K&&(i+=j1(K))):G===`
`&&($&&K&&(i+=j1($)),x&&(i+=Q1(x))),X+=G.length,u=Q,Q=M.next()}return i};function $l(n,g,l){return String(n).normalize().replaceAll(`\r
`,`
`).split(`
`).map((i)=>Ei(i,g,l)).join(`
`)}var wi=["up","down","left","right","space","enter","cancel"],e={actions:new Set(wi),aliases:new Map([["k","up"],["j","down"],["h","left"],["l","right"],["\x03","cancel"],["escape","cancel"]]),messages:{cancel:"Canceled",error:"Something went wrong"},withGuide:!0};function Il(n,g){if(typeof n=="string")return e.aliases.get(n)===g;for(let l of n)if(l!==void 0&&Il(l,g))return!0;return!1}function bi(n,g){if(n===g)return;let l=n.split(`
`),i=g.split(`
`),$=Math.max(l.length,i.length),x=[];for(let C=0;C<$;C++)l[C]!==i[C]&&x.push(C);return{lines:x,numLinesBefore:l.length,numLinesAfter:i.length,numLines:$}}var hi=globalThis.process.platform.startsWith("win"),xl=Symbol("clack:cancel");function a(n){return n===xl}function Zg(n,g){let l=n;l.isTTY&&l.setRawMode(g)}function O1({input:n=Z1,output:g=ml,overwrite:l=!0,hideCursor:i=!0}={}){let $=Zn.createInterface({input:n,output:g,prompt:"",tabSize:1});Zn.emitKeypressEvents(n,$),n instanceof J1&&n.isTTY&&n.setRawMode(!0);let x=(C,{name:m,sequence:N})=>{let I=String(C);if(Il([I,m,N],"cancel")){i&&g.write(W.cursor.show),process.exit(0);return}if(!l)return;Zn.moveCursor(g,m==="return"?0:-1,m==="return"?-1:0,()=>{Zn.clearLine(g,1,()=>{n.once("keypress",x)})})};return i&&g.write(W.cursor.hide),n.once("keypress",x),()=>{n.off("keypress",x),i&&g.write(W.cursor.show),n instanceof J1&&n.isTTY&&!hi&&n.setRawMode(!1),$.terminal=!1,$.close()}}var hn=(n)=>("columns"in n)&&typeof n.columns=="number"?n.columns:80,ul=(n)=>("rows"in n)&&typeof n.rows=="number"?n.rows:20;function fn(n,g,l,i=l){let $=hn(n??ml);return $l(g,$-l.length,{hard:!0,trim:!1}).split(`
`).map((x,C)=>`${C===0?i:l}${x}`).join(`
`)}class Hn{input;output;_abortSignal;rl;opts;_render;_track=!1;_prevFrame="";_subscribers=new Map;_cursor=0;state="initial";error="";value;userInput="";constructor(n,g=!0){let{input:l=Z1,output:i=ml,render:$,signal:x,...C}=n;this.opts=C,this.onKeypress=this.onKeypress.bind(this),this.close=this.close.bind(this),this.render=this.render.bind(this),this._render=$.bind(this),this._track=g,this._abortSignal=x,this.input=l,this.output=i}unsubscribe(){this._subscribers.clear()}setSubscriber(n,g){let l=this._subscribers.get(n)??[];l.push(g),this._subscribers.set(n,l)}on(n,g){this.setSubscriber(n,{cb:g})}once(n,g){this.setSubscriber(n,{cb:g,once:!0})}emit(n,...g){let l=this._subscribers.get(n)??[],i=[];for(let $ of l)$.cb(...g),$.once&&i.push(()=>l.splice(l.indexOf($),1));for(let $ of i)$()}prompt(){return new Promise((n)=>{if(this._abortSignal){if(this._abortSignal.aborted)return this.state="cancel",this.close(),n(xl);this._abortSignal.addEventListener("abort",()=>{this.state="cancel",this.close()},{once:!0})}this.rl=Ti.createInterface({input:this.input,tabSize:2,prompt:"",escapeCodeTimeout:50,terminal:!0}),this.rl.prompt(),this.opts.initialUserInput!==void 0&&this._setUserInput(this.opts.initialUserInput,!0),this.input.on("keypress",this.onKeypress),Zg(this.input,!0),this.output.on("resize",this.render),this.render(),this.once("submit",()=>{this.output.write(W.cursor.show),this.output.off("resize",this.render),Zg(this.input,!1),n(this.value)}),this.once("cancel",()=>{this.output.write(W.cursor.show),this.output.off("resize",this.render),Zg(this.input,!1),n(xl)})})}_isActionKey(n,g){return n==="\t"}_setValue(n){this.value=n,this.emit("value",this.value)}_setUserInput(n,g){this.userInput=n??"",this.emit("userInput",this.userInput),g&&this._track&&this.rl&&(this.rl.write(this.userInput),this._cursor=this.rl.cursor)}_clearUserInput(){this.rl?.write(null,{ctrl:!0,name:"u"}),this._setUserInput("")}onKeypress(n,g){if(this._track&&g.name!=="return"&&(g.name&&this._isActionKey(n,g)&&this.rl?.write(null,{ctrl:!0,name:"h"}),this._cursor=this.rl?.cursor??0,this._setUserInput(this.rl?.line)),this.state==="error"&&(this.state="active"),g?.name&&(!this._track&&e.aliases.has(g.name)&&this.emit("cursor",e.aliases.get(g.name)),e.actions.has(g.name)&&this.emit("cursor",g.name)),n&&(n.toLowerCase()==="y"||n.toLowerCase()==="n")&&this.emit("confirm",n.toLowerCase()==="y"),this.emit("key",n?.toLowerCase(),g),g?.name==="return"){if(this.opts.validate){let l=this.opts.validate(this.value);l&&(this.error=l instanceof Error?l.message:l,this.state="error",this.rl?.write(this.userInput))}this.state!=="error"&&(this.state="submit")}Il([n,g?.name,g?.sequence],"cancel")&&(this.state="cancel"),(this.state==="submit"||this.state==="cancel")&&this.emit("finalize"),this.render(),(this.state==="submit"||this.state==="cancel")&&this.close()}close(){this.input.unpipe(),this.input.removeListener("keypress",this.onKeypress),this.output.write(`
`),Zg(this.input,!1),this.rl?.close(),this.rl=void 0,this.emit(`${this.state}`,this.value),this.unsubscribe()}restoreCursor(){let n=$l(this._prevFrame,process.stdout.columns,{hard:!0,trim:!1}).split(`
`).length-1;this.output.write(W.cursor.move(-999,n*-1))}render(){let n=$l(this._render(this)??"",process.stdout.columns,{hard:!0,trim:!1});if(n!==this._prevFrame){if(this.state==="initial")this.output.write(W.cursor.hide);else{let g=bi(this._prevFrame,n),l=ul(this.output);if(this.restoreCursor(),g){let i=Math.max(0,g.numLinesAfter-l),$=Math.max(0,g.numLinesBefore-l),x=g.lines.find((C)=>C>=i);if(x===void 0){this._prevFrame=n;return}if(g.lines.length===1){this.output.write(W.cursor.move(0,x-$)),this.output.write(W.erase.lines(1));let C=n.split(`
`);this.output.write(C[x]),this._prevFrame=n,this.output.write(W.cursor.move(0,C.length-x-1));return}else if(g.lines.length>1){if(i<$)x=i;else{let m=x-$;m>0&&this.output.write(W.cursor.move(0,m))}this.output.write(W.erase.down());let C=n.split(`
`).slice(x);this.output.write(C.join(`
`)),this._prevFrame=n;return}}this.output.write(W.erase.down())}this.output.write(n),this.state==="initial"&&(this.state="active"),this._prevFrame=n}}}function si(n,g){if(n===void 0||g.length===0)return 0;let l=g.findIndex((i)=>i.value===n);return l!==-1?l:0}function ki(n,g){return(g.label??String(g.value)).toLowerCase().includes(n.toLowerCase())}function pi(n,g){if(g)return n?g:g[0]}class Y1 extends Hn{filteredOptions;multiple;isNavigating=!1;selectedValues=[];focusedValue;#n=0;#l="";#i;#g;get cursor(){return this.#n}get userInputWithCursor(){if(!this.userInput)return wn.default.inverse(wn.default.hidden("_"));if(this._cursor>=this.userInput.length)return`${this.userInput}`;let n=this.userInput.slice(0,this._cursor),[g,...l]=this.userInput.slice(this._cursor);return`${n}${wn.default.inverse(g)}${l.join("")}`}get options(){return typeof this.#g=="function"?this.#g():this.#g}constructor(n){super(n),this.#g=n.options;let g=this.options;this.filteredOptions=[...g],this.multiple=n.multiple===!0,this.#i=n.filter??ki;let l;if(n.initialValue&&Array.isArray(n.initialValue)?this.multiple?l=n.initialValue:l=n.initialValue.slice(0,1):!this.multiple&&this.options.length>0&&(l=[this.options[0].value]),l)for(let i of l){let $=g.findIndex((x)=>x.value===i);$!==-1&&(this.toggleSelected(i),this.#n=$)}this.focusedValue=this.options[this.#n]?.value,this.on("key",(i,$)=>this.#$(i,$)),this.on("userInput",(i)=>this.#x(i))}_isActionKey(n,g){return n==="\t"||this.multiple&&this.isNavigating&&g.name==="space"&&n!==void 0&&n!==""}#$(n,g){let l=g.name==="up",i=g.name==="down",$=g.name==="return";l||i?(this.#n=Math.max(0,Math.min(this.#n+(l?-1:1),this.filteredOptions.length-1)),this.focusedValue=this.filteredOptions[this.#n]?.value,this.multiple||(this.selectedValues=[this.focusedValue]),this.isNavigating=!0):$?this.value=pi(this.multiple,this.selectedValues):this.multiple?this.focusedValue!==void 0&&(g.name==="tab"||this.isNavigating&&g.name==="space")?this.toggleSelected(this.focusedValue):this.isNavigating=!1:(this.focusedValue&&(this.selectedValues=[this.focusedValue]),this.isNavigating=!1)}deselectAll(){this.selectedValues=[]}toggleSelected(n){this.filteredOptions.length!==0&&(this.multiple?this.selectedValues.includes(n)?this.selectedValues=this.selectedValues.filter((g)=>g!==n):this.selectedValues=[...this.selectedValues,n]:this.selectedValues=[n])}#x(n){if(n!==this.#l){this.#l=n;let g=this.options;n?this.filteredOptions=g.filter((l)=>this.#i(n,l)):this.filteredOptions=[...g],this.#n=si(this.focusedValue,this.filteredOptions),this.focusedValue=this.filteredOptions[this.#n]?.value,this.multiple||(this.focusedValue!==void 0?this.toggleSelected(this.focusedValue):this.deselectAll())}}}class Gl extends Hn{get cursor(){return this.value?0:1}get _value(){return this.cursor===0}constructor(n){super(n,!1),this.value=!!n.initialValue,this.on("userInput",()=>{this.value=this._value}),this.on("confirm",(g)=>{this.output.write(W.cursor.move(0,-1)),this.value=g,this.state="submit",this.close()}),this.on("cursor",()=>{this.value=!this.value})}}class A1 extends Hn{options;cursor=0;#n;getGroupItems(n){return this.options.filter((g)=>g.group===n)}isGroupSelected(n){let g=this.getGroupItems(n),l=this.value;return l===void 0?!1:g.every((i)=>l.includes(i.value))}toggleValue(){let n=this.options[this.cursor];if(this.value===void 0&&(this.value=[]),n.group===!0){let g=n.value,l=this.getGroupItems(g);this.isGroupSelected(g)?this.value=this.value.filter((i)=>l.findIndex(($)=>$.value===i)===-1):this.value=[...this.value,...l.map((i)=>i.value)],this.value=Array.from(new Set(this.value))}else{let g=this.value.includes(n.value);this.value=g?this.value.filter((l)=>l!==n.value):[...this.value,n.value]}}constructor(n){super(n,!1);let{options:g}=n;this.#n=n.selectableGroups!==!1,this.options=Object.entries(g).flatMap(([l,i])=>[{value:l,group:!0,label:l},...i.map(($)=>({...$,group:l}))]),this.value=[...n.initialValues??[]],this.cursor=Math.max(this.options.findIndex(({value:l})=>l===n.cursorAt),this.#n?0:1),this.on("cursor",(l)=>{switch(l){case"left":case"up":{this.cursor=this.cursor===0?this.options.length-1:this.cursor-1;let i=this.options[this.cursor]?.group===!0;!this.#n&&i&&(this.cursor=this.cursor===0?this.options.length-1:this.cursor-1);break}case"down":case"right":{this.cursor=this.cursor===this.options.length-1?0:this.cursor+1;let i=this.options[this.cursor]?.group===!0;!this.#n&&i&&(this.cursor=this.cursor===this.options.length-1?0:this.cursor+1);break}case"space":this.toggleValue();break}})}}function An(n,g,l){let i=n+g,$=Math.max(l.length-1,0),x=i<0?$:i>$?0:i;return l[x].disabled?An(x,g<0?-1:1,l):x}class Jl extends Hn{options;cursor=0;get _value(){return this.options[this.cursor].value}get _enabledOptions(){return this.options.filter((n)=>n.disabled!==!0)}toggleAll(){let n=this._enabledOptions,g=this.value!==void 0&&this.value.length===n.length;this.value=g?[]:n.map((l)=>l.value)}toggleInvert(){let n=this.value;if(!n)return;let g=this._enabledOptions.filter((l)=>!n.includes(l.value));this.value=g.map((l)=>l.value)}toggleValue(){this.value===void 0&&(this.value=[]);let n=this.value.includes(this._value);this.value=n?this.value.filter((g)=>g!==this._value):[...this.value,this._value]}constructor(n){super(n,!1),this.options=n.options,this.value=[...n.initialValues??[]];let g=Math.max(this.options.findIndex(({value:l})=>l===n.cursorAt),0);this.cursor=this.options[g].disabled?An(g,1,this.options):g,this.on("key",(l)=>{l==="a"&&this.toggleAll(),l==="i"&&this.toggleInvert()}),this.on("cursor",(l)=>{switch(l){case"left":case"up":this.cursor=An(this.cursor,-1,this.options);break;case"down":case"right":this.cursor=An(this.cursor,1,this.options);break;case"space":this.toggleValue();break}})}}class Ml extends Hn{options;cursor=0;get _selectedValue(){return this.options[this.cursor]}changeValue(){this.value=this._selectedValue.value}constructor(n){super(n,!1),this.options=n.options;let g=this.options.findIndex(({value:i})=>i===n.initialValue),l=g===-1?0:g;this.cursor=this.options[l].disabled?An(l,1,this.options):l,this.changeValue(),this.on("cursor",(i)=>{switch(i){case"left":case"up":this.cursor=An(this.cursor,-1,this.options);break;case"down":case"right":this.cursor=An(this.cursor,1,this.options);break}this.changeValue()})}}class jl extends Hn{get userInputWithCursor(){if(this.state==="submit")return this.userInput;let n=this.userInput;if(this.cursor>=n.length)return`${this.userInput}`;let g=n.slice(0,this.cursor),[l,...i]=n.slice(this.cursor);return`${g}${wn.default.inverse(l)}${i.join("")}`}get cursor(){return this._cursor}constructor(n){super({...n,initialUserInput:n.initialUserInput??n.initialValue}),this.on("userInput",(g)=>{this._setValue(g)}),this.on("finalize",()=>{this.value||(this.value=n.defaultValue),this.value===void 0&&(this.value="")})}}var j=o(qn(),1);import r from"node:process";var kn=o(nl(),1);function oi(){return r.platform!=="win32"?r.env.TERM!=="linux":!!r.env.CI||!!r.env.WT_SESSION||!!r.env.TERMINUS_SUBLIME||r.env.ConEmuTask==="{cmd::Cmder}"||r.env.TERM_PROGRAM==="Terminus-Sublime"||r.env.TERM_PROGRAM==="vscode"||r.env.TERM==="xterm-256color"||r.env.TERM==="alacritty"||r.env.TERMINAL_EMULATOR==="JetBrains-JediTerm"}var zl=oi(),ai=()=>process.env.CI==="true";var T=(n,g)=>zl?n:g,ri=T("","*"),T1=T("","x"),B1=T("","x"),Ag=T("","o"),ti=T("","T"),V=T("","|"),Xn=T("",""),rm=T("","T"),tm=T("",""),Kl=T("",">"),Yg=T(""," "),ei=T("","[]"),f1=T("","[+]"),H1=T("","[ ]"),em=T("",""),D1=T("","-"),n$=T("","+"),g$=T("","+"),l$=T("","+"),i$=T("","+"),n4=T("","+"),$$=T("",""),x$=T("","*"),m$=T("","!"),C$=T("","x"),fg=(n)=>{switch(n){case"initial":case"active":return j.default.cyan(ri);case"cancel":return j.default.red(T1);case"error":return j.default.yellow(B1);case"submit":return j.default.green(Ag)}},q1=(n)=>{switch(n){case"initial":case"active":return j.default.cyan(V);case"cancel":return j.default.red(V);case"error":return j.default.yellow(V);case"submit":return j.default.green(V)}},N$=(n)=>n===161||n===164||n===167||n===168||n===170||n===173||n===174||n>=176&&n<=180||n>=182&&n<=186||n>=188&&n<=191||n===198||n===208||n===215||n===216||n>=222&&n<=225||n===230||n>=232&&n<=234||n===236||n===237||n===240||n===242||n===243||n>=247&&n<=250||n===252||n===254||n===257||n===273||n===275||n===283||n===294||n===295||n===299||n>=305&&n<=307||n===312||n>=319&&n<=322||n===324||n>=328&&n<=331||n===333||n===338||n===339||n===358||n===359||n===363||n===462||n===464||n===466||n===468||n===470||n===472||n===474||n===476||n===593||n===609||n===708||n===711||n>=713&&n<=715||n===717||n===720||n>=728&&n<=731||n===733||n===735||n>=768&&n<=879||n>=913&&n<=929||n>=931&&n<=937||n>=945&&n<=961||n>=963&&n<=969||n===1025||n>=1040&&n<=1103||n===1105||n===8208||n>=8211&&n<=8214||n===8216||n===8217||n===8220||n===8221||n>=8224&&n<=8226||n>=8228&&n<=8231||n===8240||n===8242||n===8243||n===8245||n===8251||n===8254||n===8308||n===8319||n>=8321&&n<=8324||n===8364||n===8451||n===8453||n===8457||n===8467||n===8470||n===8481||n===8482||n===8486||n===8491||n===8531||n===8532||n>=8539&&n<=8542||n>=8544&&n<=8555||n>=8560&&n<=8569||n===8585||n>=8592&&n<=8601||n===8632||n===8633||n===8658||n===8660||n===8679||n===8704||n===8706||n===8707||n===8711||n===8712||n===8715||n===8719||n===8721||n===8725||n===8730||n>=8733&&n<=8736||n===8739||n===8741||n>=8743&&n<=8748||n===8750||n>=8756&&n<=8759||n===8764||n===8765||n===8776||n===8780||n===8786||n===8800||n===8801||n>=8804&&n<=8807||n===8810||n===8811||n===8814||n===8815||n===8834||n===8835||n===8838||n===8839||n===8853||n===8857||n===8869||n===8895||n===8978||n>=9312&&n<=9449||n>=9451&&n<=9547||n>=9552&&n<=9587||n>=9600&&n<=9615||n>=9618&&n<=9621||n===9632||n===9633||n>=9635&&n<=9641||n===9650||n===9651||n===9654||n===9655||n===9660||n===9661||n===9664||n===9665||n>=9670&&n<=9672||n===9675||n>=9678&&n<=9681||n>=9698&&n<=9701||n===9711||n===9733||n===9734||n===9737||n===9742||n===9743||n===9756||n===9758||n===9792||n===9794||n===9824||n===9825||n>=9827&&n<=9829||n>=9831&&n<=9834||n===9836||n===9837||n===9839||n===9886||n===9887||n===9919||n>=9926&&n<=9933||n>=9935&&n<=9939||n>=9941&&n<=9953||n===9955||n===9960||n===9961||n>=9963&&n<=9969||n===9972||n>=9974&&n<=9977||n===9979||n===9980||n===9982||n===9983||n===10045||n>=10102&&n<=10111||n>=11094&&n<=11097||n>=12872&&n<=12879||n>=57344&&n<=63743||n>=65024&&n<=65039||n===65533||n>=127232&&n<=127242||n>=127248&&n<=127277||n>=127280&&n<=127337||n>=127344&&n<=127373||n===127375||n===127376||n>=127387&&n<=127404||n>=917760&&n<=917999||n>=983040&&n<=1048573||n>=1048576&&n<=1114109,I$=(n)=>n===12288||n>=65281&&n<=65376||n>=65504&&n<=65510,u$=(n)=>n>=4352&&n<=4447||n===8986||n===8987||n===9001||n===9002||n>=9193&&n<=9196||n===9200||n===9203||n===9725||n===9726||n===9748||n===9749||n>=9800&&n<=9811||n===9855||n===9875||n===9889||n===9898||n===9899||n===9917||n===9918||n===9924||n===9925||n===9934||n===9940||n===9962||n===9970||n===9971||n===9973||n===9978||n===9981||n===9989||n===9994||n===9995||n===10024||n===10060||n===10062||n>=10067&&n<=10069||n===10071||n>=10133&&n<=10135||n===10160||n===10175||n===11035||n===11036||n===11088||n===11093||n>=11904&&n<=11929||n>=11931&&n<=12019||n>=12032&&n<=12245||n>=12272&&n<=12287||n>=12289&&n<=12350||n>=12353&&n<=12438||n>=12441&&n<=12543||n>=12549&&n<=12591||n>=12593&&n<=12686||n>=12688&&n<=12771||n>=12783&&n<=12830||n>=12832&&n<=12871||n>=12880&&n<=19903||n>=19968&&n<=42124||n>=42128&&n<=42182||n>=43360&&n<=43388||n>=44032&&n<=55203||n>=63744&&n<=64255||n>=65040&&n<=65049||n>=65072&&n<=65106||n>=65108&&n<=65126||n>=65128&&n<=65131||n>=94176&&n<=94180||n===94192||n===94193||n>=94208&&n<=100343||n>=100352&&n<=101589||n>=101632&&n<=101640||n>=110576&&n<=110579||n>=110581&&n<=110587||n===110589||n===110590||n>=110592&&n<=110882||n===110898||n>=110928&&n<=110930||n===110933||n>=110948&&n<=110951||n>=110960&&n<=111355||n===126980||n===127183||n===127374||n>=127377&&n<=127386||n>=127488&&n<=127490||n>=127504&&n<=127547||n>=127552&&n<=127560||n===127568||n===127569||n>=127584&&n<=127589||n>=127744&&n<=127776||n>=127789&&n<=127797||n>=127799&&n<=127868||n>=127870&&n<=127891||n>=127904&&n<=127946||n>=127951&&n<=127955||n>=127968&&n<=127984||n===127988||n>=127992&&n<=128062||n===128064||n>=128066&&n<=128252||n>=128255&&n<=128317||n>=128331&&n<=128334||n>=128336&&n<=128359||n===128378||n===128405||n===128406||n===128420||n>=128507&&n<=128591||n>=128640&&n<=128709||n===128716||n>=128720&&n<=128722||n>=128725&&n<=128727||n>=128732&&n<=128735||n===128747||n===128748||n>=128756&&n<=128764||n>=128992&&n<=129003||n===129008||n>=129292&&n<=129338||n>=129340&&n<=129349||n>=129351&&n<=129535||n>=129648&&n<=129660||n>=129664&&n<=129672||n>=129680&&n<=129725||n>=129727&&n<=129733||n>=129742&&n<=129755||n>=129760&&n<=129768||n>=129776&&n<=129784||n>=131072&&n<=196605||n>=196608&&n<=262141,Ql=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/y,zg=/[\x00-\x08\x0A-\x1F\x7F-\x9F]{1,1000}/y,Kg=/\t{1,1000}/y,Zl=/[\u{1F1E6}-\u{1F1FF}]{2}|\u{1F3F4}[\u{E0061}-\u{E007A}]{2}[\u{E0030}-\u{E0039}\u{E0061}-\u{E007A}]{1,3}\u{E007F}|(?:\p{Emoji}\uFE0F\u20E3?|\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation})(?:\u200D(?:\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F\u20E3?))*/yu,Rg=/(?:[\x20-\x7E\xA0-\xFF](?!\uFE0F)){1,1000}/y,G$=/\p{M}+/gu,J$={limit:1/0,ellipsis:""},L1=(n,g={},l={})=>{let i=g.limit??1/0,$=g.ellipsis??"",x=g?.ellipsisWidth??($?L1($,J$,l).width:0),C=l.ansiWidth??0,m=l.controlWidth??0,N=l.tabWidth??8,I=l.ambiguousWidth??1,M=l.emojiWidth??2,u=l.fullWidthWidth??2,Q=l.regularWidth??1,X=l.wideWidth??2,G=0,J=0,K=n.length,z=0,O=!1,A=K,H=Math.max(0,i-x),f=0,U=0,R=0,Y=0;n:for(;;){if(U>f||J>=K&&J>G){let d=n.slice(f,U)||n.slice(G,J);z=0;for(let E of d.replaceAll(G$,"")){let h=E.codePointAt(0)||0;if(I$(h)?Y=u:u$(h)?Y=X:I!==Q&&N$(h)?Y=I:Y=Q,R+Y>H&&(A=Math.min(A,Math.max(f,G)+z)),R+Y>i){O=!0;break n}z+=E.length,R+=Y}f=U=0}if(J>=K)break;if(Rg.lastIndex=J,Rg.test(n)){if(z=Rg.lastIndex-J,Y=z*Q,R+Y>H&&(A=Math.min(A,J+Math.floor((H-R)/Q))),R+Y>i){O=!0;break}R+=Y,f=G,U=J,J=G=Rg.lastIndex;continue}if(Ql.lastIndex=J,Ql.test(n)){if(R+C>H&&(A=Math.min(A,J)),R+C>i){O=!0;break}R+=C,f=G,U=J,J=G=Ql.lastIndex;continue}if(zg.lastIndex=J,zg.test(n)){if(z=zg.lastIndex-J,Y=z*m,R+Y>H&&(A=Math.min(A,J+Math.floor((H-R)/m))),R+Y>i){O=!0;break}R+=Y,f=G,U=J,J=G=zg.lastIndex;continue}if(Kg.lastIndex=J,Kg.test(n)){if(z=Kg.lastIndex-J,Y=z*N,R+Y>H&&(A=Math.min(A,J+Math.floor((H-R)/N))),R+Y>i){O=!0;break}R+=Y,f=G,U=J,J=G=Kg.lastIndex;continue}if(Zl.lastIndex=J,Zl.test(n)){if(R+M>H&&(A=Math.min(A,J)),R+M>i){O=!0;break}R+=M,f=G,U=J,J=G=Zl.lastIndex;continue}J+=1}return{width:O?H:R,index:O?A:K,truncated:O,ellipsed:O&&i>=x}},M$={limit:1/0,ellipsis:"",ellipsisWidth:0},Cn=(n,g={})=>L1(n,M$,g).width,Hg="\x1B",d1="",j$=39,Ol="\x07",_1="[",Q$="]",P1="m",Yl=`${Q$}8;;`,S1=new RegExp(`(?:\\${_1}(?<code>\\d+)m|\\${Yl}(?<uri>.*)${Ol})`,"y"),Z$=(n)=>{if(n>=30&&n<=37||n>=90&&n<=97)return 39;if(n>=40&&n<=47||n>=100&&n<=107)return 49;if(n===1||n===2)return 22;if(n===3)return 23;if(n===4)return 24;if(n===7)return 27;if(n===8)return 28;if(n===9)return 29;if(n===0)return 0},U1=(n)=>`${Hg}${_1}${n}${P1}`,V1=(n)=>`${Hg}${Yl}${n}${Ol}`,X$=(n)=>n.map((g)=>Cn(g)),Xl=(n,g,l)=>{let i=g[Symbol.iterator](),$=!1,x=!1,C=n.at(-1),m=C===void 0?0:Cn(C),N=i.next(),I=i.next(),M=0;for(;!N.done;){let u=N.value,Q=Cn(u);m+Q<=l?n[n.length-1]+=u:(n.push(u),m=0),(u===Hg||u===d1)&&($=!0,x=g.startsWith(Yl,M+1)),$?x?u===Ol&&($=!1,x=!1):u===P1&&($=!1):(m+=Q,m===l&&!I.done&&(n.push(""),m=0)),N=I,I=i.next(),M+=u.length}C=n.at(-1),!m&&C!==void 0&&C.length>0&&n.length>1&&(n[n.length-2]+=n.pop())},z$=(n)=>{let g=n.split(" "),l=g.length;for(;l>0&&!(Cn(g[l-1])>0);)l--;return l===g.length?n:g.slice(0,l).join(" ")+g.slice(l).join("")},K$=(n,g,l={})=>{if(l.trim!==!1&&n.trim()==="")return"";let i="",$,x,C=n.split(" "),m=X$(C),N=[""];for(let[G,J]of C.entries()){l.trim!==!1&&(N[N.length-1]=(N.at(-1)??"").trimStart());let K=Cn(N.at(-1)??"");if(G!==0&&(K>=g&&(l.wordWrap===!1||l.trim===!1)&&(N.push(""),K=0),(K>0||l.trim===!1)&&(N[N.length-1]+=" ",K++)),l.hard&&m[G]>g){let z=g-K,O=1+Math.floor((m[G]-z-1)/g);Math.floor((m[G]-1)/g)<O&&N.push(""),Xl(N,J,g);continue}if(K+m[G]>g&&K>0&&m[G]>0){if(l.wordWrap===!1&&K<g){Xl(N,J,g);continue}N.push("")}if(K+m[G]>g&&l.wordWrap===!1){Xl(N,J,g);continue}N[N.length-1]+=J}l.trim!==!1&&(N=N.map((G)=>z$(G)));let I=N.join(`
`),M=I[Symbol.iterator](),u=M.next(),Q=M.next(),X=0;for(;!u.done;){let G=u.value,J=Q.value;if(i+=G,G===Hg||G===d1){S1.lastIndex=X+1;let z=S1.exec(I)?.groups;if(z?.code!==void 0){let O=Number.parseFloat(z.code);$=O===j$?void 0:O}else z?.uri!==void 0&&(x=z.uri.length===0?void 0:z.uri)}let K=$?Z$($):void 0;J===`
`?(x&&(i+=V1("")),$&&K&&(i+=U1(K))):G===`
`&&($&&K&&(i+=U1($)),x&&(i+=V1(x))),X+=G.length,u=Q,Q=M.next()}return i};function pn(n,g,l){return String(n).normalize().replaceAll(`\r
`,`
`).split(`
`).map((i)=>K$(i,g,l)).join(`
`)}var R$=(n,g,l,i,$)=>{let x=g,C=0;for(let m=l;m<i;m++){let N=n[m];if(x=x-N.length,C++,x<=$)break}return{lineCount:x,removals:C}},Rl=(n)=>{let{cursor:g,options:l,style:i}=n,$=n.output??process.stdout,x=hn($),C=n.columnPadding??0,m=n.rowPadding??4,N=x-C,I=ul($),M=j.default.dim("..."),u=n.maxItems??Number.POSITIVE_INFINITY,Q=Math.max(I-m,0),X=Math.max(Math.min(u,Q),5),G=0;g>=X-3&&(G=Math.max(Math.min(g-X+3,l.length-X),0));let J=X<l.length&&G>0,K=X<l.length&&G+X<l.length,z=Math.min(G+X,l.length),O=[],A=0;J&&A++,K&&A++;let H=G+(J?1:0),f=z-(K?1:0);for(let R=H;R<f;R++){let Y=pn(i(l[R],R===g),N,{hard:!0,trim:!1}).split(`
`);O.push(Y),A+=Y.length}if(A>Q){let R=0,Y=0,d=A,E=g-H,h=(Yn,q)=>R$(O,d,Yn,q,Q);J?({lineCount:d,removals:R}=h(0,E),d>Q&&({lineCount:d,removals:Y}=h(E+1,O.length))):({lineCount:d,removals:Y}=h(E+1,O.length),d>Q&&({lineCount:d,removals:R}=h(0,E))),R>0&&(J=!0,O.splice(0,R)),Y>0&&(K=!0,O.splice(O.length-Y,Y))}let U=[];J&&U.push(M);for(let R of O)for(let Y of R)U.push(Y);return K&&U.push(M),U};var F1=(n)=>{let g=n.active??"Yes",l=n.inactive??"No";return new Gl({active:g,inactive:l,signal:n.signal,input:n.input,output:n.output,initialValue:n.initialValue??!0,render(){let i=`${j.default.gray(V)}
${fg(this.state)}  ${n.message}
`,$=this.value?g:l;switch(this.state){case"submit":return`${i}${j.default.gray(V)}  ${j.default.dim($)}`;case"cancel":return`${i}${j.default.gray(V)}  ${j.default.strikethrough(j.default.dim($))}
${j.default.gray(V)}`;default:return`${i}${j.default.cyan(V)}  ${this.value?`${j.default.green(Kl)} ${g}`:`${j.default.dim(Yg)} ${j.default.dim(g)}`} ${j.default.dim("/")} ${this.value?`${j.default.dim(Yg)} ${j.default.dim(l)}`:`${j.default.green(Kl)} ${l}`}
${j.default.cyan(Xn)}
`}}}).prompt()};var nn={message:(n=[],{symbol:g=j.default.gray(V),secondarySymbol:l=j.default.gray(V),output:i=process.stdout,spacing:$=1,withGuide:x}={})=>{let C=[],m=(x??e.withGuide)!==!1,N=m?l:"",I=m?`${g}  `:"",M=m?`${l}  `:"";for(let Q=0;Q<$;Q++)C.push(N);let u=Array.isArray(n)?n:n.split(`
`);if(u.length>0){let[Q,...X]=u;Q.length>0?C.push(`${I}${Q}`):C.push(m?g:"");for(let G of X)G.length>0?C.push(`${M}${G}`):C.push(m?l:"")}i.write(`${C.join(`
`)}
`)},info:(n,g)=>{nn.message(n,{...g,symbol:j.default.blue($$)})},success:(n,g)=>{nn.message(n,{...g,symbol:j.default.green(x$)})},step:(n,g)=>{nn.message(n,{...g,symbol:j.default.green(Ag)})},warn:(n,g)=>{nn.message(n,{...g,symbol:j.default.yellow(m$)})},warning:(n,g)=>{nn.warn(n,g)},error:(n,g)=>{nn.message(n,{...g,symbol:j.default.red(C$)})}},Jn=(n="",g)=>{(g?.output??process.stdout).write(`${j.default.gray(Xn)}  ${j.default.red(n)}

`)},Ln=(n="",g)=>{(g?.output??process.stdout).write(`${j.default.gray(ti)}  ${n}
`)},Nn=(n="",g)=>{(g?.output??process.stdout).write(`${j.default.gray(V)}
${j.default.gray(Xn)}  ${n}

`)},sn=(n,g)=>n.split(`
`).map((l)=>g(l)).join(`
`),Al=(n)=>{let g=(i,$)=>{let x=i.label??String(i.value);return $==="disabled"?`${j.default.gray(H1)} ${sn(x,(C)=>j.default.strikethrough(j.default.gray(C)))}${i.hint?` ${j.default.dim(`(${i.hint??"disabled"})`)}`:""}`:$==="active"?`${j.default.cyan(ei)} ${x}${i.hint?` ${j.default.dim(`(${i.hint})`)}`:""}`:$==="selected"?`${j.default.green(f1)} ${sn(x,j.default.dim)}${i.hint?` ${j.default.dim(`(${i.hint})`)}`:""}`:$==="cancelled"?`${sn(x,(C)=>j.default.strikethrough(j.default.dim(C)))}`:$==="active-selected"?`${j.default.green(f1)} ${x}${i.hint?` ${j.default.dim(`(${i.hint})`)}`:""}`:$==="submitted"?`${sn(x,j.default.dim)}`:`${j.default.dim(H1)} ${sn(x,j.default.dim)}`},l=n.required??!0;return new Jl({options:n.options,signal:n.signal,input:n.input,output:n.output,initialValues:n.initialValues,required:l,cursorAt:n.cursorAt,validate(i){if(l&&(i===void 0||i.length===0))return`Please select at least one option.
${j.default.reset(j.default.dim(`Press ${j.default.gray(j.default.bgWhite(j.default.inverse(" space ")))} to select, ${j.default.gray(j.default.bgWhite(j.default.inverse(" enter ")))} to submit`))}`},render(){let i=fn(n.output,n.message,`${q1(this.state)}  `,`${fg(this.state)}  `),$=`${j.default.gray(V)}
${i}
`,x=this.value??[],C=(m,N)=>{if(m.disabled)return g(m,"disabled");let I=x.includes(m.value);return N&&I?g(m,"active-selected"):I?g(m,"selected"):g(m,N?"active":"inactive")};switch(this.state){case"submit":{let m=this.options.filter(({value:I})=>x.includes(I)).map((I)=>g(I,"submitted")).join(j.default.dim(", "))||j.default.dim("none"),N=fn(n.output,m,`${j.default.gray(V)}  `);return`${$}${N}`}case"cancel":{let m=this.options.filter(({value:I})=>x.includes(I)).map((I)=>g(I,"cancelled")).join(j.default.dim(", "));if(m.trim()==="")return`${$}${j.default.gray(V)}`;let N=fn(n.output,m,`${j.default.gray(V)}  `);return`${$}${N}
${j.default.gray(V)}`}case"error":{let m=`${j.default.yellow(V)}  `,N=this.error.split(`
`).map((u,Q)=>Q===0?`${j.default.yellow(Xn)}  ${j.default.yellow(u)}`:`   ${u}`).join(`
`),I=$.split(`
`).length,M=N.split(`
`).length+1;return`${$}${m}${Rl({output:n.output,options:this.options,cursor:this.cursor,maxItems:n.maxItems,columnPadding:m.length,rowPadding:I+M,style:C}).join(`
${m}`)}
${N}
`}default:{let m=`${j.default.cyan(V)}  `,N=$.split(`
`).length;return`${$}${m}${Rl({output:n.output,options:this.options,cursor:this.cursor,maxItems:n.maxItems,columnPadding:m.length,rowPadding:N+2,style:C}).join(`
${m}`)}
${j.default.cyan(Xn)}
`}}}}).prompt()},O$=(n)=>j.default.dim(n),Y$=(n,g,l)=>{let i={hard:!0,trim:!1},$=pn(n,g,i).split(`
`),x=$.reduce((N,I)=>Math.max(Cn(I),N),0),C=$.map(l).reduce((N,I)=>Math.max(Cn(I),N),0),m=g-(C-x);return pn(n,m,i)},_=(n="",g="",l)=>{let i=l?.output??r.stdout,$=(l?.withGuide??e.withGuide)!==!1,x=l?.format??O$,C=["",...Y$(n,hn(i)-6,x).split(`
`).map(x),""],m=Cn(g),N=Math.max(C.reduce((Q,X)=>{let G=Cn(X);return G>Q?G:Q},0),m)+2,I=C.map((Q)=>`${j.default.gray(V)}  ${Q}${" ".repeat(N-Cn(Q))}${j.default.gray(V)}`).join(`
`),M=$?`${j.default.gray(V)}
`:"",u=$?g$:i$;i.write(`${M}${j.default.green(Ag)}  ${j.default.reset(g)} ${j.default.gray(D1.repeat(Math.max(N-m-1,1))+n$)}
${I}
${j.default.gray(u+D1.repeat(N+2)+l$)}
`)};var A$=j.default.magenta,Dg=({indicator:n="dots",onCancel:g,output:l=process.stdout,cancelMessage:i,errorMessage:$,frames:x=zl?["","","",""]:["","o","O","0"],delay:C=zl?80:120,signal:m,...N}={})=>{let I=ai(),M,u,Q=!1,X=!1,G="",J,K=performance.now(),z=hn(l),O=N?.styleFrame??A$,A=(q)=>{let p=q>1?$??e.messages.error:i??e.messages.cancel;X=q===1,Q&&(Yn(p,q),X&&typeof g=="function"&&g())},H=()=>A(2),f=()=>A(1),U=()=>{process.on("uncaughtExceptionMonitor",H),process.on("unhandledRejection",H),process.on("SIGINT",f),process.on("SIGTERM",f),process.on("exit",A),m&&m.addEventListener("abort",f)},R=()=>{process.removeListener("uncaughtExceptionMonitor",H),process.removeListener("unhandledRejection",H),process.removeListener("SIGINT",f),process.removeListener("SIGTERM",f),process.removeListener("exit",A),m&&m.removeEventListener("abort",f)},Y=()=>{if(J===void 0)return;I&&l.write(`
`);let q=pn(J,z,{hard:!0,trim:!1}).split(`
`);q.length>1&&l.write(kn.cursor.up(q.length-1)),l.write(kn.cursor.to(0)),l.write(kn.erase.down())},d=(q)=>q.replace(/\.+$/,""),E=(q)=>{let p=(performance.now()-q)/1000,un=Math.floor(p/60),Gn=Math.floor(p%60);return un>0?`[${un}m ${Gn}s]`:`[${Gn}s]`},h=(q="")=>{Q=!0,M=O1({output:l}),G=d(q),K=performance.now(),l.write(`${j.default.gray(V)}
`);let p=0,un=0;U(),u=setInterval(()=>{if(I&&G===J)return;Y(),J=G;let Gn=O(x[p]),ug;if(I)ug=`${Gn}  ${G}...`;else if(n==="timer")ug=`${Gn}  ${G} ${E(K)}`;else{let Ki=".".repeat(Math.floor(un)).slice(0,3);ug=`${Gn}  ${G}${Ki}`}let zi=pn(ug,z,{hard:!0,trim:!1});l.write(zi),p=p+1<x.length?p+1:0,un=un<4?un+0.125:0},C)},Yn=(q="",p=0,un=!1)=>{if(!Q)return;Q=!1,clearInterval(u),Y();let Gn=p===0?j.default.green(Ag):p===1?j.default.red(T1):j.default.red(B1);G=q??G,un||(n==="timer"?l.write(`${Gn}  ${G} ${E(K)}
`):l.write(`${Gn}  ${G}
`)),R(),M()};return{start:h,stop:(q="")=>Yn(q,0),message:(q="")=>{G=d(q??G)},cancel:(q="")=>Yn(q,1),error:(q="")=>Yn(q,2),clear:()=>Yn("",0,!0),get isCancelled(){return X}}},g4={light:T("","-"),heavy:T("","="),block:T("","#")};var Og=(n,g)=>n.includes(`
`)?n.split(`
`).map((l)=>g(l)).join(`
`):g(n),Sg=(n)=>{let g=(l,i)=>{let $=l.label??String(l.value);switch(i){case"disabled":return`${j.default.gray(Yg)} ${Og($,j.default.gray)}${l.hint?` ${j.default.dim(`(${l.hint??"disabled"})`)}`:""}`;case"selected":return`${Og($,j.default.dim)}`;case"active":return`${j.default.green(Kl)} ${$}${l.hint?` ${j.default.dim(`(${l.hint})`)}`:""}`;case"cancelled":return`${Og($,(x)=>j.default.strikethrough(j.default.dim(x)))}`;default:return`${j.default.dim(Yg)} ${Og($,j.default.dim)}`}};return new Ml({options:n.options,signal:n.signal,input:n.input,output:n.output,initialValue:n.initialValue,render(){let l=`${fg(this.state)}  `,i=`${q1(this.state)}  `,$=fn(n.output,n.message,i,l),x=`${j.default.gray(V)}
${$}
`;switch(this.state){case"submit":{let C=`${j.default.gray(V)}  `,m=fn(n.output,g(this.options[this.cursor],"selected"),C);return`${x}${m}`}case"cancel":{let C=`${j.default.gray(V)}  `,m=fn(n.output,g(this.options[this.cursor],"cancelled"),C);return`${x}${m}
${j.default.gray(V)}`}default:{let C=`${j.default.cyan(V)}  `,m=x.split(`
`).length;return`${x}${C}${Rl({output:n.output,cursor:this.cursor,options:this.options,maxItems:n.maxItems,columnPadding:C.length,rowPadding:m+2,style:(N,I)=>g(N,N.disabled?"disabled":I?"active":"inactive")}).join(`
${C}`)}
${j.default.cyan(Xn)}
`}}}}).prompt()};var l4=`${j.default.gray(V)}  `;var Ug=(n)=>new jl({validate:n.validate,placeholder:n.placeholder,defaultValue:n.defaultValue,initialValue:n.initialValue,output:n.output,signal:n.signal,input:n.input,render(){let g=(n?.withGuide??e.withGuide)!==!1,l=`${`${g?`${j.default.gray(V)}
`:""}${fg(this.state)}  `}${n.message}
`,i=n.placeholder?j.default.inverse(n.placeholder[0])+j.default.dim(n.placeholder.slice(1)):j.default.inverse(j.default.hidden("_")),$=this.userInput?this.userInputWithCursor:i,x=this.value??"";switch(this.state){case"error":{let C=this.error?`  ${j.default.yellow(this.error)}`:"",m=g?`${j.default.yellow(V)}  `:"",N=g?j.default.yellow(Xn):"";return`${l.trim()}
${m}${$}
${N}${C}
`}case"submit":{let C=x?`  ${j.default.dim(x)}`:"",m=g?j.default.gray(V):"";return`${l}${m}${C}`}case"cancel":{let C=x?`  ${j.default.strikethrough(j.default.dim(x))}`:"",m=g?j.default.gray(V):"";return`${l}${m}${C}${x.trim()?`
${m}`:""}`}default:{let C=g?`${j.default.cyan(V)}  `:"",m=g?j.default.cyan(Xn):"";return`${l}${C}${$}
${m}
`}}}}).prompt();var Z=o(qn(),1);import{existsSync as y,mkdirSync as En,readFileSync as ag,writeFileSync as Bn,readdirSync as i1}from"node:fs";import{execSync as Ig}from"node:child_process";import{dirname as rg,join as P}from"node:path";import{createHash as Jm}from"node:crypto";async function fl(n,g,{concurrency:l=Number.POSITIVE_INFINITY,stopOnError:i=!0,signal:$}={}){return new Promise((x,C)=>{if(n[Symbol.iterator]===void 0&&n[Symbol.asyncIterator]===void 0)throw TypeError(`Expected \`input\` to be either an \`Iterable\` or \`AsyncIterable\`, got (${typeof n})`);if(typeof g!=="function")throw TypeError("Mapper function is required");if(!(Number.isSafeInteger(l)&&l>=1||l===Number.POSITIVE_INFINITY))throw TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${l}\` (${typeof l})`);let m=[],N=[],I=new Map,M=!1,u=!1,Q=!1,X=0,G=0,J=n[Symbol.iterator]===void 0?n[Symbol.asyncIterator]():n[Symbol.iterator](),K=()=>{A($.reason)},z=()=>{$?.removeEventListener("abort",K)},O=(f)=>{x(f),z()},A=(f)=>{M=!0,u=!0,C(f),z()};if($){if($.aborted)A($.reason);$.addEventListener("abort",K,{once:!0})}let H=async()=>{if(u)return;let f=await J.next(),U=G;if(G++,f.done){if(Q=!0,X===0&&!u){if(!i&&N.length>0){A(AggregateError(N));return}if(u=!0,I.size===0){O(m);return}let R=[];for(let[Y,d]of m.entries()){if(I.get(Y)===y1)continue;R.push(d)}O(R)}return}X++,(async()=>{try{let R=await f.value;if(u)return;let Y=await g(R,U);if(Y===y1)I.set(U,Y);m[U]=Y,X--,await H()}catch(R){if(i)A(R);else{N.push(R),X--;try{await H()}catch(Y){A(Y)}}}})()};(async()=>{for(let f=0;f<l;f++){try{await H()}catch(U){A(U);break}if(Q||M)break}})()})}var y1=Symbol("skip");import{stat as nx}from"fs";import{stat as gx,readdir as lx}from"fs/promises";import{EventEmitter as ix}from"events";import*as S from"path";import{stat as H$,lstat as v1,readdir as D$,realpath as S$}from"node:fs/promises";import{Readable as U$}from"node:stream";import{resolve as W1,relative as V$,join as T$,sep as B$}from"node:path";var s={FILE_TYPE:"files",DIR_TYPE:"directories",FILE_DIR_TYPE:"files_directories",EVERYTHING_TYPE:"all"},Hl={root:".",fileFilter:(n)=>!0,directoryFilter:(n)=>!0,type:s.FILE_TYPE,lstat:!1,depth:2147483648,alwaysStat:!1,highWaterMark:4096};Object.freeze(Hl);var b1="READDIRP_RECURSIVE_ERROR",q$=new Set(["ENOENT","EPERM","EACCES","ELOOP",b1]),c1=[s.DIR_TYPE,s.EVERYTHING_TYPE,s.FILE_DIR_TYPE,s.FILE_TYPE],L$=new Set([s.DIR_TYPE,s.EVERYTHING_TYPE,s.FILE_DIR_TYPE]),d$=new Set([s.EVERYTHING_TYPE,s.FILE_DIR_TYPE,s.FILE_TYPE]),_$=(n)=>q$.has(n.code),P$=process.platform==="win32",E1=(n)=>!0,w1=(n)=>{if(n===void 0)return E1;if(typeof n==="function")return n;if(typeof n==="string"){let g=n.trim();return(l)=>l.basename===g}if(Array.isArray(n)){let g=n.map((l)=>l.trim());return(l)=>g.some((i)=>l.basename===i)}return E1};class h1 extends U${constructor(n={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:n.highWaterMark});let g={...Hl,...n},{root:l,type:i}=g;this._fileFilter=w1(g.fileFilter),this._directoryFilter=w1(g.directoryFilter);let $=g.lstat?v1:H$;if(P$)this._stat=(x)=>$(x,{bigint:!0});else this._stat=$;this._maxDepth=g.depth??Hl.depth,this._wantsDir=i?L$.has(i):!1,this._wantsFile=i?d$.has(i):!1,this._wantsEverything=i===s.EVERYTHING_TYPE,this._root=W1(l),this._isDirent=!g.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir(l,1)],this.reading=!1,this.parent=void 0}async _read(n){if(this.reading)return;this.reading=!0;try{while(!this.destroyed&&n>0){let g=this.parent,l=g&&g.files;if(l&&l.length>0){let{path:i,depth:$}=g,x=l.splice(0,n).map((m)=>this._formatEntry(m,i)),C=await Promise.all(x);for(let m of C){if(!m)continue;if(this.destroyed)return;let N=await this._getEntryType(m);if(N==="directory"&&this._directoryFilter(m)){if($<=this._maxDepth)this.parents.push(this._exploreDir(m.fullPath,$+1));if(this._wantsDir)this.push(m),n--}else if((N==="file"||this._includeAsFile(m))&&this._fileFilter(m)){if(this._wantsFile)this.push(m),n--}}}else{let i=this.parents.pop();if(!i){this.push(null);break}if(this.parent=await i,this.destroyed)return}}}catch(g){this.destroy(g)}finally{this.reading=!1}}async _exploreDir(n,g){let l;try{l=await D$(n,this._rdOptions)}catch(i){this._onError(i)}return{files:l,depth:g,path:n}}async _formatEntry(n,g){let l,i=this._isDirent?n.name:n;try{let $=W1(T$(g,i));l={path:V$(this._root,$),fullPath:$,basename:i},l[this._statsProp]=this._isDirent?n:await this._stat($)}catch($){this._onError($);return}return l}_onError(n){if(_$(n)&&!this.destroyed)this.emit("warn",n);else this.destroy(n)}async _getEntryType(n){if(!n&&this._statsProp in n)return"";let g=n[this._statsProp];if(g.isFile())return"file";if(g.isDirectory())return"directory";if(g&&g.isSymbolicLink()){let l=n.fullPath;try{let i=await S$(l),$=await v1(i);if($.isFile())return"file";if($.isDirectory()){let x=i.length;if(l.startsWith(i)&&l.substr(x,1)===B$){let C=Error(`Circular symlink detected: "${l}" points to "${i}"`);return C.code=b1,this._onError(C)}return"directory"}}catch(i){return this._onError(i),""}}}_includeAsFile(n){let g=n&&n[this._statsProp];return g&&this._wantsEverything&&!g.isDirectory()}}function s1(n,g={}){let l=g.entryType||g.type;if(l==="both")l=s.FILE_DIR_TYPE;if(l)g.type=l;if(!n)throw Error("readdirp: root argument is required. Usage: readdirp(root, options)");else if(typeof n!=="string")throw TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");else if(l&&!c1.includes(l))throw Error(`readdirp: Invalid type passed. Use one of ${c1.join(", ")}`);return g.root=n,new h1(g)}import{watchFile as F$,unwatchFile as k1,watch as y$}from"fs";import{open as v$,stat as o1,lstat as W$,realpath as Dl}from"fs/promises";import*as L from"path";import{type as c$}from"os";var E$="data",Vl="end",a1="close",qg=()=>{};var Lg=process.platform,Tl=Lg==="win32",w$=Lg==="darwin",b$=Lg==="linux",h$=Lg==="freebsd",r1=c$()==="OS400",B={ALL:"all",READY:"ready",ADD:"add",CHANGE:"change",ADD_DIR:"addDir",UNLINK:"unlink",UNLINK_DIR:"unlinkDir",RAW:"raw",ERROR:"error"},gn=B,s$="watch",k$={lstat:W$,stat:o1},Dn="listeners",Vg="errHandlers",dn="rawEmitters",p$=[Dn,Vg,dn],o$=new Set(["3dm","3ds","3g2","3gp","7z","a","aac","adp","afdesign","afphoto","afpub","ai","aif","aiff","alz","ape","apk","appimage","ar","arj","asf","au","avi","bak","baml","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","cur","dat","dcm","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","flatpak","fli","flv","fpx","fst","fvt","g3","gh","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lib","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","nupkg","o","odp","ods","odt","oga","ogg","ogv","otf","ott","pages","pbm","pcx","pdb","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","resources","rgb","rip","rlc","rmf","rmvb","rpm","rtf","rz","s3m","s7z","scpt","sgi","shar","snap","sil","sketch","slk","smv","snk","so","stl","suo","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wrm","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"]),a$=(n)=>o$.has(L.extname(n).slice(1).toLowerCase()),Ul=(n,g)=>{if(n instanceof Set)n.forEach(g);else g(n)},on=(n,g,l)=>{let i=n[g];if(!(i instanceof Set))n[g]=i=new Set([i]);i.add(l)},r$=(n)=>(g)=>{let l=n[g];if(l instanceof Set)l.clear();else delete n[g]},an=(n,g,l)=>{let i=n[g];if(i instanceof Set)i.delete(l);else if(i===l)delete n[g]},t1=(n)=>n instanceof Set?n.size===0:!n,Tg=new Map;function p1(n,g,l,i,$){let x=(C,m)=>{if(l(n),$(C,m,{watchedPath:n}),m&&n!==m)Bg(L.resolve(n,m),Dn,L.join(n,m))};try{return y$(n,{persistent:g.persistent},x)}catch(C){i(C);return}}var Bg=(n,g,l,i,$)=>{let x=Tg.get(n);if(!x)return;Ul(x[g],(C)=>{C(l,i,$)})},t$=(n,g,l,i)=>{let{listener:$,errHandler:x,rawEmitter:C}=i,m=Tg.get(g),N;if(!l.persistent){if(N=p1(n,l,$,x,C),!N)return;return N.close.bind(N)}if(m)on(m,Dn,$),on(m,Vg,x),on(m,dn,C);else{if(N=p1(n,l,Bg.bind(null,g,Dn),x,Bg.bind(null,g,dn)),!N)return;N.on(gn.ERROR,async(I)=>{let M=Bg.bind(null,g,Vg);if(m)m.watcherUnusable=!0;if(Tl&&I.code==="EPERM")try{await(await v$(n,"r")).close(),M(I)}catch(u){}else M(I)}),m={listeners:$,errHandlers:x,rawEmitters:C,watcher:N},Tg.set(g,m)}return()=>{if(an(m,Dn,$),an(m,Vg,x),an(m,dn,C),t1(m.listeners))m.watcher.close(),Tg.delete(g),p$.forEach(r$(m)),m.watcher=void 0,Object.freeze(m)}},Sl=new Map,e$=(n,g,l,i)=>{let{listener:$,rawEmitter:x}=i,C=Sl.get(g),m=C&&C.options;if(m&&(m.persistent<l.persistent||m.interval>l.interval))k1(g),C=void 0;if(C)on(C,Dn,$),on(C,dn,x);else C={listeners:$,rawEmitters:x,options:l,watcher:F$(g,l,(N,I)=>{Ul(C.rawEmitters,(u)=>{u(gn.CHANGE,g,{curr:N,prev:I})});let M=N.mtimeMs;if(N.size!==I.size||M>I.mtimeMs||M===0)Ul(C.listeners,(u)=>u(n,N))})},Sl.set(g,C);return()=>{if(an(C,Dn,$),an(C,dn,x),t1(C.listeners))Sl.delete(g),k1(g),C.options=C.watcher=void 0,Object.freeze(C)}};class Bl{constructor(n){this.fsw=n,this._boundHandleError=(g)=>n._handleError(g)}_watchWithNodeFs(n,g){let l=this.fsw.options,i=L.dirname(n),$=L.basename(n);this.fsw._getWatchedDir(i).add($);let C=L.resolve(n),m={persistent:l.persistent};if(!g)g=qg;let N;if(l.usePolling){let I=l.interval!==l.binaryInterval;m.interval=I&&a$($)?l.binaryInterval:l.interval,N=e$(n,C,m,{listener:g,rawEmitter:this.fsw._emitRaw})}else N=t$(n,C,m,{listener:g,errHandler:this._boundHandleError,rawEmitter:this.fsw._emitRaw});return N}_handleFile(n,g,l){if(this.fsw.closed)return;let i=L.dirname(n),$=L.basename(n),x=this.fsw._getWatchedDir(i),C=g;if(x.has($))return;let m=async(I,M)=>{if(!this.fsw._throttle(s$,n,5))return;if(!M||M.mtimeMs===0)try{let u=await o1(n);if(this.fsw.closed)return;let{atimeMs:Q,mtimeMs:X}=u;if(!Q||Q<=X||X!==C.mtimeMs)this.fsw._emit(gn.CHANGE,n,u);if((w$||b$||h$)&&C.ino!==u.ino){this.fsw._closeFile(I),C=u;let G=this._watchWithNodeFs(n,m);if(G)this.fsw._addPathCloser(I,G)}else C=u}catch(u){this.fsw._remove(i,$)}else if(x.has($)){let{atimeMs:u,mtimeMs:Q}=M;if(!u||u<=Q||Q!==C.mtimeMs)this.fsw._emit(gn.CHANGE,n,M);C=M}},N=this._watchWithNodeFs(n,m);if(!(l&&this.fsw.options.ignoreInitial)&&this.fsw._isntIgnored(n)){if(!this.fsw._throttle(gn.ADD,n,0))return;this.fsw._emit(gn.ADD,n,g)}return N}async _handleSymlink(n,g,l,i){if(this.fsw.closed)return;let $=n.fullPath,x=this.fsw._getWatchedDir(g);if(!this.fsw.options.followSymlinks){this.fsw._incrReadyCount();let C;try{C=await Dl(l)}catch(m){return this.fsw._emitReady(),!0}if(this.fsw.closed)return;if(x.has(i)){if(this.fsw._symlinkPaths.get($)!==C)this.fsw._symlinkPaths.set($,C),this.fsw._emit(gn.CHANGE,l,n.stats)}else x.add(i),this.fsw._symlinkPaths.set($,C),this.fsw._emit(gn.ADD,l,n.stats);return this.fsw._emitReady(),!0}if(this.fsw._symlinkPaths.has($))return!0;this.fsw._symlinkPaths.set($,!0)}_handleRead(n,g,l,i,$,x,C){if(n=L.join(n,""),C=this.fsw._throttle("readdir",n,1000),!C)return;let m=this.fsw._getWatchedDir(l.path),N=new Set,I=this.fsw._readdirp(n,{fileFilter:(M)=>l.filterPath(M),directoryFilter:(M)=>l.filterDir(M)});if(!I)return;return I.on(E$,async(M)=>{if(this.fsw.closed){I=void 0;return}let u=M.path,Q=L.join(n,u);if(N.add(u),M.stats.isSymbolicLink()&&await this._handleSymlink(M,n,Q,u))return;if(this.fsw.closed){I=void 0;return}if(u===i||!i&&!m.has(u))this.fsw._incrReadyCount(),Q=L.join($,L.relative($,Q)),this._addToNodeFs(Q,g,l,x+1)}).on(gn.ERROR,this._boundHandleError),new Promise((M,u)=>{if(!I)return u();I.once(Vl,()=>{if(this.fsw.closed){I=void 0;return}let Q=C?C.clear():!1;if(M(void 0),m.getChildren().filter((X)=>{return X!==n&&!N.has(X)}).forEach((X)=>{this.fsw._remove(n,X)}),I=void 0,Q)this._handleRead(n,!1,l,i,$,x,C)})})}async _handleDir(n,g,l,i,$,x,C){let m=this.fsw._getWatchedDir(L.dirname(n)),N=m.has(L.basename(n));if(!(l&&this.fsw.options.ignoreInitial)&&!$&&!N)this.fsw._emit(gn.ADD_DIR,n,g);m.add(L.basename(n)),this.fsw._getWatchedDir(n);let I,M,u=this.fsw.options.depth;if((u==null||i<=u)&&!this.fsw._symlinkPaths.has(C)){if(!$){if(await this._handleRead(n,l,x,$,n,i,I),this.fsw.closed)return}M=this._watchWithNodeFs(n,(Q,X)=>{if(X&&X.mtimeMs===0)return;this._handleRead(Q,!1,x,$,n,i,I)})}return M}async _addToNodeFs(n,g,l,i,$){let x=this.fsw._emitReady;if(this.fsw._isIgnored(n)||this.fsw.closed)return x(),!1;let C=this.fsw._getWatchHelpers(n);if(l)C.filterPath=(m)=>l.filterPath(m),C.filterDir=(m)=>l.filterDir(m);try{let m=await k$[C.statMethod](C.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(C.watchPath,m))return x(),!1;let N=this.fsw.options.followSymlinks,I;if(m.isDirectory()){let M=L.resolve(n),u=N?await Dl(n):n;if(this.fsw.closed)return;if(I=await this._handleDir(C.watchPath,m,g,i,$,C,u),this.fsw.closed)return;if(M!==u&&u!==void 0)this.fsw._symlinkPaths.set(M,u)}else if(m.isSymbolicLink()){let M=N?await Dl(n):n;if(this.fsw.closed)return;let u=L.dirname(C.watchPath);if(this.fsw._getWatchedDir(u).add(C.watchPath),this.fsw._emit(gn.ADD,C.watchPath,m),I=await this._handleDir(u,m,g,i,n,C,M),this.fsw.closed)return;if(M!==void 0)this.fsw._symlinkPaths.set(L.resolve(n),M)}else I=this._handleFile(C.watchPath,m,g);if(x(),I)this.fsw._addPathCloser(n,I);return!1}catch(m){if(this.fsw._handleError(m))return x(),n}}}/*! chokidar - MIT License (c) 2012 Paul Miller (paulmillr.com) */var ql="/",$x="//",$0=".",xx="..",mx="string",Cx=/\\/g,e1=/\/\//,Nx=/\..*\.(sw[px])$|~$|\.subl.*\.tmp/,Ix=/^\.[/\\]/;function dg(n){return Array.isArray(n)?n:[n]}var Ll=(n)=>typeof n==="object"&&n!==null&&!(n instanceof RegExp);function ux(n){if(typeof n==="function")return n;if(typeof n==="string")return(g)=>n===g;if(n instanceof RegExp)return(g)=>n.test(g);if(typeof n==="object"&&n!==null)return(g)=>{if(n.path===g)return!0;if(n.recursive){let l=S.relative(n.path,g);if(!l)return!1;return!l.startsWith("..")&&!S.isAbsolute(l)}return!1};return()=>!1}function Gx(n){if(typeof n!=="string")throw Error("string expected");n=S.normalize(n),n=n.replace(/\\/g,"/");let g=!1;if(n.startsWith("//"))g=!0;let l=/\/\//;while(n.match(l))n=n.replace(l,"/");if(g)n="/"+n;return n}function n0(n,g,l){let i=Gx(g);for(let $=0;$<n.length;$++){let x=n[$];if(x(i,l))return!0}return!1}function Jx(n,g){if(n==null)throw TypeError("anymatch: specify first argument");let i=dg(n).map(($)=>ux($));if(g==null)return($,x)=>{return n0(i,$,x)};return n0(i,g)}var g0=(n)=>{let g=dg(n).flat();if(!g.every((l)=>typeof l===mx))throw TypeError(`Non-string provided as watch path: ${g}`);return g.map(x0)},l0=(n)=>{let g=n.replace(Cx,ql),l=!1;if(g.startsWith($x))l=!0;while(g.match(e1))g=g.replace(e1,ql);if(l)g=ql+g;return g},x0=(n)=>l0(S.normalize(l0(n))),i0=(n="")=>(g)=>{if(typeof g==="string")return x0(S.isAbsolute(g)?g:S.join(n,g));else return g},Mx=(n,g)=>{if(S.isAbsolute(n))return n;return S.join(g,n)},jx=Object.freeze(new Set);class m0{constructor(n,g){this.path=n,this._removeWatcher=g,this.items=new Set}add(n){let{items:g}=this;if(!g)return;if(n!==$0&&n!==xx)g.add(n)}async remove(n){let{items:g}=this;if(!g)return;if(g.delete(n),g.size>0)return;let l=this.path;try{await lx(l)}catch(i){if(this._removeWatcher)this._removeWatcher(S.dirname(l),S.basename(l))}}has(n){let{items:g}=this;if(!g)return;return g.has(n)}getChildren(){let{items:n}=this;if(!n)return[];return[...n.values()]}dispose(){this.items.clear(),this.path="",this._removeWatcher=qg,this.items=jx,Object.freeze(this)}}var Qx="stat",Zx="lstat";class C0{constructor(n,g,l){this.fsw=l;let i=n;this.path=n=n.replace(Ix,""),this.watchPath=i,this.fullWatchPath=S.resolve(i),this.dirParts=[],this.dirParts.forEach(($)=>{if($.length>1)$.pop()}),this.followSymlinks=g,this.statMethod=g?Qx:Zx}entryPath(n){return S.join(this.watchPath,S.relative(this.watchPath,n.fullPath))}filterPath(n){let{stats:g}=n;if(g&&g.isSymbolicLink())return this.filterDir(n);let l=this.entryPath(n);return this.fsw._isntIgnored(l,g)&&this.fsw._hasReadPermissions(g)}filterDir(n){return this.fsw._isntIgnored(this.entryPath(n),n.stats)}}class N0 extends ix{constructor(n={}){super();this.closed=!1,this._closers=new Map,this._ignoredPaths=new Set,this._throttled=new Map,this._streams=new Set,this._symlinkPaths=new Map,this._watched=new Map,this._pendingWrites=new Map,this._pendingUnlinks=new Map,this._readyCount=0,this._readyEmitted=!1;let g=n.awaitWriteFinish,l={stabilityThreshold:2000,pollInterval:100},i={persistent:!0,ignoreInitial:!1,ignorePermissionErrors:!1,interval:100,binaryInterval:300,followSymlinks:!0,usePolling:!1,atomic:!0,...n,ignored:n.ignored?dg(n.ignored):dg([]),awaitWriteFinish:g===!0?l:typeof g==="object"?{...l,...g}:!1};if(r1)i.usePolling=!0;if(i.atomic===void 0)i.atomic=!i.usePolling;let $=process.env.CHOKIDAR_USEPOLLING;if($!==void 0){let m=$.toLowerCase();if(m==="false"||m==="0")i.usePolling=!1;else if(m==="true"||m==="1")i.usePolling=!0;else i.usePolling=!!m}let x=process.env.CHOKIDAR_INTERVAL;if(x)i.interval=Number.parseInt(x,10);let C=0;this._emitReady=()=>{if(C++,C>=this._readyCount)this._emitReady=qg,this._readyEmitted=!0,process.nextTick(()=>this.emit(B.READY))},this._emitRaw=(...m)=>this.emit(B.RAW,...m),this._boundRemove=this._remove.bind(this),this.options=i,this._nodeFsHandler=new Bl(this),Object.freeze(i)}_addIgnoredPath(n){if(Ll(n)){for(let g of this._ignoredPaths)if(Ll(g)&&g.path===n.path&&g.recursive===n.recursive)return}this._ignoredPaths.add(n)}_removeIgnoredPath(n){if(this._ignoredPaths.delete(n),typeof n==="string"){for(let g of this._ignoredPaths)if(Ll(g)&&g.path===n)this._ignoredPaths.delete(g)}}add(n,g,l){let{cwd:i}=this.options;this.closed=!1,this._closePromise=void 0;let $=g0(n);if(i)$=$.map((x)=>{return Mx(x,i)});if($.forEach((x)=>{this._removeIgnoredPath(x)}),this._userIgnored=void 0,!this._readyCount)this._readyCount=0;return this._readyCount+=$.length,Promise.all($.map(async(x)=>{let C=await this._nodeFsHandler._addToNodeFs(x,!l,void 0,0,g);if(C)this._emitReady();return C})).then((x)=>{if(this.closed)return;x.forEach((C)=>{if(C)this.add(S.dirname(C),S.basename(g||C))})}),this}unwatch(n){if(this.closed)return this;let g=g0(n),{cwd:l}=this.options;return g.forEach((i)=>{if(!S.isAbsolute(i)&&!this._closers.has(i)){if(l)i=S.join(l,i);i=S.resolve(i)}if(this._closePath(i),this._addIgnoredPath(i),this._watched.has(i))this._addIgnoredPath({path:i,recursive:!0});this._userIgnored=void 0}),this}close(){if(this._closePromise)return this._closePromise;this.closed=!0,this.removeAllListeners();let n=[];return this._closers.forEach((g)=>g.forEach((l)=>{let i=l();if(i instanceof Promise)n.push(i)})),this._streams.forEach((g)=>g.destroy()),this._userIgnored=void 0,this._readyCount=0,this._readyEmitted=!1,this._watched.forEach((g)=>g.dispose()),this._closers.clear(),this._watched.clear(),this._streams.clear(),this._symlinkPaths.clear(),this._throttled.clear(),this._closePromise=n.length?Promise.all(n).then(()=>{return}):Promise.resolve(),this._closePromise}getWatched(){let n={};return this._watched.forEach((g,l)=>{let $=(this.options.cwd?S.relative(this.options.cwd,l):l)||$0;n[$]=g.getChildren().sort()}),n}emitWithAll(n,g){if(this.emit(n,...g),n!==B.ERROR)this.emit(B.ALL,n,...g)}async _emit(n,g,l){if(this.closed)return;let i=this.options;if(Tl)g=S.normalize(g);if(i.cwd)g=S.relative(i.cwd,g);let $=[g];if(l!=null)$.push(l);let x=i.awaitWriteFinish,C;if(x&&(C=this._pendingWrites.get(g)))return C.lastChange=new Date,this;if(i.atomic){if(n===B.UNLINK)return this._pendingUnlinks.set(g,[n,...$]),setTimeout(()=>{this._pendingUnlinks.forEach((m,N)=>{this.emit(...m),this.emit(B.ALL,...m),this._pendingUnlinks.delete(N)})},typeof i.atomic==="number"?i.atomic:100),this;if(n===B.ADD&&this._pendingUnlinks.has(g))n=B.CHANGE,this._pendingUnlinks.delete(g)}if(x&&(n===B.ADD||n===B.CHANGE)&&this._readyEmitted){let m=(N,I)=>{if(N)n=B.ERROR,$[0]=N,this.emitWithAll(n,$);else if(I){if($.length>1)$[1]=I;else $.push(I);this.emitWithAll(n,$)}};return this._awaitWriteFinish(g,x.stabilityThreshold,n,m),this}if(n===B.CHANGE){if(!this._throttle(B.CHANGE,g,50))return this}if(i.alwaysStat&&l===void 0&&(n===B.ADD||n===B.ADD_DIR||n===B.CHANGE)){let m=i.cwd?S.join(i.cwd,g):g,N;try{N=await gx(m)}catch(I){}if(!N||this.closed)return;$.push(N)}return this.emitWithAll(n,$),this}_handleError(n){let g=n&&n.code;if(n&&g!=="ENOENT"&&g!=="ENOTDIR"&&(!this.options.ignorePermissionErrors||g!=="EPERM"&&g!=="EACCES"))this.emit(B.ERROR,n);return n||this.closed}_throttle(n,g,l){if(!this._throttled.has(n))this._throttled.set(n,new Map);let i=this._throttled.get(n);if(!i)throw Error("invalid throttle");let $=i.get(g);if($)return $.count++,!1;let x,C=()=>{let N=i.get(g),I=N?N.count:0;if(i.delete(g),clearTimeout(x),N)clearTimeout(N.timeoutObject);return I};x=setTimeout(C,l);let m={timeoutObject:x,clear:C,count:0};return i.set(g,m),m}_incrReadyCount(){return this._readyCount++}_awaitWriteFinish(n,g,l,i){let $=this.options.awaitWriteFinish;if(typeof $!=="object")return;let x=$.pollInterval,C,m=n;if(this.options.cwd&&!S.isAbsolute(n))m=S.join(this.options.cwd,n);let N=new Date,I=this._pendingWrites;function M(u){nx(m,(Q,X)=>{if(Q||!I.has(n)){if(Q&&Q.code!=="ENOENT")i(Q);return}let G=Number(new Date);if(u&&X.size!==u.size)I.get(n).lastChange=G;let J=I.get(n);if(G-J.lastChange>=g)I.delete(n),i(void 0,X);else C=setTimeout(M,x,X)})}if(!I.has(n))I.set(n,{lastChange:N,cancelWait:()=>{return I.delete(n),clearTimeout(C),l}}),C=setTimeout(M,x)}_isIgnored(n,g){if(this.options.atomic&&Nx.test(n))return!0;if(!this._userIgnored){let{cwd:l}=this.options,$=(this.options.ignored||[]).map(i0(l)),C=[...[...this._ignoredPaths].map(i0(l)),...$];this._userIgnored=Jx(C,void 0)}return this._userIgnored(n,g)}_isntIgnored(n,g){return!this._isIgnored(n,g)}_getWatchHelpers(n){return new C0(n,this.options.followSymlinks,this)}_getWatchedDir(n){let g=S.resolve(n);if(!this._watched.has(g))this._watched.set(g,new m0(g,this._boundRemove));return this._watched.get(g)}_hasReadPermissions(n){if(this.options.ignorePermissionErrors)return!0;return Boolean(Number(n.mode)&256)}_remove(n,g,l){let i=S.join(n,g),$=S.resolve(i);if(l=l!=null?l:this._watched.has(i)||this._watched.has($),!this._throttle("remove",i,100))return;if(!l&&this._watched.size===1)this.add(n,g,!0);this._getWatchedDir(i).getChildren().forEach((u)=>this._remove(i,u));let m=this._getWatchedDir(n),N=m.has(g);if(m.remove(g),this._symlinkPaths.has($))this._symlinkPaths.delete($);let I=i;if(this.options.cwd)I=S.relative(this.options.cwd,i);if(this.options.awaitWriteFinish&&this._pendingWrites.has(I)){if(this._pendingWrites.get(I).cancelWait()===B.ADD)return}this._watched.delete(i),this._watched.delete($);let M=l?B.UNLINK_DIR:B.UNLINK;if(N&&!this._isIgnored(i))this._emit(M,i);this._closePath(i)}_closePath(n){this._closeFile(n);let g=S.dirname(n);this._getWatchedDir(g).remove(S.basename(n))}_closeFile(n){let g=this._closers.get(n);if(!g)return;g.forEach((l)=>l()),this._closers.delete(n)}_addPathCloser(n,g){if(!g)return;let l=this._closers.get(n);if(!l)l=[],this._closers.set(n,l);l.push(g)}_readdirp(n,g){if(this.closed)return;let l={type:B.ALL,alwaysStat:!0,lstat:!0,...g,depth:0},i=s1(n,l);return this._streams.add(i),i.once(a1,()=>{i=void 0}),i.once(Vl,()=>{if(i)this._streams.delete(i),i=void 0}),i}}function _g(n,g={}){let l=new N0(g);return l.add(n),l}import{createServer as v2}from"node:http";import{readFileSync as W2,existsSync as c2,readdirSync as xg,statSync as tl,mkdirSync as E2}from"node:fs";import{join as $n,basename as Ji}from"node:path";var P2=o(ii(),1),F2=o(vl(),1),y2=o(cl(),1),pl=o(sg(),1),ol=o(ui(),1);var pg=o(qn(),1),Gi=process.env.DASHBOARD_PORT?parseInt(process.env.DASHBOARD_PORT):9847;function w2(){if(process.env.MEMORIES_DIR)return process.env.MEMORIES_DIR;let n=process.argv[3];if(n)return $n(n,".serena","memories");return $n(process.cwd(),".serena","memories")}function mg(n){try{return W2(n,"utf-8")}catch{return""}}function b2(n){try{let g=xg(n);if(g.includes("orchestrator-session.md"))return $n(n,"orchestrator-session.md");let l=g.filter((i)=>/^session-.*\.md$/.test(i)).map((i)=>({name:i,mtime:tl($n(n,i)).mtimeMs})).sort((i,$)=>$.mtime-i.mtime);if(l.length>0)return $n(n,l[0].name)}catch{}return null}function h2(n){let g=b2(n);if(!g)return{id:"N/A",status:"UNKNOWN"};let l=mg(g);if(!l)return{id:"N/A",status:"UNKNOWN"};let i=(l.match(/session-id:\s*(.+)/i)||[])[1]||(l.match(/# Session:\s*(.+)/i)||[])[1]||l.match(/(session-\d{8}-\d{6})/)?.[1]||Ji(g,".md")||"N/A",$="UNKNOWN";if(/IN PROGRESS|RUNNING|## Active|\[IN PROGRESS\]/i.test(l))$="RUNNING";else if(/COMPLETED|DONE|## Completed|\[COMPLETED\]/i.test(l))$="COMPLETED";else if(/FAILED|ERROR|## Failed|\[FAILED\]/i.test(l))$="FAILED";else if(/Step \d+:.*\[/i.test(l))$="RUNNING";return{id:i.trim(),status:$}}function s2(n){let g=mg($n(n,"task-board.md"));if(!g)return[];let l=[],i=g.split(`
`);for(let $ of i){if(!$.startsWith("|")||/^\|\s*-+/.test($))continue;let x=$.split("|").map((C)=>C.trim()).filter(Boolean);if(x.length<2||/^agent$/i.test(x[0]))continue;l.push({agent:x[0]||"",status:x[1]||"pending",task:x[2]||""})}return l}function rl(n,g){try{let l=xg(n).filter((x)=>x.startsWith(`progress-${g}`)&&x.endsWith(".md")).sort().reverse();if(l.length===0)return null;let $=mg($n(n,l[0])).match(/turn[:\s]*(\d+)/i);return $?parseInt($[1],10):null}catch{return null}}function k2(n){try{return xg(n).filter((l)=>l.endsWith(".md")&&l!==".gitkeep").map((l)=>({name:l,mtime:tl($n(n,l)).mtimeMs})).sort((l,i)=>i.mtime-l.mtime).slice(0,10).map((l)=>{let i=l.name.replace(/^(progress|result|session|debug|task)-?/,"").replace(/[-_]agent/,"").replace(/[-_]completion/,"").replace(/\.md$/,"").replace(/[-_]/g," ").trim()||l.name.replace(/\.md$/,""),x=mg($n(n,l.name)).split(`
`).map((m)=>m.trim()).filter((m)=>m&&!m.startsWith("---")&&m.length>3),C="";for(let m=x.length-1;m>=0;m--){let N=x[m];if(/^\*\*|^#+|^-|^\d+\.|Status|Result|Action|Step/i.test(N)){if(C=N.replace(/^[#*\-\d.]+\s*/,"").replace(/\*\*/g,"").trim(),C.length>5)break}}if(C.length>80)C=C.substring(0,77)+"...";return{agent:i,message:C,file:l.name}}).filter((l)=>l.message)}catch{return[]}}function p2(n){let g=[],l=new Set;try{let i=xg(n).filter(($)=>$.endsWith(".md")&&$!==".gitkeep").map(($)=>({name:$,mtime:tl($n(n,$)).mtimeMs})).sort(($,x)=>x.mtime-$.mtime);for(let $ of i){let x=mg($n(n,$.name)),C=x.match(/\*\*Agent\*\*:\s*(.+)/i)||x.match(/Agent:\s*(.+)/i)||x.match(/^#+\s*(.+?)\s*Agent/im),m=null;if(C)m=C[1].trim();else if(/_agent|agent_|-agent/i.test($.name))m=$.name.replace(/\.md$/,"").replace(/[-_]completion|[-_]progress|[-_]result/gi,"").replace(/[-_]/g," ").trim();if(m&&!l.has(m.toLowerCase())){l.add(m.toLowerCase());let N="unknown";if(/\[COMPLETED\]|## Completed|## Results/i.test(x))N="completed";else if(/\[IN PROGRESS\]|## Progress|IN PROGRESS/i.test(x))N="running";else if(/\[FAILED\]|## Failed|ERROR/i.test(x))N="failed";let I=x.match(/## Task\s*\n+(.+)/i)||x.match(/\*\*Task\*\*:\s*(.+)/i),M=I?I[1].trim().substring(0,60):"";g.push({agent:m,status:N,task:M,turn:rl(n,m)})}}}catch{}return g}function al(n){let g=h2(n),i=s2(n).map(($)=>({...$,turn:rl(n,$.agent)}));if(i.length===0)i=p2(n);if(i.length===0)try{let $=xg(n).filter((x)=>x.startsWith("progress-")&&x.endsWith(".md"));for(let x of $){let C=x.replace(/^progress-/,"").replace(/\.md$/,"");i.push({agent:C,status:"running",task:"",turn:rl(n,C)})}}catch{}return{session:g,agents:i,activity:k2(n),memoriesDir:n,updatedAt:new Date().toISOString()}}var o2=`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Serena Memory Dashboard</title>
  <style>
    :root { --bg:#0f0b1a;--surface:#1a1428;--surface-2:#241e33;--border:#3d2e5c;--purple:#9b59b6;--purple-light:#c39bd3;--purple-dark:#6c3483;--text:#e8e0f0;--text-dim:#8a7da0;--green:#2ecc71;--red:#e74c3c;--yellow:#f1c40f;--cyan:#1abc9c; }
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:var(--bg);color:var(--text);font-family:'SF Mono','Fira Code',monospace;min-height:100vh;padding:24px}
    .header{display:flex;align-items:center;gap:16px;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid var(--border)}
    .logo{width:48px;height:48px;background:linear-gradient(135deg,var(--purple),var(--purple-dark));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:bold;color:white}
    .header-text h1{font-size:20px;color:var(--purple-light)} .header-text .subtitle{font-size:12px;color:var(--text-dim)}
    .connection-badge{margin-left:auto;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:600}
    .connection-badge.connected{background:rgba(46,204,113,0.15);color:var(--green);border:1px solid rgba(46,204,113,0.3)}
    .connection-badge.disconnected{background:rgba(231,76,60,0.15);color:var(--red);border:1px solid rgba(231,76,60,0.3)}
    .connection-badge.connecting{background:rgba(241,196,15,0.15);color:var(--yellow);border:1px solid rgba(241,196,15,0.3)}
    .session-bar{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:16px 20px;margin-bottom:20px;display:flex;align-items:center;gap:20px}
    .session-id{font-size:14px;font-weight:600}
    .session-status{padding:3px 10px;border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px}
    .session-status.running{background:rgba(46,204,113,0.15);color:var(--green)}
    .session-status.completed{background:rgba(26,188,156,0.15);color:var(--cyan)}
    .session-status.failed{background:rgba(231,76,60,0.15);color:var(--red)}
    .session-status.unknown{background:rgba(138,125,160,0.15);color:var(--text-dim)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px} @media(max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:hidden}
    .card-header{padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:var(--purple-light);background:var(--surface-2)}
    .card-body{padding:16px}
    .agent-table{width:100%;border-collapse:collapse;font-size:13px}
    .agent-table th{text-align:left;padding:8px 12px;color:var(--text-dim);font-weight:500;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid var(--border)}
    .agent-table td{padding:10px 12px;border-bottom:1px solid rgba(61,46,92,0.4)} .agent-table tr:last-child td{border-bottom:none}
    .status-dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:6px}
    .status-dot.running{background:var(--green);box-shadow:0 0 6px var(--green)} .status-dot.completed{background:var(--cyan)} .status-dot.failed{background:var(--red)} .status-dot.blocked{background:var(--yellow)} .status-dot.pending{background:var(--text-dim)}
    .activity-list{list-style:none;font-size:12px} .activity-list li{padding:8px 0;border-bottom:1px solid rgba(61,46,92,0.3);display:flex;gap:8px} .activity-list li:last-child{border-bottom:none}
    .activity-agent{color:var(--purple-light);font-weight:600;white-space:nowrap} .activity-msg{color:var(--text-dim)}
    .empty{color:var(--text-dim);font-size:12px;font-style:italic;padding:12px 0}
    .footer{margin-top:20px;padding-top:12px;border-top:1px solid var(--border);display:flex;justify-content:space-between;font-size:11px;color:var(--text-dim)}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}} .pulse{animation:pulse 2s ease-in-out infinite}
  </style>
</head>
<body>
  <div class="header"><div class="logo">S</div><div class="header-text"><h1>Serena Memory Dashboard</h1><div class="subtitle">Real-time agent orchestration monitor</div></div><div class="connection-badge connecting" id="connBadge">Connecting...</div></div>
  <div class="session-bar"><span>Session:</span><span class="session-id" id="sessionId">N/A</span><span class="session-status unknown" id="sessionStatus">UNKNOWN</span><span style="margin-left:auto;font-size:11px;color:var(--text-dim)" id="updatedAt">--</span></div>
  <div class="grid"><div class="card"><div class="card-header">Agent Status</div><div class="card-body"><table class="agent-table"><thead><tr><th>Agent</th><th>Status</th><th>Turn</th><th>Task</th></tr></thead><tbody id="agentBody"><tr><td colspan="4" class="empty">No agents detected yet</td></tr></tbody></table></div></div><div class="card"><div class="card-header">Latest Activity</div><div class="card-body"><ul class="activity-list" id="activityList"><li class="empty">No activity yet</li></ul></div></div></div>
  <div class="footer"><span>Serena Memory Dashboard</span><span id="footerTime">--</span></div>
  <script>
    const $=s=>document.querySelector(s);
    function normalizeStatus(s){const l=(s||'').toLowerCase();if(['running','active','in_progress','in-progress'].includes(l))return'running';if(['completed','done','finished'].includes(l))return'completed';if(['failed','error'].includes(l))return'failed';if(['blocked','waiting'].includes(l))return'blocked';return'pending'}
    function clearChildren(el){while(el.firstChild)el.removeChild(el.firstChild)}
    function createTextEl(tag,text,cls){const el=document.createElement(tag);el.textContent=text;if(cls)el.className=cls;return el}
    function renderAgents(agents){const tbody=$('#agentBody');clearChildren(tbody);if(!agents||!agents.length){const tr=document.createElement('tr'),td=createTextEl('td','No agents detected yet','empty');td.setAttribute('colspan','4');tr.appendChild(td);tbody.appendChild(tr);return}agents.forEach(a=>{const ns=normalizeStatus(a.status),tr=document.createElement('tr');tr.appendChild(createTextEl('td',a.agent));const std=document.createElement('td'),dot=document.createElement('span');dot.className='status-dot '+ns+(ns==='running'?' pulse':'');std.appendChild(dot);std.appendChild(createTextEl('span',ns,'status-text'));tr.appendChild(std);tr.appendChild(createTextEl('td',a.turn!=null?String(a.turn):'-'));tr.appendChild(createTextEl('td',a.task||''));tbody.appendChild(tr)})}
    function renderActivity(activity){const list=$('#activityList');clearChildren(list);if(!activity||!activity.length){list.appendChild(createTextEl('li','No activity yet','empty'));return}activity.forEach(a=>{const li=document.createElement('li');li.appendChild(createTextEl('span','['+a.agent+']','activity-agent'));li.appendChild(createTextEl('span',a.message,'activity-msg'));list.appendChild(li)})}
    function renderState(state){$('#sessionId').textContent=state.session?.id||'N/A';const st=(state.session?.status||'UNKNOWN').toUpperCase(),sel=$('#sessionStatus');sel.textContent=st;sel.className='session-status '+st.toLowerCase();if(state.updatedAt){const ts=new Date(state.updatedAt).toLocaleString();$('#updatedAt').textContent='Updated: '+ts;$('#footerTime').textContent=ts}renderAgents(state.agents);renderActivity(state.activity)}
    let ws,rd=1000;function connect(){const b=$('#connBadge');b.textContent='Connecting...';b.className='connection-badge connecting';const p=location.protocol==='https:'?'wss:':'ws:';ws=new WebSocket(p+'//'+location.host);ws.onopen=()=>{b.textContent='Connected';b.className='connection-badge connected';rd=1000};ws.onmessage=e=>{try{const m=JSON.parse(e.data);if(m.data)renderState(m.data)}catch{}};ws.onclose=()=>{b.textContent='Disconnected';b.className='connection-badge disconnected';setTimeout(()=>{rd=Math.min(rd*1.5,10000);connect()},rd)};ws.onerror=()=>ws.close()}
    fetch('/api/state').then(r=>r.json()).then(renderState).catch(()=>{});connect();
  </script>
</body>
</html>`;function Mi(){let n=w2();if(!c2(n))E2(n,{recursive:!0});let g=v2((C,m)=>{if(C.url==="/api/state")m.writeHead(200,{"Content-Type":"application/json"}),m.end(JSON.stringify(al(n)));else m.writeHead(200,{"Content-Type":"text/html"}),m.end(o2)}),l=new ol.default({server:g}),i=null;function $(C,m){if(i)clearTimeout(i);i=setTimeout(()=>{let N=JSON.stringify({type:"update",event:C,file:m,data:al(n)});l.clients.forEach((I)=>{if(I.readyState===pl.default.OPEN)I.send(N)})},100)}let x=_g(n,{persistent:!0,ignoreInitial:!0,awaitWriteFinish:{stabilityThreshold:200,pollInterval:50}});x.on("all",(C,m)=>$(C,Ji(m))),l.on("connection",(C)=>{C.send(JSON.stringify({type:"full",data:al(n)})),C.on("error",()=>C.terminate())}),process.on("SIGINT",()=>{console.log(`
Shutting down...`),x.close(),l.clients.forEach((C)=>C.terminate()),l.close(()=>g.close(()=>process.exit(0))),setTimeout(()=>process.exit(1),3000).unref()}),process.on("SIGTERM",()=>process.emit("SIGINT")),g.listen(Gi,()=>{console.log(pg.default.magenta(`
  \uD83D\uDEF8 Serena Memory Dashboard`)),console.log(pg.default.white(`     http://localhost:${Gi}`)),console.log(pg.default.dim(`     Watching: ${n}
`))})}var c=o(qn(),1);import{readFileSync as a2,existsSync as r2,readdirSync as Cg,statSync as n1,mkdirSync as t2}from"node:fs";import{join as xn,basename as e2}from"node:path";var nm="",gm="",lm="",im="",$m="";function xm(){if(process.env.MEMORIES_DIR)return process.env.MEMORIES_DIR;let n=process.argv[3];if(n)return xn(n,".serena","memories");return xn(process.cwd(),".serena","memories")}function Ng(n){try{return a2(n,"utf-8")}catch{return""}}function mm(n){try{let g=Cg(n);if(g.includes("orchestrator-session.md"))return xn(n,"orchestrator-session.md");let l=g.filter((i)=>/^session-.*\.md$/.test(i)).map((i)=>({name:i,mtime:n1(xn(n,i)).mtimeMs})).sort((i,$)=>$.mtime-i.mtime);if(l.length>0&&l[0])return xn(n,l[0].name)}catch{}return null}function Cm(n){let g=mm(n);if(!g)return{id:"N/A",status:"UNKNOWN"};let l=Ng(g);if(!l)return{id:"N/A",status:"UNKNOWN"};let i=(l.match(/session-id:\s*(.+)/i)||[])[1]||(l.match(/# Session:\s*(.+)/i)||[])[1]||l.match(/(session-\d{8}-\d{6})/)?.[1]||e2(g,".md"),$="UNKNOWN";if(/IN PROGRESS|RUNNING|## Active|\[IN PROGRESS\]/i.test(l))$="RUNNING";else if(/COMPLETED|DONE|## Completed|\[COMPLETED\]/i.test(l))$="COMPLETED";else if(/FAILED|ERROR|## Failed|\[FAILED\]/i.test(l))$="FAILED";else if(/Step \d+:.*\[/i.test(l))$="RUNNING";return{id:(i||"N/A").trim(),status:$}}function Nm(n){let g=Ng(xn(n,"task-board.md"));if(!g)return[];let l=[],i=g.split(`
`);for(let $ of i){if(!$.startsWith("|")||/^\|\s*-+/.test($))continue;let x=$.split("|").map((I)=>I.trim()).filter(Boolean),C=x[0];if(x.length<2||!C||/^agent$/i.test(C))continue;let m=x[1],N=x[2];l.push({agent:C,status:m||"pending",task:N||""})}return l}function el(n,g){try{let l=Cg(n).filter((x)=>x.startsWith(`progress-${g}`)&&x.endsWith(".md")).sort().reverse();if(l.length===0||!l[0])return null;let $=Ng(xn(n,l[0])).match(/turn[:\s]*(\d+)/i);return $&&$[1]?parseInt($[1],10):null}catch{return null}}function Im(n){try{let g=Cg(n).filter((i)=>i.endsWith(".md")&&i!==".gitkeep").map((i)=>({name:i,mtime:n1(xn(n,i)).mtimeMs})).sort((i,$)=>$.mtime-i.mtime).slice(0,5),l=[];for(let i of g){let $=i.name.replace(/^(progress|result|session|debug|task)-?/,"").replace(/[-_]agent/,"").replace(/[-_]completion/,"").replace(/\.md$/,"").replace(/[-_]/g," ").trim()||i.name.replace(/\.md$/,""),C=Ng(xn(n,i.name)).split(`
`).map((N)=>N.trim()).filter((N)=>N&&!N.startsWith("---")&&N.length>3),m="";for(let N=C.length-1;N>=0;N--){let I=C[N];if(!I)continue;if(/^\*\*|^#+|^-|^\d+\.|Status|Result|Action|Step/i.test(I)){if(m=I.replace(/^[#*\-\d.]+\s*/,"").replace(/\*\*/g,"").trim(),m.length>5)break}}if(m.length>52)m=m.substring(0,49)+"...";if(m)l.push({agent:$,message:m})}return l}catch{return[]}}function um(n){let g=[],l=new Set;try{let i=Cg(n).filter(($)=>$.endsWith(".md")&&$!==".gitkeep").map(($)=>({name:$,mtime:n1(xn(n,$)).mtimeMs})).sort(($,x)=>x.mtime-$.mtime);for(let $ of i){let x=Ng(xn(n,$.name)),C=x.match(/\*\*Agent\*\*:\s*(.+)/i)||x.match(/Agent:\s*(.+)/i)||x.match(/^#+\s*(.+?)\s*Agent/im),m=null;if(C&&C[1])m=C[1].trim();else if(/_agent|agent_|-agent/i.test($.name))m=$.name.replace(/\.md$/,"").replace(/[-_]completion|[-_]progress|[-_]result/gi,"").replace(/[-_]/g," ").trim();if(m&&!l.has(m.toLowerCase())){l.add(m.toLowerCase());let N="unknown";if(/\[COMPLETED\]|## Completed|## Results/i.test(x))N="completed";else if(/\[IN PROGRESS\]|## Progress|IN PROGRESS/i.test(x))N="running";else if(/\[FAILED\]|## Failed|ERROR/i.test(x))N="failed";let I=x.match(/## Task\s*\n+(.+)/i)||x.match(/\*\*Task\*\*:\s*(.+)/i),M=I&&I[1]?I[1].trim().substring(0,20):"";g.push({agent:m,status:N,task:M,turn:el(n,m)})}}}catch{}return g}function Gm(n){let g=n.toLowerCase();if(["running","active","in_progress","in-progress"].includes(g))return`${c.default.green(nm)} running`;else if(["completed","done","finished"].includes(g))return`${c.default.cyan(gm)} completed`;else if(["failed","error"].includes(g))return`${c.default.red(lm)} failed`;else if(["blocked","waiting"].includes(g))return`${c.default.yellow(im)} blocked`;return`${c.default.dim($m)} pending`}function ji(n){console.clear();let g=Cm(n),i=Nm(n).map((J)=>({...J,turn:el(n,J.agent)}));if(i.length===0)i=um(n);if(i.length===0)try{let J=Cg(n).filter((K)=>K.startsWith("progress-")&&K.endsWith(".md"));for(let K of J){let z=K.replace(/^progress-/,"").replace(/\.md$/,"");i.push({agent:z,status:"running",task:"",turn:el(n,z)})}}catch{}let $=56,x="".repeat($),C=(J)=>" ".repeat(Math.max(0,J)),m=(J)=>c.default.magenta(J),N=(J)=>c.default.bold(J),I=(J)=>c.default.dim(J),M=c.default.yellow;if(g.status==="RUNNING")M=c.default.green;else if(g.status==="COMPLETED")M=c.default.cyan;else if(g.status==="FAILED")M=c.default.red;console.log(`${m(""+x+"")}`),console.log(`${m("")}  ${N(m("Serena Memory Dashboard"))}${C($-25)}${m("")}`);let u=`Session: ${N(g.id.padEnd(20))} [${M(g.status)}]`;if(console.log(`${m("")}  ${u}${C($-4-u.length-9)}${m("")}`),console.log(`${m(""+x+"")}`),console.log(`${m("")}  ${N("Agent".padEnd(12)+" "+"Status".padEnd(12)+" "+"Turn".padEnd(6)+" "+"Task".padEnd(20))}  ${m("")}`),console.log(`${m("")}  ${I("".padEnd(12)+" "+"".padEnd(12)+" "+"".padEnd(6)+" "+"".padEnd(20))}  ${m("")}`),i.length===0)console.log(`${m("")}  ${I("No agents detected yet"+C(32))}${m("")}`);else for(let J of i){let K=Gm(J.status),z=J.turn!=null?String(J.turn):"-",O=J.task.substring(0,20);console.log(`${m("")}  ${J.agent.padEnd(12)} ${K.padEnd(22)} ${z.padEnd(6)} ${O.padEnd(20)}${m("")}`)}console.log(`${m(""+x+"")}`),console.log(`${m("")}  ${N("Latest Activity:")}${C($-18)}${m("")}`);let Q=Im(n);if(Q.length===0)console.log(`${m("")}  ${I("No activity yet"+C(38))}${m("")}`);else for(let J of Q){let K=`[${J.agent}] ${J.message}`;console.log(`${m("")}  ${I(K.substring(0,52).padEnd(52))}${m("")}`)}console.log(`${m(""+x+"")}`);let G=`Updated: ${new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}  |  Ctrl+C to exit`;console.log(`${m("")}  ${I(G)}${C($-4-G.length)}${m("")}`),console.log(`${m(""+x+"")}`)}function Qi(){let n=xm();if(!r2(n))t2(n,{recursive:!0}),console.log(c.default.yellow(`Created ${n}  waiting for memory files...`));console.log(c.default.magenta(`
  \uD83D\uDEF8 Serena Terminal Dashboard`)),console.log(c.default.dim(`     Watching: ${n}
`)),ji(n);let g=_g(n,{persistent:!0,ignoreInitial:!0,awaitWriteFinish:{stabilityThreshold:200,pollInterval:50}});g.on("all",()=>ji(n)),process.on("SIGINT",()=>{console.log(`
`),g.close(),process.exit(0)}),process.on("SIGTERM",()=>process.emit("SIGINT"))}var mn=process.argv.slice(2),g1=mn.includes("--json"),Mm=mn.includes("--reset");if(mn[0]==="dashboard")Qi();else if(mn[0]==="dashboard:web")Mi();else if(mn[0]==="update")Om().catch(console.error);else if(mn[0]==="doctor")Hm(g1).catch(console.error);else if(mn[0]==="stats")Tm(g1,Mm).catch(console.error);else if(mn[0]==="retro")_m(g1).catch(console.error);else if(mn[0]==="help"||mn[0]==="--help"||mn[0]==="-h")Pm();else Fm().catch(console.error);var $1="first-fluke/oh-my-ag",x1=`https://raw.githubusercontent.com/${$1}/main/.agent/skills`,b={domain:[{name:"frontend-agent",desc:"React/Next.js UI specialist"},{name:"backend-agent",desc:"FastAPI/SQLAlchemy API specialist"},{name:"mobile-agent",desc:"Flutter/Dart mobile specialist"}],coordination:[{name:"pm-agent",desc:"Product manager - task decomposition"},{name:"qa-agent",desc:"QA - OWASP, Lighthouse, WCAG"},{name:"workflow-guide",desc:"Manual multi-agent orchestration"},{name:"orchestrator",desc:"Automated parallel CLI execution"}],utility:[{name:"debug-agent",desc:"Bug fixing specialist"},{name:"commit",desc:"Conventional Commits helper"}]},jm={fullstack:["frontend-agent","backend-agent","pm-agent","qa-agent","debug-agent","commit"],frontend:["frontend-agent","pm-agent","qa-agent","debug-agent","commit"],backend:["backend-agent","pm-agent","qa-agent","debug-agent","commit"],mobile:["mobile-agent","pm-agent","qa-agent","debug-agent","commit"],all:[...b.domain,...b.coordination,...b.utility].map((n)=>n.name)};async function Qm(n){let g=["SKILL.md"],l=["resources/execution-protocol.md","resources/tech-stack.md","resources/checklist.md","resources/templates.md","resources/error-playbook.md"];for(let i of l){let $=`${x1}/${n}/${i}`;if((await fetch($,{method:"HEAD"})).ok)g.push(i)}return g}async function Zi(n,g){let l=P(g,".agent","skills",n),i=await Qm(n);for(let $ of i){let x=`${x1}/${n}/${$}`,C=await fetch(x);if(!C.ok)continue;let m=await C.text(),N=P(l,$),I=rg(N);if(!y(I))En(I,{recursive:!0});Bn(N,m,"utf-8")}return!0}function Zm(n){return Jm("sha256").update(n,"utf-8").digest("hex")}async function Xm(n){let g=P(n,".agent","skills","_version.json");if(!y(g))return null;try{let l=ag(g,"utf-8");return JSON.parse(l).version||null}catch{return null}}async function zm(n,g){let l=P(n,".agent","skills","_version.json"),i=rg(l);if(!y(i))En(i,{recursive:!0});Bn(l,JSON.stringify({version:g},null,2),"utf-8")}async function Km(){let n=`https://raw.githubusercontent.com/${$1}/main/prompt-manifest.json`,g=await fetch(n);if(!g.ok)throw Error("Failed to fetch remote manifest");return await g.json()}async function Rm(n){let g=`https://raw.githubusercontent.com/${$1}/main/${n.path}`,l=await fetch(g);if(!l.ok)return{path:n.path,success:!1,error:`HTTP ${l.status}`};let i=await l.text();if(Zm(i)!==n.sha256)return{path:n.path,success:!1,error:"SHA256 mismatch"};let x=P(process.cwd(),n.path),C=rg(x);if(!y(C))En(C,{recursive:!0});return Bn(x,i,"utf-8"),{path:n.path,success:!0}}async function Om(){console.clear(),Ln(Z.default.bgMagenta(Z.default.white(" \uD83D\uDEF8 oh-my-ag update ")));let n=process.cwd(),g=Dg();try{g.start("Checking for updates...");let l=await Km(),i=await Xm(n);if(i===l.version){g.stop(Z.default.green("Already up to date!")),Nn(`Current version: ${Z.default.cyan(i)}`);return}g.message(`Updating from ${i||"not installed"} to ${Z.default.cyan(l.version)}...`);let $=await fl(l.files,async(m)=>Rm(m),{concurrency:10}),x=$.filter((m)=>!m.success);if(x.length>0)g.stop("Update completed with errors"),_(x.map((m)=>`${Z.default.red("")} ${m.path}: ${m.error}`).join(`
`),`${x.length} files failed`);else g.stop(`Updated to version ${Z.default.cyan(l.version)}!`);await zm(n,l.version);let C=$.length-x.length;Nn(x.length>0?`${C} files updated, ${x.length} failed`:`${C} files updated successfully`)}catch(l){g.stop("Update failed"),nn.error(l instanceof Error?l.message:String(l)),process.exit(1)}}async function Xi(n){let g=P(n,".agent","skills","_shared"),l=["reasoning-templates.md","clarification-protocol.md","context-loading.md","skill-routing.md"];if(!y(g))En(g,{recursive:!0});for(let i of l){let $=`${x1}/_shared/${i}`,x=await fetch($);if(!x.ok)continue;let C=await x.text();Bn(P(g,i),C,"utf-8")}}async function og(n,g,l){try{let i=Ig(`${g} --version`,{encoding:"utf-8",stdio:["pipe","pipe","ignore"]}).trim();return{name:n,installed:!0,version:i,installCmd:l}}catch{return{name:n,installed:!1,installCmd:l}}}async function Ym(n){let g=process.env.HOME||process.env.USERPROFILE||"",i={gemini:{path:`${g}/.gemini/settings.json`,type:"json"},claude:{path:`${g}/.claude.json`,type:"json"},codex:{path:`${g}/.codex/config.toml`,type:"toml"}}[n];if(!i)return{configured:!1};if(y(i.path))try{let $=ag(i.path,"utf-8");if(i.type==="json"){let x=JSON.parse($);return{configured:!!(x.mcpServers||x.mcp),path:i.path}}return{configured:!0,path:i.path}}catch{return{configured:!1}}return{configured:!1}}async function Am(){let n=[];try{Ig("which fswatch",{stdio:"ignore"}),n.push({name:"fswatch",available:!0,type:"terminal"})}catch{n.push({name:"fswatch",available:!1,type:"terminal",installCmd:"brew install fswatch (macOS) or apt install inotify-tools (Linux)"})}let g=P(process.cwd(),"scripts","dashboard-web","server.js");if(y(g))try{let l=P(process.cwd(),"node_modules"),i=y(P(l,"chokidar")),$=y(P(l,"ws"));if(i&&$)n.push({name:"chokidar + ws",available:!0,type:"web"});else n.push({name:"chokidar + ws",available:!1,type:"web",installCmd:"npm install"})}catch{n.push({name:"chokidar + ws",available:!1,type:"web",installCmd:"npm install"})}return n}async function fm(){let n=P(process.cwd(),".agent","skills");if(!y(n))return[];let g=[...b.domain,...b.coordination,...b.utility],l=[];for(let i of g){let $=P(n,i.name),x=P($,"SKILL.md");l.push({name:i.name,installed:y($),hasSkillMd:y(x)})}return l}async function Hm(n=!1){let g=process.cwd(),l=await Promise.all([og("gemini","gemini","npm install -g @anthropic-ai/gemini-cli"),og("claude","claude","npm install -g @anthropic-ai/claude-code"),og("codex","codex","npm install -g @openai/codex"),og("qwen","qwen","pip install qwen-cli")]),i=await Promise.all(l.filter((X)=>X.installed).map(async(X)=>{let G=await Ym(X.name);return{...X,mcp:G}})),$=await Am(),x=await fm(),C=P(g,".serena","memories"),m=y(C),N=0;if(m)try{N=i1(C).length}catch{}let I=l.filter((X)=>!X.installed),M=x.length>0?x.filter((X)=>!X.installed||!X.hasSkillMd):[...b.domain,...b.coordination,...b.utility].map((X)=>({name:X.name,installed:!1,hasSkillMd:!1})),u=I.length+i.filter((X)=>!X.mcp.configured).length+$.filter((X)=>!X.available).length+M.length;if(n){let X={ok:u===0,issues:u,clis:l.map((G)=>({name:G.name,installed:G.installed,version:G.version||null})),mcp:i.map((G)=>({name:G.name,configured:G.mcp.configured,path:G.mcp.path||null})),dashboard:$.map((G)=>({name:G.name,available:G.available,type:G.type})),skills:x.length>0?x.map((G)=>({name:G.name,installed:G.installed,complete:G.hasSkillMd})):[],missingSkills:M.map((G)=>G.name),serena:{exists:m,fileCount:N}};console.log(JSON.stringify(X,null,2)),process.exit(u===0?0:1)}console.clear(),Ln(Z.default.bgMagenta(Z.default.white(" \uD83E\uDE7A oh-my-ag doctor ")));let Q=Dg();try{let X=[Z.default.bold("\uD83D\uDD0D CLI Installation Status"),"",` ${Z.default.bold("CLI")}      ${Z.default.bold("Status")}      ${Z.default.bold("Version")}       `,"",...l.map((z)=>{let O=z.installed?Z.default.green(" Installed"):Z.default.red(" Missing"),A=z.version||"-";return` ${z.name.padEnd(7)}  ${O.padEnd(8)}  ${A.padEnd(11)} `}),""].join(`
`);if(_(X,"CLI Status"),I.length>0)_(I.map((z)=>`${Z.default.yellow("")} ${z.name}: ${Z.default.dim(z.installCmd)}`).join(`
`),"Install missing CLIs");if(i.length>0){let z=[Z.default.bold("\uD83D\uDD17 MCP Connection Status"),"",` ${Z.default.bold("CLI")}      ${Z.default.bold("MCP Config")}  ${Z.default.bold("Path")}                `,"",...i.map((O)=>{let A=O.mcp.configured?Z.default.green(" Configured"):Z.default.yellow("  Not configured"),H=O.mcp.path?O.mcp.path.split("/").pop()||"":"-";return` ${O.name.padEnd(7)}  ${A.padEnd(8)}  ${H.padEnd(19)} `}),""].join(`
`);_(z,"MCP Status")}let G=[Z.default.bold("\uD83D\uDCCA Dashboard Dependencies"),"",` ${Z.default.bold("Dependency")}       ${Z.default.bold("Status")}      ${Z.default.bold("Install Command")}                    `,"",...$.map((z)=>{let O=z.available?Z.default.green(" Available"):Z.default.red(" Missing"),A=z.installCmd||"-";return` ${z.name.padEnd(15)}  ${O.padEnd(8)}  ${A.padEnd(34)} `}),""].join(`
`);_(G,"Dashboard Status");let J=x.filter((z)=>z.installed).length,K=x.filter((z)=>z.hasSkillMd).length;if(x.length>0){let z=[Z.default.bold(`\uD83D\uDCE6 Skills (${J}/${x.length} installed, ${K} complete)`),"",` ${Z.default.bold("Skill")}                 ${Z.default.bold("Installed")}  ${Z.default.bold("SKILL.md")}    `,"",...x.map((O)=>{let A=O.installed?Z.default.green(""):Z.default.red(""),H=O.hasSkillMd?Z.default.green(""):Z.default.red("");return` ${O.name.padEnd(18)}  ${A.padEnd(8)}  ${H.padEnd(11)} `}),""].join(`
`);_(z,"Skills Status")}else _(Z.default.yellow("No skills installed."),"Skills Status");if(M.length>0){let z=await F1({message:`Found ${M.length} missing/incomplete skill(s). Install them?`,initialValue:!0});if(a(z))Jn("Cancelled."),process.exit(0);if(z){let O=M.map((f)=>f.name),A=await Sg({message:"Which skills to install?",options:[{value:"all",label:` All (${O.length} skills)`,hint:"Recommended"},{value:"select",label:"\uD83D\uDD27 Select individually"}]});if(a(A))Jn("Cancelled."),process.exit(0);let H;if(A==="select"){let f=[...b.domain,...b.coordination,...b.utility],U=await Al({message:"Select skills to install:",options:M.map((R)=>{let Y=f.find((d)=>d.name===R.name);return{value:R.name,label:R.name,hint:Y?.desc||""}}),required:!0});if(a(U))Jn("Cancelled."),process.exit(0);H=U}else H=O;Q.start("Installing skills...");try{await Xi(g);for(let f of H)Q.message(`Installing ${Z.default.cyan(f)}...`),await Zi(f,g);Q.stop(`Installed ${H.length} skill(s)!`),_(H.map((f)=>`${Z.default.green("")} ${f}`).join(`
`),"Installed Skills")}catch(f){Q.stop("Installation failed"),nn.error(f instanceof Error?f.message:String(f))}}}if(m)_(`${Z.default.green("")} Serena memory directory exists
${Z.default.dim(`${N} memory files found`)}`,"Serena Memory");else _(`${Z.default.yellow("")} Serena memory directory not found
${Z.default.dim("Dashboard will show 'No agents detected'")}`,"Serena Memory");if(u===0)Nn(Z.default.green(" All checks passed! Ready to use."));else Nn(Z.default.yellow(`  Found ${u} issue(s). See details above.`))}catch(X){if(Q)Q.stop("Check failed");nn.error(X instanceof Error?X.message:String(X)),process.exit(1)}}function m1(n){return P(n,".serena","metrics.json")}function C1(n){return P(n,".serena","retrospectives")}function Dm(n){let g=m1(n);if(y(g))try{return JSON.parse(ag(g,"utf-8"))}catch{return l1()}return l1()}function l1(){return{sessions:0,skillsUsed:{},tasksCompleted:0,totalSessionTime:0,filesChanged:0,linesAdded:0,linesRemoved:0,lastUpdated:new Date().toISOString(),startDate:new Date().toISOString()}}function Sm(n,g){let l=m1(n),i=rg(l);if(!y(i))En(i,{recursive:!0});g.lastUpdated=new Date().toISOString(),Bn(l,JSON.stringify(g,null,2),"utf-8")}function Um(n){try{let l=Ig("git diff --stat HEAD~10 2>/dev/null || git diff --stat",{cwd:n,encoding:"utf-8",stdio:["pipe","pipe","ignore"]}).trim().split(`
`),i=l[l.length-1]||"",$=i.match(/(\d+) files? changed/),x=i.match(/(\d+) insertions?\(\+\)/),C=i.match(/(\d+) deletions?\(-\)/);return{filesChanged:$?.[1]?parseInt($[1],10):0,linesAdded:x?.[1]?parseInt(x[1],10):0,linesRemoved:C?.[1]?parseInt(C[1],10):0}}catch{return{filesChanged:0,linesAdded:0,linesRemoved:0}}}function Vm(n){let g=P(n,".serena","memories"),l={};if(!y(g))return l;try{let i=i1(g);for(let $ of i){let x=$.match(/(?:progress|result)-(\w+)/);if(x?.[1]){let C=x[1];l[C]=(l[C]||0)+1}}}catch{}return l}async function Tm(n=!1,g=!1){let l=process.cwd(),i=m1(l);if(g){if(y(i))Bn(i,JSON.stringify(l1(),null,2),"utf-8");if(n)console.log(JSON.stringify({reset:!0}));else console.log(Z.default.green(" Metrics reset successfully."));return}let $=Dm(l),x=Um(l),C=Vm(l);for(let[u,Q]of Object.entries(C))$.skillsUsed[u]=($.skillsUsed[u]||0)+Q;$.filesChanged+=x.filesChanged,$.linesAdded+=x.linesAdded,$.linesRemoved+=x.linesRemoved,$.sessions+=1,Sm(l,$);let m=Math.max(1,Math.ceil((Date.now()-new Date($.startDate).getTime())/86400000)),N=$.sessions>0?Math.round($.totalSessionTime/$.sessions):0;if(n){console.log(JSON.stringify({...$,gitStats:x,daysSinceStart:m,avgSessionTime:N},null,2));return}console.clear(),Ln(Z.default.bgMagenta(Z.default.white(" \uD83D\uDCCA oh-my-ag stats ")));let I=[Z.default.bold(`\uD83D\uDCC8 Productivity Metrics (${m} days)`),"",` ${Z.default.bold("Metric")}               ${Z.default.bold("Value")}        `,"",` Sessions             ${String($.sessions).padEnd(12)} `,` Tasks Completed      ${String($.tasksCompleted).padEnd(12)} `,` Files Changed        ${String($.filesChanged).padEnd(12)} `,` Lines Added          ${Z.default.green("+"+$.linesAdded).padEnd(12)} `,` Lines Removed        ${Z.default.red("-"+$.linesRemoved).padEnd(12)} `,""].join(`
`);_(I,"Overview");let M=Object.entries($.skillsUsed).sort(([,u],[,Q])=>Q-u).slice(0,5);if(M.length>0){let u=[Z.default.bold("\uD83C\uDFC6 Top Skills Used"),...M.map(([Q,X],G)=>`  ${G+1}. ${Q} (${X})`)].join(`
`);_(u,"Skills")}Nn(Z.default.dim(`Data stored in: ${i}`))}function Bm(n){let g=C1(n);if(!y(g))return[];try{return i1(g).filter((i)=>i.endsWith(".json")).sort().reverse().slice(0,10).map((i)=>JSON.parse(ag(P(g,i),"utf-8")))}catch{return[]}}function qm(n,g){let l=C1(n);if(!y(l))En(l,{recursive:!0});let i=`${g.date.replace(/[:.]/g,"-")}_${g.id}.json`;Bn(P(l,i),JSON.stringify(g,null,2),"utf-8")}function Lm(n,g=5){try{return Ig(`git log --oneline -${g} 2>/dev/null`,{cwd:n,encoding:"utf-8",stdio:["pipe","pipe","ignore"]}).trim().split(`
`).filter(Boolean)}catch{return[]}}function dm(n){try{return Ig("git diff --name-only HEAD~5 2>/dev/null || git diff --name-only",{cwd:n,encoding:"utf-8",stdio:["pipe","pipe","ignore"]}).trim().split(`
`).filter(Boolean).slice(0,10)}catch{return[]}}async function _m(n=!1){let g=process.cwd(),l=C1(g),i=Bm(g);if(n){console.log(JSON.stringify({retrospectives:i},null,2));return}console.clear(),Ln(Z.default.bgMagenta(Z.default.white(" \uD83D\uDD04 oh-my-ag retro ")));let $=i[0];if($)_([Z.default.bold("\uD83D\uDCC5 Last Retrospective"),`Date: ${$.date}`,"",Z.default.bold("Summary:"),$.summary,"",Z.default.bold("Key Learnings:"),...$.keyLearnings.map((Q)=>`   ${Q}`),"",Z.default.bold("Next Steps:"),...$.nextSteps.map((Q)=>`   ${Q}`)].join(`
`),"Previous Session");let x=await Sg({message:"What would you like to do?",options:[{value:"new",label:"\uD83D\uDCDD Create new retrospective"},{value:"list",label:"\uD83D\uDCCB View past retrospectives"},{value:"exit",label:"\uD83D\uDC4B Exit"}]});if(a(x)||x==="exit"){Nn(Z.default.dim("Goodbye!"));return}if(x==="list"){if(i.length===0)_(Z.default.yellow("No retrospectives found."),"History");else{let Q=i.map((X,G)=>`${G+1}. [${X.date.split("T")[0]}] ${X.summary.slice(0,50)}...`).join(`
`);_(Q,`\uD83D\uDCDA Past Retrospectives (${i.length})`)}Nn(Z.default.dim(`Stored in: ${l}`));return}let C=Lm(g),m=dm(g);if(C.length>0)_(C.join(`
`),"Recent Commits");if(m.length>0)_(m.join(`
`),"Changed Files");let N=await Ug({message:"What did you accomplish in this session?",placeholder:"e.g., Implemented user authentication flow"});if(a(N)){Jn("Cancelled.");return}let I=await Ug({message:"Key learnings? (comma-separated)",placeholder:"e.g., JWT needs refresh token, bcrypt is slow"});if(a(I)){Jn("Cancelled.");return}let M=await Ug({message:"Next steps? (comma-separated)",placeholder:"e.g., Add password reset, Write tests"});if(a(M)){Jn("Cancelled.");return}let u={id:Math.random().toString(36).slice(2,8),date:new Date().toISOString(),summary:N,keyLearnings:I.split(",").map((Q)=>Q.trim()).filter(Boolean),filesChanged:m,nextSteps:M.split(",").map((Q)=>Q.trim()).filter(Boolean)};qm(g,u),_([Z.default.green(" Retrospective saved!"),"",`Summary: ${u.summary}`,`Learnings: ${u.keyLearnings.length} items`,`Next steps: ${u.nextSteps.length} items`].join(`
`),"Saved"),Nn(Z.default.dim(`Stored in: ${l}`))}function Pm(){console.log(`
${Z.default.bold("\uD83D\uDEF8 oh-my-ag")} - Multi-Agent Skills for Antigravity IDE

${Z.default.bold("USAGE:")}
  bunx oh-my-ag [command]

${Z.default.bold("COMMANDS:")}
  ${Z.default.cyan("<no command>")}    Interactive CLI - install skills with prompts
  ${Z.default.cyan("dashboard")}      Start terminal dashboard (real-time agent monitoring)
  ${Z.default.cyan("dashboard:web")}  Start web dashboard on http://localhost:9847
  ${Z.default.cyan("update")}         Update skills to latest version from registry
  ${Z.default.cyan("doctor")}         Check CLI installations, MCP configs, and skill status
  ${Z.default.cyan("stats")}          View productivity metrics
  ${Z.default.cyan("retro")}          Session retrospective (learnings & next steps)
  ${Z.default.cyan("help")}           Show this help message

${Z.default.bold("OPTIONS:")}
  ${Z.default.cyan("--json")}         Output as JSON (for doctor, stats, retro)
  ${Z.default.cyan("--reset")}        Reset data (for stats)

${Z.default.bold("PRESETS:")}
   all       - Install all available skills
  \uD83C\uDF10 fullstack - Frontend + Backend + PM + QA + Debug + Commit
  \uD83C\uDFA8 frontend  - Frontend + PM + QA + Debug + Commit
   backend   - Backend + PM + QA + Debug + Commit
  \uD83D\uDCF1 mobile    - Mobile + PM + QA + Debug + Commit

${Z.default.bold("EXAMPLES:")}
  bunx oh-my-ag                    # Interactive mode
  bunx oh-my-ag dashboard          # Terminal dashboard
  bunx oh-my-ag dashboard:web      # Web dashboard
  bunx oh-my-ag update             # Update skills
  bunx oh-my-ag doctor             # Check setup
  bunx oh-my-ag doctor --json      # JSON output for CI/CD
  bunx oh-my-ag stats              # View productivity metrics
  bunx oh-my-ag stats --reset      # Reset metrics
  bunx oh-my-ag retro              # Create session retrospective

${Z.default.dim("For more info: https://github.com/first-fluke/oh-my-ag")}

${Z.default.bold("  Enjoying this project?")}
  ${Z.default.dim("gh api --method PUT /user/starred/first-fluke/oh-my-ag")}
`)}async function Fm(){console.clear(),Ln(Z.default.bgMagenta(Z.default.white(" \uD83D\uDEF8 oh-my-ag ")));let n=await Sg({message:"What type of project?",options:[{value:"all",label:" All",hint:"Install everything"},{value:"fullstack",label:"\uD83C\uDF10 Fullstack",hint:"Frontend + Backend + PM + QA"},{value:"frontend",label:"\uD83C\uDFA8 Frontend",hint:"React/Next.js"},{value:"backend",label:" Backend",hint:"FastAPI/Python"},{value:"mobile",label:"\uD83D\uDCF1 Mobile",hint:"Flutter/Dart"},{value:"custom",label:"\uD83D\uDD27 Custom",hint:"Choose skills"}]});if(a(n))Jn("Cancelled."),process.exit(0);let g;if(n==="custom"){let $=[...b.domain,...b.coordination,...b.utility],x=await Al({message:"Select skills:",options:$.map((C)=>({value:C.name,label:C.name,hint:C.desc})),required:!0});if(a(x))Jn("Cancelled."),process.exit(0);g=x}else g=jm[n]??[];let l=process.cwd(),i=Dg();i.start("Installing skills...");try{await Xi(l);for(let $ of g)i.message(`Installing ${Z.default.cyan($)}...`),await Zi($,l);i.stop("Skills installed!"),_([...g.map(($)=>`${Z.default.green("")} ${$}`),"",Z.default.dim(`Location: ${P(l,".agent","skills")}`)].join(`
`),"Installed"),Nn(Z.default.green("Done! Open your project in your IDE to use the skills.")),_(`${Z.default.yellow("")} Enjoying oh-my-ag? Give it a star!
${Z.default.dim("gh api --method PUT /user/starred/first-fluke/oh-my-ag")}`,"Support")}catch($){i.stop("Installation failed"),nn.error($ instanceof Error?$.message:String($)),process.exit(1)}}
